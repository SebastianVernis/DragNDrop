{"version":3,"file":"main-aBfwshUM.js","sources":["../../script.js","../../src/components/fileLoader.js","../../src/components/htmlParser.js","../../src/storage/projectManager.js","../../src/utils/componentExtractor.js","../../src/core/undoRedo.js","../../src/core/keyboardShortcuts.js","../../src/core/responsiveTester.js","../../src/core/livePreview.js","../../src/core/themeManager.js","../../src/core/aiCodeGenerator.js","../../src/core/geminiValidator.js","../../src/core/resizeManager.js","../../src/core/enhancedDragDrop.js","../../src/core/projectAnalyzer.js"],"sourcesContent":["        // Variables globales\n        let selectedElement = null;\n        let draggedComponentType = null;\n        let elementIdCounter = 0;\n        let currentFilter = 'todas';\n        \n        // Nuevas instancias de m√≥dulos\n        let fileLoader = null;\n        let projectManager = null;\n        let componentExtractor = null;\n\n        // Plantillas precargadas\n        const plantillas = [\n            {\n                id: 'saas-landing',\n                nombre: 'Landing Page SaaS',\n                descripcion: 'Perfecta para software, apps y servicios en la nube',\n                categoria: 'negocios',\n                emoji: 'üöÄ',\n                contenido_html: `<nav style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n        <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">TuProducto</h1>\n        <div style=\"display: flex; gap: 30px; align-items: center;\">\n          <a href=\"#\" style=\"color: white; text-decoration: none;\">Features</a>\n          <a href=\"#\" style=\"color: white; text-decoration: none;\">Precios</a>\n          <a href=\"#\" style=\"color: white; text-decoration: none;\">Contacto</a>\n          <button style=\"background: white; color: #667eea; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;\">Comienza gratis</button>\n        </div>\n      </nav>\n\n      <section style=\"min-height: 600px; display: flex; flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 60px 20px;\">\n        <h2 style=\"font-size: 56px; font-weight: bold; margin: 0 0 20px 0; max-width: 900px;\">La soluci√≥n perfecta para tu negocio</h2>\n        <p style=\"font-size: 20px; margin: 0 0 40px 0; max-width: 700px; opacity: 0.95;\">Aumenta tu productividad y automatiza tus procesos con nuestra plataforma inteligente</p>\n        <div style=\"display: flex; gap: 20px; justify-content: center;\">\n          <button style=\"background: white; color: #667eea; padding: 14px 32px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer;\">Prueba gratis por 14 d√≠as</button>\n          <button style=\"background: transparent; color: white; padding: 14px 32px; border: 2px solid white; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer;\">Ver demo</button>\n        </div>\n      </section>\n\n      <section style=\"padding: 80px 20px; background: #f8fafc;\">\n        <div style=\"max-width: 1200px; margin: 0 auto;\">\n          <h3 style=\"text-align: center; font-size: 40px; font-weight: bold; margin: 0 0 60px 0; color: #1e293b;\">Caracter√≠sticas principales</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px;\">\n            <div style=\"padding: 30px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;\">\n              <div style=\"font-size: 48px; margin-bottom: 20px;\">‚ö°</div>\n              <h4 style=\"font-size: 20px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">Velocidad ultrarr√°pida</h4>\n              <p style=\"margin: 0; color: #64748b; line-height: 1.6;\">Procesa millones de transacciones sin ralentizarse</p>\n            </div>\n            <div style=\"padding: 30px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;\">\n              <div style=\"font-size: 48px; margin-bottom: 20px;\">üîí</div>\n              <h4 style=\"font-size: 20px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">Seguridad m√°xima</h4>\n              <p style=\"margin: 0; color: #64748b; line-height: 1.6;\">Encriptaci√≥n de nivel empresarial para tus datos</p>\n            </div>\n            <div style=\"padding: 30px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;\">\n              <div style=\"font-size: 48px; margin-bottom: 20px;\">üìà</div>\n              <h4 style=\"font-size: 20px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">An√°lisis en tiempo real</h4>\n              <p style=\"margin: 0; color: #64748b; line-height: 1.6;\">Dashboards inteligentes para tomar mejores decisiones</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <footer style=\"background: #1e293b; color: white; padding: 40px 20px; text-align: center;\">\n        <p style=\"margin: 0; color: #94a3b8;\">&copy; 2025 TuProducto.io. Todos los derechos reservados.</p>\n      </footer>`\n            },\n            {\n                id: 'portfolio',\n                nombre: 'Portafolio Profesional',\n                descripcion: 'Vitrina profesional para mostrar tu trabajo',\n                categoria: 'personal',\n                emoji: 'üë®‚Äçüíª',\n                contenido_html: `<nav style=\"background: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n        <h1 style=\"margin: 0; font-size: 24px; font-weight: bold; color: #1e293b;\">Juan P√©rez</h1>\n        <div style=\"display: flex; gap: 30px; align-items: center;\">\n          <a href=\"#inicio\" style=\"color: #1e293b; text-decoration: none; font-weight: 500;\">Inicio</a>\n          <a href=\"#proyectos\" style=\"color: #1e293b; text-decoration: none; font-weight: 500;\">Proyectos</a>\n          <a href=\"#contacto\" style=\"color: #1e293b; text-decoration: none; font-weight: 500;\">Contacto</a>\n          <a href=\"#\" style=\"background: #f97316; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: bold;\">Descargar CV</a>\n        </div>\n      </nav>\n\n      <section style=\"padding: 100px 40px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; display: flex; align-items: center; justify-content: center;\">\n        <div style=\"text-align: center; max-width: 600px;\">\n          <div style=\"width: 150px; height: 150px; border-radius: 50%; background: white; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 80px;\">üë®‚Äçüíª</div>\n          <h2 style=\"font-size: 48px; font-weight: bold; margin: 0 0 16px 0;\">Desarrollador Full Stack</h2>\n          <p style=\"font-size: 20px; margin: 0 0 30px 0; opacity: 0.9;\">Especializado en crear soluciones web modernas y eficientes</p>\n          <p style=\"font-size: 16px; margin: 0; opacity: 0.85;\">Python ‚Ä¢ JavaScript ‚Ä¢ React ‚Ä¢ Django ‚Ä¢ PostgreSQL</p>\n        </div>\n      </section>\n\n      <section style=\"padding: 80px 40px; background: white;\">\n        <div style=\"max-width: 1200px; margin: 0 auto;\">\n          <h3 style=\"font-size: 32px; font-weight: bold; margin: 0 0 60px 0; color: #1e293b;\">Proyectos destacados</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;\">\n            <div style=\"border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n              <div style=\"background: #667eea; height: 200px; display: flex; align-items: center; justify-content: center; font-size: 80px;\">üì±</div>\n              <div style=\"padding: 30px; background: white;\">\n                <h4 style=\"font-size: 20px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">App Mobile</h4>\n                <p style=\"color: #64748b; margin: 0 0 16px 0; line-height: 1.6;\">Aplicaci√≥n m√≥vil para gesti√≥n de tareas</p>\n                <a href=\"#\" style=\"color: #f97316; text-decoration: none; font-weight: bold;\">Ver proyecto ‚Üí</a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <footer style=\"background: #1e293b; color: white; padding: 40px 20px; text-align: center;\">\n        <p style=\"margin: 0; color: #94a3b8;\">&copy; 2025 Juan P√©rez. Todos los derechos reservados.</p>\n      </footer>`\n            },\n            {\n                id: 'blog',\n                nombre: 'Blog Minimalista',\n                descripcion: 'Plataforma para publicar art√≠culos y historias',\n                categoria: 'blog',\n                emoji: 'üìù',\n                contenido_html: `<header style=\"background: white; padding: 20px 40px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;\">\n        <h1 style=\"margin: 0; font-size: 24px; font-weight: bold; color: #1e293b;\">Mi Blog</h1>\n        <div style=\"display: flex; gap: 16px;\">\n          <input type=\"text\" placeholder=\"Buscar art√≠culos...\" style=\"padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 6px; width: 300px;\">\n          <button style=\"padding: 10px 20px; background: #1e293b; color: white; border: none; border-radius: 6px; cursor: pointer;\">Buscar</button>\n        </div>\n      </header>\n\n      <section style=\"padding: 60px 40px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white;\">\n        <div style=\"max-width: 900px; margin: 0 auto;\">\n          <h2 style=\"font-size: 48px; font-weight: bold; margin: 0 0 20px 0;\">√öltimo art√≠culo</h2>\n          <div style=\"background: rgba(255,255,255,0.1); padding: 30px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);\">\n            <span style=\"background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;\">Tecnolog√≠a</span>\n            <h3 style=\"font-size: 32px; font-weight: bold; margin: 16px 0; color: white;\">Introducci√≥n a Web 3.0</h3>\n            <p style=\"margin: 0 0 16px 0; line-height: 1.6; opacity: 0.9;\">Descubre qu√© es Web 3.0, c√≥mo funciona y por qu√© es importante para el futuro de internet</p>\n          </div>\n        </div>\n      </section>\n\n      <section style=\"padding: 60px 40px; background: white;\">\n        <div style=\"max-width: 900px; margin: 0 auto;\">\n          <h3 style=\"font-size: 32px; font-weight: bold; margin: 0 0 40px 0; color: #1e293b;\">Todos los art√≠culos</h3>\n          <article style=\"padding: 30px; border-bottom: 1px solid #e2e8f0;\">\n            <h4 style=\"font-size: 20px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">Gu√≠a completa de JavaScript</h4>\n            <p style=\"color: #64748b; margin: 0;\">Aprende los conceptos fundamentales del lenguaje</p>\n          </article>\n        </div>\n      </section>\n\n      <footer style=\"background: #1e293b; color: white; padding: 40px 20px; text-align: center;\">\n        <p style=\"margin: 0; color: #94a3b8;\">&copy; 2025 Mi Blog. Todos los derechos reservados.</p>\n      </footer>`\n            },\n            {\n                id: 'contacto',\n                nombre: 'P√°gina de Contacto',\n                descripcion: 'Formulario de contacto profesional con informaci√≥n',\n                categoria: 'servicios',\n                emoji: 'üìß',\n                contenido_html: `<header style=\"background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; padding: 60px 40px; text-align: center;\">\n        <h1 style=\"font-size: 40px; font-weight: bold; margin: 0 0 12px 0;\">Contacta con nosotros</h1>\n        <p style=\"font-size: 18px; margin: 0; opacity: 0.95;\">Estamos aqu√≠ para responder tus preguntas y ayudarte</p>\n      </header>\n\n      <section style=\"padding: 80px 40px; background: white;\">\n        <div style=\"max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 60px;\">\n          <div>\n            <h2 style=\"font-size: 28px; font-weight: bold; margin: 0 0 30px 0; color: #1e293b;\">Env√≠anos un mensaje</h2>\n            <form style=\"display: flex; flex-direction: column; gap: 20px;\">\n              <input type=\"text\" placeholder=\"Tu nombre\" style=\"padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;\">\n              <input type=\"email\" placeholder=\"tu@email.com\" style=\"padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;\">\n              <textarea placeholder=\"Cu√©ntanos m√°s...\" style=\"padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; min-height: 150px;\"></textarea>\n              <button type=\"submit\" style=\"padding: 12px; background: #0891b2; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 16px; cursor: pointer;\">Enviar mensaje</button>\n            </form>\n          </div>\n\n          <div>\n            <h2 style=\"font-size: 28px; font-weight: bold; margin: 0 0 30px 0; color: #1e293b;\">Informaci√≥n de contacto</h2>\n            <div style=\"margin-bottom: 40px;\">\n              <h3 style=\"font-size: 18px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">üìç Ubicaci√≥n</h3>\n              <p style=\"margin: 0; color: #64748b;\">Ciudad de M√©xico, CDMX</p>\n            </div>\n            <div>\n              <h3 style=\"font-size: 18px; font-weight: bold; margin: 0 0 12px 0; color: #1e293b;\">üìû Tel√©fono</h3>\n              <p style=\"margin: 0;\"><a href=\"tel:+525511223344\" style=\"color: #0891b2; text-decoration: none;\">+52 55 1122 3344</a></p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <footer style=\"background: #1e293b; color: white; padding: 40px 20px; text-align: center;\">\n        <p style=\"margin: 0; color: #94a3b8;\">&copy; 2025 Tu Empresa. Todos los derechos reservados.</p>\n      </footer>`\n            },\n            {\n                id: 'ecommerce',\n                nombre: 'Tienda Online',\n                descripcion: 'Ecommerce completo con cat√°logo de productos',\n                categoria: 'tienda',\n                emoji: 'üõí',\n                contenido_html: `<nav style=\"background: white; padding: 16px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n        <h1 style=\"margin: 0; font-size: 24px; font-weight: bold; color: #dc2626;\">TiendaXpress</h1>\n        <div style=\"display: flex; gap: 20px; align-items: center;\">\n          <input type=\"text\" placeholder=\"Buscar productos...\" style=\"padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 6px; width: 300px;\">\n          <span style=\"font-weight: bold; cursor: pointer;\">üõí Carrito (3)</span>\n        </div>\n      </nav>\n\n      <section style=\"background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 40px; text-align: center;\">\n        <h2 style=\"font-size: 36px; font-weight: bold; margin: 0 0 12px 0;\">Env√≠o GRATIS en compras mayores a $500</h2>\n        <p style=\"font-size: 16px; margin: 0;\">V√°lido hasta el 30 de noviembre</p>\n      </section>\n\n      <section style=\"padding: 40px; background: #f3f4f6;\">\n        <div style=\"max-width: 1200px; margin: 0 auto;\">\n          <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;\">\n            <div style=\"background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n              <div style=\"background: #e5e7eb; height: 150px; display: flex; align-items: center; justify-content: center; font-size: 60px;\">üì±</div>\n              <div style=\"padding: 16px;\">\n                <h4 style=\"font-size: 14px; font-weight: bold; margin: 0 0 8px 0;\">Smartphone Pro</h4>\n                <div style=\"font-size: 16px; font-weight: bold; color: #dc2626; margin-bottom: 12px;\">$799</div>\n                <button style=\"width: 100%; padding: 8px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;\">A√±adir al carrito</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <footer style=\"background: #1e293b; color: white; padding: 40px 20px; text-align: center;\">\n        <p style=\"margin: 0; color: #94a3b8;\">&copy; 2025 TiendaXpress. Todos los derechos reservados.</p>\n      </footer>`\n            }\n        ];\n\n        // Inicializaci√≥n\n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('DOM Content Loaded - Starting initialization');\n            console.log('Templates array length:', plantillas.length);\n            \n            // Inicializar m√≥dulos nuevos\n            initializeNewModules();\n            \n            setupComponentDrag();\n            setupCanvasDrop();\n            setupCanvasDropForMovement();\n            setupKeyboardShortcuts();\n            setupComponentSearch();\n            renderTemplates();\n            console.log('Templates rendered');\n            showGallery();\n            console.log('Gallery shown');\n        });\n\n        // Inicializar nuevos m√≥dulos\n        function initializeNewModules() {\n            try {\n                fileLoader = new FileLoader();\n                projectManager = new ProjectManager();\n                componentExtractor = new ComponentExtractor();\n                \n                // Exponer globalmente para acceso desde otros m√≥dulos\n                window.fileLoader = fileLoader;\n                window.projectManager = projectManager;\n                window.componentExtractor = componentExtractor;\n                \n                console.log('Nuevos m√≥dulos inicializados correctamente');\n            } catch (error) {\n                console.error('Error inicializando m√≥dulos:', error);\n            }\n        }\n\n        // Configurar b√∫squeda de componentes\n        function setupComponentSearch() {\n            const searchInput = document.getElementById('componentSearch');\n            \n            searchInput.addEventListener('input', function() {\n                const searchTerm = this.value.toLowerCase();\n                const components = document.querySelectorAll('.component-item');\n                \n                components.forEach(component => {\n                    const text = component.textContent.toLowerCase();\n                    const type = component.getAttribute('data-type').toLowerCase();\n                    \n                    if (text.includes(searchTerm) || type.includes(searchTerm)) {\n                        component.style.display = 'block';\n                    } else {\n                        component.style.display = 'none';\n                    }\n                });\n                \n                // Mostrar u ocultar categor√≠as seg√∫n si tienen componentes visibles\n                const categories = document.querySelectorAll('.component-category');\n                categories.forEach(category => {\n                    const visibleItems = category.querySelectorAll('.component-item[style*=\"display: block\"], .component-item:not([style*=\"display\"])');\n                    if (visibleItems.length === 0) {\n                        category.style.display = 'none';\n                    } else {\n                        category.style.display = 'block';\n                    }\n                });\n            });\n        }\n\n        // Renderizar plantillas\n        function renderTemplates() {\n            const grid = document.getElementById('templatesGrid');\n            if (!grid) {\n                console.error('Templates grid not found');\n                return;\n            }\n            \n            const filtered = currentFilter === 'todas'\n                ? plantillas\n                : plantillas.filter(t => t.categoria === currentFilter);\n\n            console.log('Rendering templates:', filtered.length);\n            \n            grid.innerHTML = filtered.map(template => `\n                <div class=\"template-card\" onclick=\"loadTemplate('${template.id}')\">\n                    <div class=\"template-preview\">${template.emoji}</div>\n                    <div class=\"template-info\">\n                        <span class=\"template-badge badge-${template.categoria}\">${template.categoria.toUpperCase()}</span>\n                        <h3>${template.nombre}</h3>\n                        <p>${template.descripcion}</p>\n                        <button class=\"use-template-btn\" onclick=\"event.stopPropagation(); loadTemplate('${template.id}')\">Usar Esta Plantilla</button>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // Filtrar plantillas por categor√≠a\n        function filterTemplates(categoria) {\n            currentFilter = categoria;\n\n            // Actualizar botones activos\n            document.querySelectorAll('.category-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n\n            renderTemplates();\n        }\n\n        // Cargar plantilla\n        function loadTemplate(templateId) {\n            const template = plantillas.find(t => t.id === templateId);\n            if (!template) return;\n\n            const canvas = document.getElementById('canvas');\n            canvas.innerHTML = template.contenido_html;\n\n            // Re-aplicar eventos a los elementos cargados\n            const elements = canvas.querySelectorAll('*');\n            elements.forEach((element, index) => {\n                // Evitar agregar eventos al canvas mismo\n                if (element.id === 'canvas') return;\n\n                element.id = 'element-' + (elementIdCounter++);\n                element.classList.add('canvas-element');\n\n                // Agregar bot√≥n de eliminar\n                const deleteBtn = document.createElement('div');\n                deleteBtn.className = 'delete-btn';\n                deleteBtn.textContent = '√ó';\n                deleteBtn.onclick = function(e) {\n                    e.stopPropagation();\n                    deleteElement(element);\n                };\n                element.appendChild(deleteBtn);\n\n                // Eventos\n                element.addEventListener('click', function(e) {\n                    e.stopPropagation();\n                    selectElement(element);\n                });\n\n                element.addEventListener('dblclick', function(e) {\n                    e.stopPropagation();\n                    makeElementEditable(element);\n                });\n\n                // Configurar drag & drop para movimiento de elementos\n                setupElementDragAndDrop(element);\n            });\n\n            hideGallery();\n            showToast('Plantilla \"' + template.nombre + '\" cargada');\n        }\n\n        // Mostrar galer√≠a\n        function showGallery() {\n            const canvas = document.getElementById('canvas');\n            if (canvas.children.length > 0) {\n                if (!confirm('¬øEst√°s seguro? Perder√°s los cambios no guardados.')) {\n                    return;\n                }\n            }\n            document.getElementById('galleryScreen').classList.remove('hidden');\n        }\n\n        // Mostrar ayuda\n        function showHelp() {\n            document.getElementById('helpScreen').classList.remove('hidden');\n            document.getElementById('galleryScreen').classList.add('hidden');\n        }\n\n        // Ocultar galer√≠a\n        function hideGallery() {\n            document.getElementById('galleryScreen').classList.add('hidden');\n        }\n\n        // Empezar proyecto en blanco\n        function startBlankProject() {\n            console.log('startBlankProject called');\n            document.getElementById('canvas').innerHTML = '';\n            selectedElement = null;\n            document.getElementById('propertiesPanel').innerHTML = `\n                <h2 class=\"panel-title\">Propiedades</h2>\n                <div class=\"properties-empty\">\n                    ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                </div>\n            `;\n            hideGallery();\n            showToast('Nuevo proyecto en blanco creado');\n        }\n\n        // Configurar drag desde panel de componentes\n        function setupComponentDrag() {\n            const components = document.querySelectorAll('.component-item');\n            components.forEach(component => {\n                const type = component.getAttribute('data-type');\n                \n                // Usar nuevo sistema de drag & drop si est√° disponible\n                if (window.enhancedDragDrop) {\n                    window.enhancedDragDrop.setupComponentDrag(component, type);\n                } else {\n                    // Fallback al sistema antiguo\n                    component.addEventListener('dragstart', function(e) {\n                        draggedComponentType = type;\n                        e.dataTransfer.effectAllowed = 'copy';\n                        this.classList.add('dragging');\n                        \n                        const img = document.createElement('img');\n                        img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n                        e.dataTransfer.setDragImage(img, 0, 0);\n                    });\n                    \n                    component.addEventListener('dragend', function() {\n                        this.classList.remove('dragging');\n                    });\n                }\n            });\n        }\n\n        // Configurar drop en canvas\n        function setupCanvasDrop() {\n            const canvas = document.getElementById('canvas');\n\n            canvas.addEventListener('dragover', function(e) {\n                e.preventDefault();\n                e.dataTransfer.dropEffect = 'copy';\n                canvas.classList.add('drop-zone');\n            });\n\n            canvas.addEventListener('dragleave', function(e) {\n                canvas.classList.remove('drop-zone');\n            });\n\n            canvas.addEventListener('drop', function(e) {\n                e.preventDefault();\n                canvas.classList.remove('drop-zone');\n                if (draggedComponentType) {\n                    const element = createComponent(draggedComponentType);\n                    canvas.appendChild(element);\n                    draggedComponentType = null;\n                }\n            });\n        }\n\n        // Crear componente seg√∫n tipo\n        function createComponent(type) {\n            let element;\n            const id = 'element-' + (elementIdCounter++);\n\n            switch(type) {\n                case 'contenedor':\n                    element = document.createElement('div');\n                    element.style.padding = '20px';\n                    element.style.border = '1px dashed #ccc';\n                    element.style.minHeight = '100px';\n                    element.textContent = 'Contenedor';\n                    break;\n\n                case 'seccion':\n                    element = document.createElement('section');\n                    element.style.padding = '40px 20px';\n                    element.style.width = '100%';\n                    element.style.minHeight = '200px';\n                    element.style.background = '#f8fafc';\n                    element.textContent = 'Secci√≥n';\n                    break;\n\n                case 'fila':\n                    element = document.createElement('div');\n                    element.style.display = 'flex';\n                    element.style.flexDirection = 'row';\n                    element.style.gap = '10px';\n                    element.style.minHeight = '80px';\n                    element.style.border = '1px dashed #ccc';\n                    element.textContent = 'Fila (Flex)';\n                    break;\n\n                case 'columna':\n                    element = document.createElement('div');\n                    element.style.display = 'flex';\n                    element.style.flexDirection = 'column';\n                    element.style.gap = '10px';\n                    element.style.minHeight = '100px';\n                    element.style.border = '1px dashed #ccc';\n                    element.textContent = 'Columna (Flex)';\n                    break;\n\n                case 'grid2':\n                    element = document.createElement('div');\n                    element.style.display = 'grid';\n                    element.style.gridTemplateColumns = '1fr 1fr';\n                    element.style.gap = '10px';\n                    element.style.minHeight = '100px';\n                    element.style.border = '1px dashed #ccc';\n                    element.innerHTML = '<div style=\"padding: 20px; background: #f1f5f9;\">Columna 1</div><div style=\"padding: 20px; background: #f1f5f9;\">Columna 2</div>';\n                    break;\n\n                case 'grid3':\n                    element = document.createElement('div');\n                    element.style.display = 'grid';\n                    element.style.gridTemplateColumns = '1fr 1fr 1fr';\n                    element.style.gap = '10px';\n                    element.style.minHeight = '100px';\n                    element.style.border = '1px dashed #ccc';\n                    element.innerHTML = '<div style=\"padding: 20px; background: #f1f5f9;\">Columna 1</div><div style=\"padding: 20px; background: #f1f5f9;\">Columna 2</div><div style=\"padding: 20px; background: #f1f5f9;\">Columna 3</div>';\n                    break;\n\n                case 'h1':\n                    element = document.createElement('h1');\n                    element.textContent = 'T√≠tulo Principal';\n                    element.style.fontSize = '2.5rem';\n                    element.style.fontWeight = 'bold';\n                    element.style.margin = '0';\n                    break;\n\n                case 'h2':\n                    element = document.createElement('h2');\n                    element.textContent = 'Subt√≠tulo';\n                    element.style.fontSize = '2rem';\n                    element.style.fontWeight = 'bold';\n                    element.style.margin = '0';\n                    break;\n\n                case 'h3':\n                    element = document.createElement('h3');\n                    element.textContent = 'T√≠tulo H3';\n                    element.style.fontSize = '1.5rem';\n                    element.style.fontWeight = 'bold';\n                    element.style.margin = '0';\n                    break;\n\n                case 'p':\n                    element = document.createElement('p');\n                    element.textContent = 'Este es un p√°rrafo de ejemplo. Haz doble click para editar el texto.';\n                    element.style.fontSize = '1rem';\n                    element.style.lineHeight = '1.6';\n                    element.style.margin = '0';\n                    break;\n\n                case 'span':\n                    element = document.createElement('span');\n                    element.textContent = 'Texto en l√≠nea';\n                    break;\n\n                case 'ul':\n                    element = document.createElement('ul');\n                    element.innerHTML = '<li>Elemento 1</li><li>Elemento 2</li><li>Elemento 3</li>';\n                    element.style.paddingLeft = '20px';\n                    break;\n\n                case 'ol':\n                    element = document.createElement('ol');\n                    element.innerHTML = '<li>Elemento 1</li><li>Elemento 2</li><li>Elemento 3</li>';\n                    element.style.paddingLeft = '20px';\n                    break;\n\n                case 'img':\n                    element = document.createElement('img');\n                    element.src = 'https://via.placeholder.com/400x200';\n                    element.alt = 'Imagen';\n                    element.style.maxWidth = '100%';\n                    element.style.display = 'block';\n                    break;\n\n                case 'video':\n                    element = document.createElement('video');\n                    element.controls = true;\n                    element.style.width = '100%';\n                    element.style.maxWidth = '600px';\n                    element.innerHTML = '<source src=\"\" type=\"video/mp4\">';\n                    break;\n\n                case 'iframe':\n                    element = document.createElement('iframe');\n                    element.src = '';\n                    element.style.width = '100%';\n                    element.style.height = '400px';\n                    element.style.border = '1px solid #ccc';\n                    break;\n\n                case 'input':\n                    element = document.createElement('input');\n                    element.type = 'text';\n                    element.placeholder = 'Escribe aqu√≠...';\n                    element.style.padding = '10px';\n                    element.style.border = '1px solid #ccc';\n                    element.style.borderRadius = '4px';\n                    element.style.width = '100%';\n                    break;\n\n                case 'textarea':\n                    element = document.createElement('textarea');\n                    element.placeholder = 'Escribe aqu√≠...';\n                    element.style.padding = '10px';\n                    element.style.border = '1px solid #ccc';\n                    element.style.borderRadius = '4px';\n                    element.style.width = '100%';\n                    element.style.minHeight = '100px';\n                    element.style.fontFamily = 'inherit';\n                    break;\n\n                case 'button':\n                    element = document.createElement('button');\n                    element.textContent = 'Bot√≥n';\n                    element.style.padding = '10px 20px';\n                    element.style.background = '#64748b';\n                    element.style.color = 'white';\n                    element.style.border = 'none';\n                    element.style.borderRadius = '6px';\n                    element.style.cursor = 'pointer';\n                    break;\n\n                case 'checkbox':\n                    element = document.createElement('label');\n                    element.innerHTML = '<input type=\"checkbox\" style=\"margin-right: 8px;\">Opci√≥n checkbox';\n                    element.style.display = 'flex';\n                    element.style.alignItems = 'center';\n                    break;\n\n                case 'radio':\n                    element = document.createElement('label');\n                    element.innerHTML = '<input type=\"radio\" name=\"radio-group\" style=\"margin-right: 8px;\">Opci√≥n radio';\n                    element.style.display = 'flex';\n                    element.style.alignItems = 'center';\n                    break;\n\n                case 'select':\n                    element = document.createElement('select');\n                    element.innerHTML = '<option>Opci√≥n 1</option><option>Opci√≥n 2</option><option>Opci√≥n 3</option>';\n                    element.style.padding = '10px';\n                    element.style.border = '1px solid #ccc';\n                    element.style.borderRadius = '4px';\n                    element.style.width = '100%';\n                    break;\n\n                case 'btn-primary':\n                    element = document.createElement('button');\n                    element.textContent = 'Bot√≥n Primario';\n                    element.style.padding = '12px 24px';\n                    element.style.background = '#2563eb';\n                    element.style.color = 'white';\n                    element.style.border = 'none';\n                    element.style.borderRadius = '6px';\n                    element.style.cursor = 'pointer';\n                    element.style.fontWeight = '500';\n                    break;\n\n                case 'btn-secondary':\n                    element = document.createElement('button');\n                    element.textContent = 'Bot√≥n Secundario';\n                    element.style.padding = '12px 24px';\n                    element.style.background = 'white';\n                    element.style.color = '#1e293b';\n                    element.style.border = '1px solid #e2e8f0';\n                    element.style.borderRadius = '6px';\n                    element.style.cursor = 'pointer';\n                    element.style.fontWeight = '500';\n                    break;\n\n                case 'card':\n                    element = document.createElement('div');\n                    element.className = 'component-card';\n                    element.innerHTML = `\n                        <img src=\"https://via.placeholder.com/400x200\" alt=\"Card image\" style=\"width: 100%; border-radius: 8px 8px 0 0;\">\n                        <div class=\"component-card-body\">\n                            <h3 style=\"margin: 0 0 10px 0;\">T√≠tulo de la Card</h3>\n                            <p style=\"margin: 0 0 15px 0; color: #64748b;\">Descripci√≥n de la tarjeta con informaci√≥n relevante.</p>\n                            <button style=\"background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;\">Leer m√°s</button>\n                        </div>\n                    `;\n                    break;\n\n                case 'navbar':\n                    element = document.createElement('nav');\n                    element.className = 'component-navbar';\n                    element.innerHTML = `\n                        <div class=\"component-navbar-brand\">Logo</div>\n                        <ul class=\"component-navbar-nav\">\n                            <li><a href=\"#\">Inicio</a></li>\n                            <li><a href=\"#\">Servicios</a></li>\n                            <li><a href=\"#\">Contacto</a></li>\n                        </ul>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'footer':\n                    element = document.createElement('footer');\n                    element.className = 'component-footer';\n                    element.innerHTML = `\n                        <p style=\"margin: 0 0 10px 0;\">&copy; 2025 Mi Sitio Web</p>\n                        <p style=\"margin: 0; color: #94a3b8;\">Todos los derechos reservados</p>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'hero':\n                    element = document.createElement('section');\n                    element.className = 'component-hero';\n                    element.innerHTML = `\n                        <h1 style=\"margin: 0 0 20px 0; font-size: 3rem;\">Bienvenido</h1>\n                        <p style=\"margin: 0 0 30px 0; font-size: 1.25rem; max-width: 600px;\">Crea p√°ginas web incre√≠bles con nuestro editor visual</p>\n                        <button style=\"background: white; color: #667eea; padding: 12px 32px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 1rem;\">Comenzar</button>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'tabs':\n                    element = document.createElement('div');\n                    element.innerHTML = `\n                        <div class=\"tabs-container\" style=\"width: 100%;\">\n                            <div class=\"tabs-nav\" style=\"display: flex; border-bottom: 1px solid #e2e8f0;\">\n                                <button class=\"tab-btn active\" style=\"padding: 12px 20px; border: none; background: #f1f5f9; cursor: pointer; border-bottom: 2px solid #2563eb; font-weight: 500; color: #2563eb;\">Pesta√±a 1</button>\n                                <button class=\"tab-btn\" style=\"padding: 12px 20px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid transparent;\">Pesta√±a 2</button>\n                                <button class=\"tab-btn\" style=\"padding: 12px 20px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid transparent;\">Pesta√±a 3</button>\n                            </div>\n                            <div class=\"tab-content\" style=\"padding: 20px; border: 1px solid #e2e8f0; border-top: none;\">\n                                <p>Contenido de la primera pesta√±a</p>\n                            </div>\n                        </div>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'accordion':\n                    element = document.createElement('div');\n                    element.innerHTML = `\n                        <div class=\"accordion-item\" style=\"border: 1px solid #e2e8f0; border-bottom: none;\">\n                            <div class=\"accordion-header\" style=\"padding: 16px 20px; background: #f8fafc; cursor: pointer; font-weight: 500; border-bottom: 1px solid #e2e8f0;\">\n                                <span style=\"display: flex; justify-content: space-between; align-items: center; width: 100%;\">Pregunta frecuente 1</span>\n                            </div>\n                            <div class=\"accordion-content\" style=\"padding: 20px; display: block;\">\n                                <p>Respuesta a la primera pregunta frecuente.</p>\n                            </div>\n                        </div>\n                        <div class=\"accordion-item\" style=\"border: 1px solid #e2e8f0; border-bottom: none;\">\n                            <div class=\"accordion-header\" style=\"padding: 16px 20px; background: #f8fafc; cursor: pointer; font-weight: 500; border-bottom: 1px solid #e2e8f0;\">\n                                <span style=\"display: flex; justify-content: space-between; align-items: center; width: 100%;\">Pregunta frecuente 2</span>\n                            </div>\n                            <div class=\"accordion-content\" style=\"padding: 20px; display: none;\">\n                                <p>Respuesta a la segunda pregunta frecuente.</p>\n                            </div>\n                        </div>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'modal':\n                    element = document.createElement('div');\n                    element.innerHTML = `\n                        <button class=\"modal-trigger\" style=\"padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer;\">Abrir Modal</button>\n                        <div class=\"modal\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000;\">\n                            <div class=\"modal-content\" style=\"background: white; padding: 30px; border-radius: 8px; width: 500px; position: relative; max-width: 90%;\">\n                                <button class=\"modal-close\" style=\"position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer;\">&times;</button>\n                                <h3 style=\"margin: 0 0 15px 0;\">T√≠tulo del Modal</h3>\n                                <p style=\"margin: 0 0 20px 0;\">Contenido del modal aqu√≠.</p>\n                                <button class=\"modal-btn\" style=\"padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;\">Aceptar</button>\n                            </div>\n                        </div>\n                    `;\n                    break;\n\n                case 'carousel':\n                    element = document.createElement('div');\n                    element.innerHTML = `\n                        <div class=\"carousel-container\" style=\"width: 100%; overflow: hidden; position: relative;\">\n                            <div class=\"carousel-slides\" style=\"display: flex; transition: transform 0.3s ease;\">\n                                <div style=\"min-width: 100%; padding: 20px; text-align: center; background: #f1f5f9;\">\n                                    <h4>Diapositiva 1</h4>\n                                    <p>Contenido de la primera diapositiva</p>\n                                </div>\n                                <div style=\"min-width: 100%; padding: 20px; text-align: center; background: #e2e8f0;\">\n                                    <h4>Diapositiva 2</h4>\n                                    <p>Contenido de la segunda diapositiva</p>\n                                </div>\n                                <div style=\"min-width: 100%; padding: 20px; text-align: center; background: #cbd5e1;\">\n                                    <h4>Diapositiva 3</h4>\n                                    <p>Contenido de la tercera diapositiva</p>\n                                </div>\n                            </div>\n                            <button class=\"carousel-prev\" style=\"position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: white; border: 1px solid #cbd5e1; border-radius: 50%; width: 40px; height: 40px; cursor: pointer;\">‚Üê</button>\n                            <button class=\"carousel-next\" style=\"position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: white; border: 1px solid #cbd5e1; border-radius: 50%; width: 40px; height: 40px; cursor: pointer;\">‚Üí</button>\n                        </div>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'alert':\n                    element = document.createElement('div');\n                    element.innerHTML = `\n                        <div class=\"alert alert-info\" style=\"padding: 16px; border-radius: 6px; border-left: 4px solid #3b82f6; background: #dbeafe; color: #1e3a8a; display: flex; align-items: center;\">\n                            <span style=\"margin-right: 12px;\">‚ÑπÔ∏è</span>\n                            <span>Este es un mensaje de informaci√≥n</span>\n                        </div>\n                    `;\n                    element.style.width = '100%';\n                    break;\n\n                case 'badge':\n                    element = document.createElement('span');\n                    element.innerHTML = 'Badge';\n                    element.style.backgroundColor = '#2563eb';\n                    element.style.color = 'white';\n                    element.style.padding = '4px 12px';\n                    element.style.borderRadius = '12px';\n                    element.style.fontSize = '12px';\n                    element.style.fontWeight = 'bold';\n                    break;\n\n                default:\n                    element = document.createElement('div');\n                    element.textContent = 'Elemento';\n            }\n\n            // Configurar elemento\n            element.id = id;\n            element.classList.add('canvas-element');\n            element.setAttribute('data-component-type', type);\n\n            // Agregar bot√≥n de eliminar\n            const deleteBtn = document.createElement('div');\n            deleteBtn.className = 'delete-btn';\n            deleteBtn.textContent = '√ó';\n            deleteBtn.onclick = function(e) {\n                e.stopPropagation();\n                deleteElement(element);\n            };\n            element.appendChild(deleteBtn);\n\n            // Eventos\n            element.addEventListener('click', function(e) {\n                e.stopPropagation();\n                selectElement(element);\n            });\n\n            element.addEventListener('dblclick', function(e) {\n                e.stopPropagation();\n                makeElementEditable(element);\n            });\n\n            // Configurar drag & drop para movimiento de elementos\n            setupElementDragAndDrop(element);\n\n            // Manejar eventos especiales para componentes avanzados\n            if (type === 'tabs') {\n                setupTabs(element);\n            } else if (type === 'accordion') {\n                setupAccordion(element);\n            } else if (type === 'modal') {\n                setupModal(element);\n            } else if (type === 'carousel') {\n                setupCarousel(element);\n            }\n\n            return element;\n        }\n\n        // ===== SISTEMA DE DRAG & DROP PARA ELEMENTOS DEL CANVAS =====\n        \n        let draggedCanvasElement = null;\n        let dropIndicator = null;\n\n        // Configurar drag & drop para un elemento del canvas\n        function setupElementDragAndDrop(element) {\n            // Hacer el elemento arrastrable\n            element.draggable = true;\n            \n            // Eventos de drag para el elemento\n            element.addEventListener('dragstart', function(e) {\n                // Solo permitir arrastre si el elemento est√° seleccionado\n                if (!element.classList.contains('selected')) {\n                    e.preventDefault();\n                    return;\n                }\n                \n                draggedCanvasElement = element;\n                e.dataTransfer.effectAllowed = 'move';\n                e.dataTransfer.setData('text/html', element.outerHTML);\n                \n                // Agregar clase visual durante el arrastre\n                element.classList.add('dragging-canvas-element');\n                \n                // Crear indicador de drop\n                createDropIndicator();\n                \n                // Configurar imagen de arrastre transparente\n                const img = document.createElement('img');\n                img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n                e.dataTransfer.setDragImage(img, 0, 0);\n            });\n\n            element.addEventListener('dragend', function(e) {\n                element.classList.remove('dragging-canvas-element');\n                draggedCanvasElement = null;\n                removeDropIndicator();\n                clearDropZones();\n            });\n\n            // Eventos de drop para recibir elementos\n            element.addEventListener('dragover', function(e) {\n                if (draggedCanvasElement && draggedCanvasElement !== element) {\n                    e.preventDefault();\n                    e.dataTransfer.dropEffect = 'move';\n                    \n                    // Determinar posici√≥n de inserci√≥n\n                    const rect = element.getBoundingClientRect();\n                    const midY = rect.top + rect.height / 2;\n                    const isAfter = e.clientY > midY;\n                    \n                    showDropIndicator(element, isAfter);\n                }\n            });\n\n            element.addEventListener('dragleave', function(e) {\n                // Solo ocultar si realmente salimos del elemento\n                const rect = element.getBoundingClientRect();\n                if (e.clientX < rect.left || e.clientX > rect.right || \n                    e.clientY < rect.top || e.clientY > rect.bottom) {\n                    hideDropIndicator();\n                }\n            });\n\n            element.addEventListener('drop', function(e) {\n                if (draggedCanvasElement && draggedCanvasElement !== element) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    \n                    // Determinar posici√≥n de inserci√≥n\n                    const rect = element.getBoundingClientRect();\n                    const midY = rect.top + rect.height / 2;\n                    const isAfter = e.clientY > midY;\n                    \n                    // Realizar el movimiento\n                    moveElement(draggedCanvasElement, element, isAfter);\n                    \n                    showToast('Elemento movido');\n                }\n            });\n        }\n\n        // Crear indicador visual de drop\n        function createDropIndicator() {\n            if (!dropIndicator) {\n                dropIndicator = document.createElement('div');\n                dropIndicator.className = 'drop-indicator';\n                dropIndicator.style.cssText = `\n                    position: absolute;\n                    height: 3px;\n                    background: #3b82f6;\n                    border-radius: 2px;\n                    z-index: 1000;\n                    display: none;\n                    box-shadow: 0 0 6px rgba(59, 130, 246, 0.5);\n                `;\n                document.body.appendChild(dropIndicator);\n            }\n        }\n\n        // Mostrar indicador de drop en posici√≥n espec√≠fica\n        function showDropIndicator(targetElement, isAfter) {\n            if (!dropIndicator) return;\n            \n            const rect = targetElement.getBoundingClientRect();\n            const canvasRect = document.getElementById('canvas').getBoundingClientRect();\n            \n            dropIndicator.style.display = 'block';\n            dropIndicator.style.left = (rect.left - canvasRect.left + 10) + 'px';\n            dropIndicator.style.width = (rect.width - 20) + 'px';\n            \n            if (isAfter) {\n                dropIndicator.style.top = (rect.bottom - canvasRect.top - 1) + 'px';\n            } else {\n                dropIndicator.style.top = (rect.top - canvasRect.top - 2) + 'px';\n            }\n        }\n\n        // Ocultar indicador de drop\n        function hideDropIndicator() {\n            if (dropIndicator) {\n                dropIndicator.style.display = 'none';\n            }\n        }\n\n        // Remover indicador de drop\n        function removeDropIndicator() {\n            if (dropIndicator) {\n                dropIndicator.remove();\n                dropIndicator = null;\n            }\n        }\n\n        // Limpiar zonas de drop\n        function clearDropZones() {\n            const elements = document.querySelectorAll('.canvas-element');\n            elements.forEach(el => {\n                el.classList.remove('drop-zone-active');\n            });\n        }\n\n        // Mover elemento a nueva posici√≥n\n        function moveElement(draggedElement, targetElement, insertAfter) {\n            const parent = targetElement.parentNode;\n            \n            // Validar que no estamos moviendo un padre dentro de su hijo\n            if (isDescendant(draggedElement, targetElement)) {\n                showToast('No se puede mover un elemento dentro de s√≠ mismo', 'error');\n                return;\n            }\n            \n            // Realizar el movimiento\n            if (insertAfter) {\n                // Insertar despu√©s del elemento objetivo\n                if (targetElement.nextSibling) {\n                    parent.insertBefore(draggedElement, targetElement.nextSibling);\n                } else {\n                    parent.appendChild(draggedElement);\n                }\n            } else {\n                // Insertar antes del elemento objetivo\n                parent.insertBefore(draggedElement, targetElement);\n            }\n            \n            // Mantener selecci√≥n en el elemento movido\n            selectElement(draggedElement);\n        }\n\n        // Verificar si un elemento es descendiente de otro\n        function isDescendant(parent, child) {\n            let node = child.parentNode;\n            while (node != null) {\n                if (node === parent) {\n                    return true;\n                }\n                node = node.parentNode;\n            }\n            return false;\n        }\n\n        // Configurar drag & drop para el canvas (para elementos desde el panel)\n        function setupCanvasDropForMovement() {\n            const canvas = document.getElementById('canvas');\n            \n            canvas.addEventListener('dragover', function(e) {\n                // Solo para elementos del canvas, no del panel de componentes\n                if (draggedCanvasElement) {\n                    e.preventDefault();\n                    e.dataTransfer.dropEffect = 'move';\n                }\n            });\n\n            canvas.addEventListener('drop', function(e) {\n                if (draggedCanvasElement) {\n                    e.preventDefault();\n                    \n                    // Si se suelta en el canvas vac√≠o, mover al final\n                    if (e.target === canvas) {\n                        canvas.appendChild(draggedCanvasElement);\n                        selectElement(draggedCanvasElement);\n                        showToast('Elemento movido al final');\n                    }\n                }\n            });\n        }\n\n        // Setup para componentes de pesta√±as\n        function setupTabs(element) {\n            const tabButtons = element.querySelectorAll('.tab-btn');\n            tabButtons.forEach((btn, index) => {\n                btn.addEventListener('click', function() {\n                    // Remover la clase activa de todos los botones\n                    tabButtons.forEach(b => b.classList.remove('active'));\n                    // Agregar clase activa al bot√≥n clickeado\n                    this.classList.add('active');\n                    \n                    // Aqu√≠ se manejar√≠a el cambio de contenido de pesta√±as en un entorno real\n                });\n            });\n        }\n\n        // Setup para componentes de acorde√≥n\n        function setupAccordion(element) {\n            const accordionHeaders = element.querySelectorAll('.accordion-header');\n            accordionHeaders.forEach(header => {\n                header.addEventListener('click', function() {\n                    const content = this.nextElementSibling;\n                    if (content.style.display === 'none' || content.style.display === '') {\n                        content.style.display = 'block';\n                    } else {\n                        content.style.display = 'none';\n                    }\n                });\n            });\n        }\n\n        // Setup para componentes de modal\n        function setupModal(element) {\n            const modal = element.querySelector('.modal');\n            const trigger = element.querySelector('.modal-trigger');\n            const closeBtn = element.querySelector('.modal-close');\n            const modalBtn = element.querySelector('.modal-btn');\n\n            trigger.addEventListener('click', function(e) {\n                e.stopPropagation();\n                modal.style.display = 'flex';\n            });\n\n            function closeModal() {\n                modal.style.display = 'none';\n            }\n\n            closeBtn.addEventListener('click', closeModal);\n            modalBtn.addEventListener('click', closeModal);\n\n            // Cerrar al hacer clic fuera del contenido\n            modal.addEventListener('click', function(e) {\n                if (e.target === modal) {\n                    closeModal();\n                }\n            });\n        }\n\n        // Setup para componentes de carrusel\n        function setupCarousel(element) {\n            const slidesContainer = element.querySelector('.carousel-slides');\n            const prevBtn = element.querySelector('.carousel-prev');\n            const nextBtn = element.querySelector('.carousel-next');\n            let currentSlide = 0;\n            const slides = element.querySelectorAll('.carousel-slides > div');\n\n            function updateCarousel() {\n                slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;\n            }\n\n            prevBtn.addEventListener('click', function(e) {\n                e.stopPropagation();\n                if (currentSlide > 0) {\n                    currentSlide--;\n                    updateCarousel();\n                }\n            });\n\n            nextBtn.addEventListener('click', function(e) {\n                e.stopPropagation();\n                if (currentSlide < slides.length - 1) {\n                    currentSlide++;\n                    updateCarousel();\n                }\n            });\n        }\n\n        // Seleccionar elemento\n        function selectElement(element) {\n            // Deseleccionar anterior\n            if (selectedElement) {\n                selectedElement.classList.remove('selected');\n                // Deshabilitar resize\n                if (window.resizeManager) {\n                    window.resizeManager.disableResize(selectedElement);\n                }\n            }\n\n            // Seleccionar nuevo\n            selectedElement = element;\n            element.classList.add('selected');\n\n            // Habilitar resize\n            if (window.resizeManager) {\n                window.resizeManager.enableResize(element);\n            }\n\n            // Habilitar drag mejorado\n            if (window.enhancedDragDrop) {\n                window.enhancedDragDrop.setupCanvasElementDrag(element);\n            }\n\n            // Validar sintaxis con Gemini (si est√° habilitado)\n            if (window.geminiValidator && window.geminiValidator.isEnabled()) {\n                validateElementSyntax(element);\n            }\n\n            // Cargar propiedades\n            loadProperties(element);\n        }\n        \n        // Validar sintaxis de elemento con Gemini\n        async function validateElementSyntax(element) {\n            try {\n                const result = await window.geminiValidator.validateElement(element, {\n                    parent: element.parentElement?.tagName || 'body'\n                });\n                \n                if (result && result.hasChanges) {\n                    window.geminiValidator.showCorrectionSuggestion(element, result);\n                }\n            } catch (error) {\n                console.error('Error validando sintaxis:', error);\n            }\n        }\n\n        // Cargar propiedades en el panel\n        function loadProperties(element) {\n            const panel = document.getElementById('propertiesPanel');\n            const tagName = element.tagName.toLowerCase();\n            const computedStyle = window.getComputedStyle(element);\n\n            let html = '<h2 class=\"panel-title\">Propiedades</h2>';\n\n            // Secci√≥n General\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">General</div>';\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Tag HTML</label>\n                        <input class=\"property-input\" value=\"${tagName}\" readonly>\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">ID</label>\n                        <input class=\"property-input\" value=\"${element.id}\" onchange=\"updateAttribute('id', this.value)\">\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Clases CSS</label>\n                        <input class=\"property-input\" value=\"${element.className.replace('canvas-element', '').replace('selected', '').trim()}\" onchange=\"updateAttribute('class', this.value)\">\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Dimensiones\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Dimensiones</div>';\n            html += `<div class=\"property-grid\">\n                        <div class=\"property-group\">\n                            <label class=\"property-label\">Ancho</label>\n                            <input class=\"property-input\" value=\"${element.style.width || 'auto'}\" onchange=\"updateStyle('width', this.value)\">\n                        </div>\n                        <div class=\"property-group\">\n                            <label class=\"property-label\">Alto</label>\n                            <input class=\"property-input\" value=\"${element.style.height || 'auto'}\" onchange=\"updateStyle('height', this.value)\">\n                        </div>\n                     </div>`;\n            html += `<div class=\"property-grid\">\n                        <div class=\"property-group\">\n                            <label class=\"property-label\">Ancho M√°ximo</label>\n                            <input class=\"property-input\" value=\"${element.style.maxWidth || ''}\" onchange=\"updateStyle('maxWidth', this.value)\">\n                        </div>\n                        <div class=\"property-group\">\n                            <label class=\"property-label\">Alto M√°ximo</label>\n                            <input class=\"property-input\" value=\"${element.style.maxHeight || ''}\" onchange=\"updateStyle('maxHeight', this.value)\">\n                        </div>\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Espaciado\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Espaciado</div>';\n            html += '<div class=\"property-group\">';\n            html += '<label class=\"property-label\">Padding (px)</label>';\n            html += '<div class=\"property-grid-4\">';\n            html += `<input class=\"property-input\" placeholder=\"Top\" value=\"${element.style.paddingTop.replace('px', '')}\" onchange=\"updateStyle('paddingTop', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Right\" value=\"${element.style.paddingRight.replace('px', '')}\" onchange=\"updateStyle('paddingRight', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Bottom\" value=\"${element.style.paddingBottom.replace('px', '')}\" onchange=\"updateStyle('paddingBottom', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Left\" value=\"${element.style.paddingLeft.replace('px', '')}\" onchange=\"updateStyle('paddingLeft', this.value + 'px')\">`;\n            html += '</div></div>';\n            html += '<div class=\"property-group\">';\n            html += '<label class=\"property-label\">Margin (px)</label>';\n            html += '<div class=\"property-grid-4\">';\n            html += `<input class=\"property-input\" placeholder=\"Top\" value=\"${element.style.marginTop.replace('px', '')}\" onchange=\"updateStyle('marginTop', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Right\" value=\"${element.style.marginRight.replace('px', '')}\" onchange=\"updateStyle('marginRight', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Bottom\" value=\"${element.style.marginBottom.replace('px', '')}\" onchange=\"updateStyle('marginBottom', this.value + 'px')\">`;\n            html += `<input class=\"property-input\" placeholder=\"Left\" value=\"${element.style.marginLeft.replace('px', '')}\" onchange=\"updateStyle('marginLeft', this.value + 'px')\">`;\n            html += '</div></div>';\n            html += '</div>';\n\n            // Secci√≥n Posicionamiento\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Posicionamiento</div>';\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Display</label>\n                        <select class=\"property-input\" onchange=\"updateStyle('display', this.value)\">\n                            <option value=\"block\" ${element.style.display === 'block' ? 'selected' : ''}>Block</option>\n                            <option value=\"inline-block\" ${element.style.display === 'inline-block' ? 'selected' : ''}>Inline-block</option>\n                            <option value=\"flex\" ${element.style.display === 'flex' ? 'selected' : ''}>Flex</option>\n                            <option value=\"grid\" ${element.style.display === 'grid' ? 'selected' : ''}>Grid</option>\n                            <option value=\"none\" ${element.style.display === 'none' ? 'selected' : ''}>None</option>\n                        </select>\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Position</label>\n                        <select class=\"property-input\" onchange=\"updateStyle('position', this.value)\">\n                            <option value=\"static\" ${element.style.position === 'static' || !element.style.position ? 'selected' : ''}>Static</option>\n                            <option value=\"relative\" ${element.style.position === 'relative' ? 'selected' : ''}>Relative</option>\n                            <option value=\"absolute\" ${element.style.position === 'absolute' ? 'selected' : ''}>Absolute</option>\n                            <option value=\"fixed\" ${element.style.position === 'fixed' ? 'selected' : ''}>Fixed</option>\n                        </select>\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Tipograf√≠a (solo para elementos de texto)\n            if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span', 'a', 'button', 'label'].includes(tagName)) {\n                html += '<div class=\"property-section\">';\n                html += '<div class=\"section-title\">Tipograf√≠a</div>';\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Font Size</label>\n                            <input class=\"property-input\" value=\"${element.style.fontSize || ''}\" onchange=\"updateStyle('fontSize', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Font Weight</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('fontWeight', this.value)\">\n                                <option value=\"normal\" ${element.style.fontWeight === 'normal' || element.style.fontWeight === '400' ? 'selected' : ''}>Normal</option>\n                                <option value=\"500\" ${element.style.fontWeight === '500' ? 'selected' : ''}>Medium</option>\n                                <option value=\"600\" ${element.style.fontWeight === '600' ? 'selected' : ''}>Semibold</option>\n                                <option value=\"bold\" ${element.style.fontWeight === 'bold' || element.style.fontWeight === '700' ? 'selected' : ''}>Bold</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Color</label>\n                            <input type=\"color\" class=\"property-input\" value=\"${rgbToHex(element.style.color || '#000000')}\" onchange=\"updateStyle('color', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Text Align</label>\n                            <div class=\"text-align-buttons\">\n                                <button class=\"text-align-btn ${element.style.textAlign === 'left' ? 'active' : ''}\" onclick=\"updateStyle('textAlign', 'left')\">L</button>\n                                <button class=\"text-align-btn ${element.style.textAlign === 'center' ? 'active' : ''}\" onclick=\"updateStyle('textAlign', 'center')\">C</button>\n                                <button class=\"text-align-btn ${element.style.textAlign === 'right' ? 'active' : ''}\" onclick=\"updateStyle('textAlign', 'right')\">R</button>\n                                <button class=\"text-align-btn ${element.style.textAlign === 'justify' ? 'active' : ''}\" onclick=\"updateStyle('textAlign', 'justify')\">J</button>\n                            </div>\n                         </div>`;\n                html += '</div>';\n            }\n\n            // Secci√≥n Fondo y Bordes\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Fondo y Bordes</div>';\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Background Color</label>\n                        <input type=\"color\" class=\"property-input\" value=\"${rgbToHex(element.style.backgroundColor || '#ffffff')}\" onchange=\"updateStyle('backgroundColor', this.value)\">\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Border Width (px)</label>\n                        <input class=\"property-input\" value=\"${element.style.borderWidth.replace('px', '')}\" onchange=\"updateStyle('borderWidth', this.value + 'px')\">\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Border Style</label>\n                        <select class=\"property-input\" onchange=\"updateStyle('borderStyle', this.value)\">\n                            <option value=\"none\" ${element.style.borderStyle === 'none' ? 'selected' : ''}>None</option>\n                            <option value=\"solid\" ${element.style.borderStyle === 'solid' ? 'selected' : ''}>Solid</option>\n                            <option value=\"dashed\" ${element.style.borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>\n                            <option value=\"dotted\" ${element.style.borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>\n                        </select>\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Border Color</label>\n                        <input type=\"color\" class=\"property-input\" value=\"${rgbToHex(element.style.borderColor || '#000000')}\" onchange=\"updateStyle('borderColor', this.value)\">\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Border Radius (px)</label>\n                        <input class=\"property-input\" value=\"${element.style.borderRadius.replace('px', '')}\" onchange=\"updateStyle('borderRadius', this.value + 'px')\">\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Sombra y Efectos\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Sombra y Efectos</div>';\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Box Shadow</label>\n                        <select class=\"property-input\" onchange=\"updateStyle('boxShadow', this.value)\">\n                            <option value=\"none\" ${element.style.boxShadow === 'none' ? 'selected' : ''}>Ninguna</option>\n                            <option value=\"0 1px 3px rgba(0,0,0,0.1)\" ${(element.style.boxShadow === '0 1px 3px rgba(0,0,0,0.1)' || element.style.boxShadow.includes('0 1px 3px')) ? 'selected' : ''}>Sutil</option>\n                            <option value=\"0 2px 6px rgba(0,0,0,0.15)\" ${(element.style.boxShadow === '0 2px 6px rgba(0,0,0,0.15)' || element.style.boxShadow.includes('0 2px 6px')) ? 'selected' : ''}>Media</option>\n                            <option value=\"0 4px 12px rgba(0,0,0,0.15)\" ${(element.style.boxShadow === '0 4px 12px rgba(0,0,0,0.15)' || element.style.boxShadow.includes('0 4px 12px')) ? 'selected' : ''}>Fuerte</option>\n                        </select>\n                     </div>`;\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Opacity</label>\n                        <input type=\"range\" min=\"0\" max=\"100\" value=\"${element.style.opacity ? parseFloat(element.style.opacity) * 100 : '100'}\" class=\"property-input\" onchange=\"updateStyle('opacity', this.value / 100)\">\n                        <div style=\"font-size: 12px; color: #64748b; text-align: right;\">${element.style.opacity ? Math.round(parseFloat(element.style.opacity) * 100) : '100'}%</div>\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Flexbox (si display es flex)\n            if (element.style.display === 'flex') {\n                html += '<div class=\"property-section\">';\n                html += '<div class=\"section-title\">Flexbox</div>';\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Flex Direction</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('flexDirection', this.value)\">\n                                <option value=\"row\" ${element.style.flexDirection === 'row' ? 'selected' : ''}>Row</option>\n                                <option value=\"column\" ${element.style.flexDirection === 'column' ? 'selected' : ''}>Column</option>\n                                <option value=\"row-reverse\" ${element.style.flexDirection === 'row-reverse' ? 'selected' : ''}>Row Reverse</option>\n                                <option value=\"column-reverse\" ${element.style.flexDirection === 'column-reverse' ? 'selected' : ''}>Column Reverse</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Justify Content</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('justifyContent', this.value)\">\n                                <option value=\"flex-start\" ${element.style.justifyContent === 'flex-start' ? 'selected' : ''}>Flex Start</option>\n                                <option value=\"center\" ${element.style.justifyContent === 'center' ? 'selected' : ''}>Center</option>\n                                <option value=\"flex-end\" ${element.style.justifyContent === 'flex-end' ? 'selected' : ''}>Flex End</option>\n                                <option value=\"space-between\" ${element.style.justifyContent === 'space-between' ? 'selected' : ''}>Space Between</option>\n                                <option value=\"space-around\" ${element.style.justifyContent === 'space-around' ? 'selected' : ''}>Space Around</option>\n                                <option value=\"space-evenly\" ${element.style.justifyContent === 'space-evenly' ? 'selected' : ''}>Space Evenly</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Align Items</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('alignItems', this.value)\">\n                                <option value=\"flex-start\" ${element.style.alignItems === 'flex-start' ? 'selected' : ''}>Flex Start</option>\n                                <option value=\"center\" ${element.style.alignItems === 'center' ? 'selected' : ''}>Center</option>\n                                <option value=\"flex-end\" ${element.style.alignItems === 'flex-end' ? 'selected' : ''}>Flex End</option>\n                                <option value=\"stretch\" ${element.style.alignItems === 'stretch' ? 'selected' : ''}>Stretch</option>\n                                <option value=\"baseline\" ${element.style.alignItems === 'baseline' ? 'selected' : ''}>Baseline</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Align Content</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('alignContent', this.value)\">\n                                <option value=\"flex-start\" ${element.style.alignContent === 'flex-start' ? 'selected' : ''}>Flex Start</option>\n                                <option value=\"center\" ${element.style.alignContent === 'center' ? 'selected' : ''}>Center</option>\n                                <option value=\"flex-end\" ${element.style.alignContent === 'flex-end' ? 'selected' : ''}>Flex End</option>\n                                <option value=\"space-between\" ${element.style.alignContent === 'space-between' ? 'selected' : ''}>Space Between</option>\n                                <option value=\"space-around\" ${element.style.alignContent === 'space-around' ? 'selected' : ''}>Space Around</option>\n                                <option value=\"stretch\" ${element.style.alignContent === 'stretch' ? 'selected' : ''}>Stretch</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Gap (px)</label>\n                            <input class=\"property-input\" value=\"${element.style.gap.replace('px', '')}\" onchange=\"updateStyle('gap', this.value + 'px')\">\n                         </div>`;\n                html += '</div>';\n            }\n\n            // Secci√≥n Grid (si display es grid)\n            if (element.style.display === 'grid') {\n                html += '<div class=\"property-section\">';\n                html += '<div class=\"section-title\">Grid</div>';\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Grid Template Columns</label>\n                            <input class=\"property-input\" value=\"${element.style.gridTemplateColumns || ''}\" placeholder=\"1fr 1fr\" onchange=\"updateStyle('gridTemplateColumns', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Grid Template Rows</label>\n                            <input class=\"property-input\" value=\"${element.style.gridTemplateRows || ''}\" placeholder=\"auto auto\" onchange=\"updateStyle('gridTemplateRows', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Grid Gap (px)</label>\n                            <input class=\"property-input\" value=\"${element.style.gridGap.replace('px', '') || '0'}\" onchange=\"updateStyle('gridGap', this.value + 'px')\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Justify Items</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('justifyItems', this.value)\">\n                                <option value=\"stretch\" ${element.style.justifyItems === 'stretch' ? 'selected' : ''}>Stretch</option>\n                                <option value=\"center\" ${element.style.justifyItems === 'center' ? 'selected' : ''}>Center</option>\n                                <option value=\"start\" ${element.style.justifyItems === 'start' ? 'selected' : ''}>Start</option>\n                                <option value=\"end\" ${element.style.justifyItems === 'end' ? 'selected' : ''}>End</option>\n                            </select>\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Align Items</label>\n                            <select class=\"property-input\" onchange=\"updateStyle('alignItems', this.value)\">\n                                <option value=\"stretch\" ${element.style.alignItems === 'stretch' ? 'selected' : ''}>Stretch</option>\n                                <option value=\"center\" ${element.style.alignItems === 'center' ? 'selected' : ''}>Center</option>\n                                <option value=\"start\" ${element.style.alignItems === 'start' ? 'selected' : ''}>Start</option>\n                                <option value=\"end\" ${element.style.alignItems === 'end' ? 'selected' : ''}>End</option>\n                            </select>\n                         </div>`;\n                html += '</div>';\n            }\n\n            // Secci√≥n Transiciones y Animaciones\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Transiciones</div>';\n            html += `<div class=\"property-group\">\n                        <label class=\"property-label\">Transition</label>\n                        <select class=\"property-input\" onchange=\"updateStyle('transition', this.value)\">\n                            <option value=\"\" ${!element.style.transition ? 'selected' : ''}>Ninguna</option>\n                            <option value=\"all 0.3s ease\" ${element.style.transition === 'all 0.3s ease' ? 'selected' : ''}>Suave (0.3s)</option>\n                            <option value=\"all 0.5s ease\" ${element.style.transition === 'all 0.5s ease' ? 'selected' : ''}>Lenta (0.5s)</option>\n                        </select>\n                     </div>`;\n            html += '</div>';\n\n            // Secci√≥n Atributos Espec√≠ficos\n            html += '<div class=\"property-section\">';\n            html += '<div class=\"section-title\">Atributos</div>';\n\n            if (tagName === 'img') {\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Src</label>\n                            <input class=\"property-input\" value=\"${element.src}\" onchange=\"updateAttribute('src', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Alt</label>\n                            <input class=\"property-input\" value=\"${element.alt}\" onchange=\"updateAttribute('alt', this.value)\">\n                         </div>`;\n            } else if (tagName === 'a') {\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Href</label>\n                            <input class=\"property-input\" value=\"${element.href || ''}\" onchange=\"updateAttribute('href', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Target</label>\n                            <select class=\"property-input\" onchange=\"updateAttribute('target', this.value)\">\n                                <option value=\"_self\" ${element.target === '_self' || !element.target ? 'selected' : ''}>Same Window</option>\n                                <option value=\"_blank\" ${element.target === '_blank' ? 'selected' : ''}>New Window</option>\n                            </select>\n                         </div>`;\n            } else if (tagName === 'input') {\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Type</label>\n                            <input class=\"property-input\" value=\"${element.type}\" onchange=\"updateAttribute('type', this.value)\">\n                         </div>`;\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Placeholder</label>\n                            <input class=\"property-input\" value=\"${element.placeholder}\" onchange=\"updateAttribute('placeholder', this.value)\">\n                         </div>`;\n            } else if (tagName === 'button') {\n                html += `<div class=\"property-group\">\n                            <label class=\"property-label\">Type</label>\n                            <select class=\"property-input\" onchange=\"updateAttribute('type', this.value)\">\n                                <option value=\"button\" ${element.type === 'button' ? 'selected' : ''}>Button</option>\n                                <option value=\"submit\" ${element.type === 'submit' ? 'selected' : ''}>Submit</option>\n                                <option value=\"reset\" ${element.type === 'reset' ? 'selected' : ''}>Reset</option>\n                            </select>\n                         </div>`;\n            }\n            html += '</div>';\n\n            panel.innerHTML = html;\n        }\n\n        // Actualizar estilo del elemento seleccionado\n        function updateStyle(property, value) {\n            if (selectedElement) {\n                selectedElement.style[property] = value;\n                // Recargar propiedades si cambia display\n                if (property === 'display') {\n                    loadProperties(selectedElement);\n                }\n            }\n        }\n\n        // Actualizar atributo del elemento seleccionado\n        function updateAttribute(attribute, value) {\n            if (selectedElement) {\n                if (attribute === 'class') {\n                    selectedElement.className = 'canvas-element selected ' + value;\n                } else {\n                    selectedElement.setAttribute(attribute, value);\n                }\n            }\n        }\n\n        // Hacer elemento editable\n        function makeElementEditable(element) {\n            const tagName = element.tagName.toLowerCase();\n\n            // Solo para elementos de texto\n            if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span', 'button', 'a', 'li', 'label'].includes(tagName)) {\n                element.contentEditable = true;\n                element.focus();\n\n                // Seleccionar todo el texto\n                const range = document.createRange();\n                range.selectNodeContents(element);\n                const selection = window.getSelection();\n                selection.removeAllRanges();\n                selection.addRange(range);\n\n                // Guardar cambios al salir\n                element.addEventListener('blur', function() {\n                    element.contentEditable = false;\n                }, { once: true });\n\n                element.addEventListener('keydown', function(e) {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        element.blur();\n                    }\n                });\n            }\n        }\n\n        // Eliminar elemento\n        function deleteElement(element) {\n            if (selectedElement === element) {\n                selectedElement = null;\n                document.getElementById('propertiesPanel').innerHTML = `\n                    <h2 class=\"panel-title\">Propiedades</h2>\n                    <div class=\"properties-empty\">\n                        ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                    </div>\n                `;\n            }\n            element.remove();\n        }\n\n        // Toggle categor√≠a\n        function toggleCategory(titleElement) {\n            titleElement.classList.toggle('collapsed');\n            const list = titleElement.nextElementSibling;\n            list.classList.toggle('collapsed');\n        }\n\n        // Cambiar tama√±o del canvas\n        function setCanvasSize(size) {\n            const wrapper = document.getElementById('canvasWrapper');\n            const buttons = ['btnDesktop', 'btnTablet', 'btnMobile'];\n\n            // Remover clases\n            wrapper.className = 'canvas-wrapper';\n            buttons.forEach(id => document.getElementById(id).classList.remove('active'));\n\n            // Aplicar nueva clase\n            if (size === 'tablet') {\n                wrapper.classList.add('tablet');\n                document.getElementById('btnTablet').classList.add('active');\n            } else if (size === 'mobile') {\n                wrapper.classList.add('mobile');\n                document.getElementById('btnMobile').classList.add('active');\n            } else {\n                document.getElementById('btnDesktop').classList.add('active');\n            }\n        }\n\n        // Nuevo proyecto\n        function newProject() {\n            if (confirm('¬øEst√°s seguro de que quieres crear un nuevo proyecto? Se perder√°n los cambios no guardados.')) {\n                document.getElementById('canvas').innerHTML = '';\n                selectedElement = null;\n                document.getElementById('propertiesPanel').innerHTML = `\n                    <h2 class=\"panel-title\">Propiedades</h2>\n                    <div class=\"properties-empty\">\n                        ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                    </div>\n                `;\n                showToast('Proyecto nuevo creado');\n            }\n        }\n\n        // Exportar HTML\n        function exportHTML() {\n            const canvas = document.getElementById('canvas');\n            const clone = canvas.cloneNode(true);\n\n            // Limpiar elementos del editor\n            const elements = clone.querySelectorAll('.canvas-element');\n            elements.forEach(el => {\n                el.classList.remove('canvas-element', 'selected');\n                const deleteBtn = el.querySelector('.delete-btn');\n                if (deleteBtn) deleteBtn.remove();\n                el.removeAttribute('draggable');\n                el.removeAttribute('data-component-type');\n            });\n\n            // Generar HTML completo\n            const html = `<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Mi P√°gina Web</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n</head>\n<body>\n${clone.innerHTML}\n</body>\n</html>`;\n\n            // Descargar archivo\n            const blob = new Blob([html], { type: 'text/html' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'index.html';\n            a.click();\n            URL.revokeObjectURL(url);\n\n            showToast('HTML exportado correctamente');\n        }\n\n        // Exportar todo como ZIP\n        function exportZip() {\n            // Primero generamos los contenidos\n            const canvas = document.getElementById('canvas');\n            const clone = canvas.cloneNode(true);\n\n            // Limpiar elementos del editor\n            const elements = clone.querySelectorAll('.canvas-element');\n            elements.forEach(el => {\n                el.classList.remove('canvas-element', 'selected');\n                const deleteBtn = el.querySelector('.delete-btn');\n                if (deleteBtn) deleteBtn.remove();\n                el.removeAttribute('draggable');\n                el.removeAttribute('data-component-type');\n            });\n\n            // CSS general\n            const css = `* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: system-ui, -apple-system, sans-serif;\n}\n\n/* Estilos de componentes */\n.component-card {\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n    max-width: 400px;\n}\n\n.component-card img {\n    width: 100%;\n    border-radius: 8px 8px 0 0;\n}\n\n.component-card-body {\n    padding: 20px;\n}\n\n.component-navbar {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px 32px;\n    background: #1e293b;\n    color: white;\n}\n\n.component-navbar-brand {\n    font-size: 1.5rem;\n    font-weight: bold;\n}\n\n.component-navbar-nav {\n    display: flex;\n    gap: 20px;\n    list-style: none;\n}\n\n.component-navbar-nav a {\n    color: white;\n    text-decoration: none;\n}\n\n.component-hero {\n    min-height: 400px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    text-align: center;\n    padding: 60px 20px;\n}\n\n.component-footer {\n    background: #1e293b;\n    color: white;\n    padding: 40px 20px;\n    text-align: center;\n}\n\n/* Estilos de componentes adicionales */\n.tabs-container {\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    overflow: hidden;\n}\n\n.tab-btn {\n    border: none;\n    background: transparent;\n    padding: 12px 20px;\n    cursor: pointer;\n    font-weight: 500;\n}\n\n.tab-btn.active {\n    border-bottom: 2px solid #2563eb;\n    color: #2563eb;\n    background: #f1f5f9;\n}\n\n.accordion-header {\n    background: #f8fafc;\n    padding: 16px 20px;\n    cursor: pointer;\n    border-bottom: 1px solid #e2e8f0;\n    font-weight: 500;\n}\n\n.accordion-content {\n    padding: 20px;\n}\n\n.modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0,0,0,0.5);\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 1000;\n}\n\n.modal-content {\n    background: white;\n    padding: 30px;\n    border-radius: 8px;\n    width: 500px;\n    position: relative;\n    max-width: 90%;\n}\n\n.modal-close {\n    position: absolute;\n    top: 10px;\n    right: 15px;\n    background: none;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n}\n\n.carousel-container {\n    overflow: hidden;\n    position: relative;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n}\n\n.carousel-slides {\n    display: flex;\n    transition: transform 0.3s ease;\n}\n\n.carousel-prev, .carousel-next {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    background: white;\n    border: 1px solid #cbd5e1;\n    border-radius: 50%;\n    width: 40px;\n    height: 40px;\n    cursor: pointer;\n    z-index: 10;\n}\n\n.carousel-prev {\n    left: 10px;\n}\n\n.carousel-next {\n    right: 10px;\n}\n\n.alert {\n    padding: 16px;\n    border-radius: 6px;\n    display: flex;\n    align-items: center;\n}\n\n.alert-info { border-left: 4px solid #3b82f6; background: #dbeafe; color: #1e3a8a; }\n.alert-success { border-left: 4px solid #10b981; background: #d1fae5; color: #065f46; }\n.alert-warning { border-left: 4px solid #f59e0b; background: #fef3c7; color: #92400e; }\n.alert-error { border-left: 4px solid #ef4444; background: #fee2e2; color: #991b1b; }\n\n.badge {\n    padding: 4px 12px;\n    border-radius: 12px;\n    font-size: 12px;\n    font-weight: bold;\n    display: inline-block;\n}\n`;\n\n            // HTML\n            const html = `<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Mi P√°gina Web</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <script src=\"script.js\"><\\/script>\n</head>\n<body>\n${clone.innerHTML}\n</body>\n</html>`;\n\n            // JavaScript para componentes interactivos\n            const js = `// Script para componentes interactivos\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Manejar pesta√±as\n    const tabButtons = document.querySelectorAll('.tab-btn');\n    tabButtons.forEach(btn => {\n        btn.addEventListener('click', function() {\n            // Remover la clase activa de todos los botones\n            tabButtons.forEach(b => b.classList.remove('active'));\n            // Agregar clase activa al bot√≥n clickeado\n            this.classList.add('active');\n        });\n    });\n\n    // Manejar acorde√≥n\n    const accordionHeaders = document.querySelectorAll('.accordion-header');\n    accordionHeaders.forEach(header => {\n        header.addEventListener('click', function() {\n            const content = this.nextElementSibling;\n            if (content.style.display === 'none' || content.style.display === '') {\n                content.style.display = 'block';\n            } else {\n                content.style.display = 'none';\n            }\n        });\n    });\n\n    // Manejar modales\n    const modalTriggers = document.querySelectorAll('.modal-trigger');\n    modalTriggers.forEach(trigger => {\n        const modal = trigger.nextElementSibling;\n        const closeBtn = modal.querySelector('.modal-close');\n        const modalBtn = modal.querySelector('.modal-btn');\n\n        trigger.addEventListener('click', function(e) {\n            e.preventDefault();\n            modal.style.display = 'flex';\n        });\n\n        function closeModal() {\n            modal.style.display = 'none';\n        }\n\n        closeBtn.addEventListener('click', closeModal);\n        modalBtn.addEventListener('click', closeModal);\n\n        // Cerrar al hacer clic fuera del contenido\n        modal.addEventListener('click', function(e) {\n            if (e.target === modal) {\n                closeModal();\n            }\n        });\n    });\n\n    // Manejar carrusel\n    const carousels = document.querySelectorAll('.carousel-container');\n    carousels.forEach(carousel => {\n        const slidesContainer = carousel.querySelector('.carousel-slides');\n        const prevBtn = carousel.querySelector('.carousel-prev');\n        const nextBtn = carousel.querySelector('.carousel-next');\n        let currentSlide = 0;\n        const slides = carousel.querySelectorAll('.carousel-slides > div');\n\n        function updateCarousel() {\n            slidesContainer.style.transform = \\`translateX(-\\${currentSlide * 100}%)\\`;\n        }\n\n        prevBtn.addEventListener('click', function(e) {\n            e.stopPropagation();\n            if (currentSlide > 0) {\n                currentSlide--;\n                updateCarousel();\n            }\n        });\n\n        nextBtn.addEventListener('click', function(e) {\n            e.stopPropagation();\n            if (currentSlide < slides.length - 1) {\n                currentSlide++;\n                updateCarousel();\n            }\n        });\n    });\n});\n`;\n\n            // Crear archivos y simular descarga\n            downloadFile('index.html', html);\n            downloadFile('styles.css', css);\n            downloadFile('script.js', js);\n            \n            showToast('Archivos exportados: index.html, styles.css, script.js');\n        }\n\n        // Funci√≥n auxiliar para descargar archivos\n        function downloadFile(filename, content) {\n            const blob = new Blob([content], { type: 'text/plain' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = filename;\n            a.click();\n            URL.revokeObjectURL(url);\n        }\n\n        // Guardar proyecto (versi√≥n mejorada)\n        function saveProject() {\n            try {\n                const project = enhancedProjectManager.saveCurrentProject();\n                showToast('Proyecto guardado en formato mejorado');\n            } catch (error) {\n                console.error('Error al guardar proyecto:', error);\n                showToast('Error al guardar proyecto', 'error');\n            }\n        }\n\n        // Cargar proyecto\n        function loadProject(event) {\n            const files = event.target.files;\n            if (!files || files.length === 0) return;\n\n            // Si es un solo archivo JSON, usar el gestor mejorado\n            if (files.length === 1 && files[0].name.endsWith('.json')) {\n                const file = files[0];\n                enhancedProjectManager.importProject(file)\n                    .then(project => {\n                        console.log('Proyecto cargado:', project);\n                    })\n                    .catch(error => {\n                        console.error('Error al cargar proyecto:', error);\n                        showToast('Error al cargar el proyecto', 'error');\n                    });\n                return;\n            }\n\n            // Si es un archivo HTML, usar el parser HTML\n            if (files.length === 1 && (files[0].name.endsWith('.html') || files[0].name.endsWith('.htm'))) {\n                const file = files[0];\n                htmlParser.parseHTMLFile(file)\n                    .then(project => {\n                        const success = enhancedProjectManager.loadProjectToCanvas(project);\n                        if (success) {\n                            showToast('Archivo HTML convertido y cargado');\n                        } else {\n                            showToast('Error al cargar el archivo HTML', 'error');\n                        }\n                    })\n                    .catch(error => {\n                        console.error('Error al parsear HTML:', error);\n                        showToast('Error al procesar el archivo HTML', 'error');\n                    });\n                return;\n            }\n\n            // Si son m√∫ltiples archivos o directorio, procesarlos con FileLoader\n            if (fileLoader) {\n                // Buscar archivo HTML principal\n                let htmlFile = null;\n                for (let i = 0; i < files.length; i++) {\n                    const file = files[i];\n                    if (file.name.endsWith('.html') || file.name.endsWith('.htm')) {\n                        if (file.name.toLowerCase().includes('index') || !htmlFile) {\n                            htmlFile = file;\n                        }\n                    }\n                }\n\n                if (htmlFile) {\n                    // Usar el parser HTML para el archivo principal\n                    htmlParser.parseHTMLFile(htmlFile)\n                        .then(project => {\n                            const success = enhancedProjectManager.loadProjectToCanvas(project);\n                            if (success) {\n                                showToast(`Directorio HTML cargado: ${files.length} archivos procesados`);\n                            }\n                        })\n                        .catch(error => {\n                            console.error('Error al procesar directorio:', error);\n                            showToast('Error al procesar el directorio', 'error');\n                        });\n                } else {\n                    showToast('No se encontr√≥ archivo HTML en el directorio seleccionado', 'error');\n                }\n            } else {\n                showToast('Selecciona un archivo JSON o HTML individual', 'error');\n            }\n\n            // Limpiar input\n            event.target.value = '';\n        }\n\n        // Analizar directorio completo con ProjectAnalyzer\n        async function analyzeDirectory(event) {\n            const files = event.target.files;\n            \n            if (!files || files.length === 0) {\n                return;\n            }\n\n            if (!window.projectAnalyzer) {\n                showToast('‚ö†Ô∏è ProjectAnalyzer no est√° disponible', 'error');\n                return;\n            }\n\n            try {\n                const project = await window.projectAnalyzer.loadDirectory(files);\n                console.log('‚úÖ Proyecto analizado:', project);\n            } catch (error) {\n                console.error('Error analizando directorio:', error);\n            }\n\n            // Limpiar input\n            event.target.value = '';\n        }\n\n        // Atajos de teclado\n        function setupKeyboardShortcuts() {\n            document.addEventListener('keydown', function(e) {\n                // Delete: eliminar elemento seleccionado\n                if (e.key === 'Delete' && selectedElement) {\n                    deleteElement(selectedElement);\n                }\n\n                // Ctrl+S: guardar proyecto\n                if (e.ctrlKey && e.key === 's') {\n                    e.preventDefault();\n                    saveProject();\n                }\n            });\n\n            // Deseleccionar al hacer click en el canvas\n            document.getElementById('canvas').addEventListener('click', function(e) {\n                if (e.target.id === 'canvas') {\n                    if (selectedElement) {\n                        selectedElement.classList.remove('selected');\n                        selectedElement = null;\n                    }\n                    document.getElementById('propertiesPanel').innerHTML = `\n                        <h2 class=\"panel-title\">Propiedades</h2>\n                        <div class=\"properties-empty\">\n                            ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                        </div>\n                    `;\n                }\n            });\n        }\n\n        // Mostrar toast notification\n        function showToast(message) {\n            const toast = document.createElement('div');\n            toast.className = 'toast';\n            toast.textContent = message;\n            document.body.appendChild(toast);\n\n            setTimeout(() => {\n                toast.remove();\n            }, 3000);\n        }\n\n        // Convertir RGB a HEX\n        function rgbToHex(rgb) {\n            if (!rgb || rgb === 'transparent') return '#ffffff';\n            if (rgb.startsWith('#')) return rgb;\n\n            const result = rgb.match(/\\d+/g);\n            if (!result) return '#ffffff';\n\n            const r = parseInt(result[0]);\n            const g = parseInt(result[1]);\n            const b = parseInt(result[2]);\n\n            return '#' + [r, g, b].map(x => {\n                const hex = x.toString(16);\n                return hex.length === 1 ? '0' + hex : hex;\n            }).join('');\n        }\n\n        // ===== NUEVAS FUNCIONES PARA MEJORAS =====\n\n        // Importar archivo HTML (versi√≥n mejorada)\n        function importHTMLFile(event) {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            if (file.name.endsWith('.html') || file.name.endsWith('.htm')) {\n                htmlParser.parseHTMLFile(file)\n                    .then(project => {\n                        const success = enhancedProjectManager.loadProjectToCanvas(project);\n                        if (success) {\n                            showToast('Archivo HTML importado y convertido a JSON');\n                        } else {\n                            showToast('Error al importar el archivo HTML', 'error');\n                        }\n                    })\n                    .catch(error => {\n                        console.error('Error al importar HTML:', error);\n                        showToast('Error al procesar el archivo HTML', 'error');\n                    });\n            } else {\n                showToast('Por favor selecciona un archivo HTML v√°lido', 'error');\n            }\n\n            // Limpiar input\n            event.target.value = '';\n        }\n\n        // Mostrar panel de proyectos\n        function showProjectsPanel() {\n            const panel = document.getElementById('projectsPanel');\n            panel.classList.remove('hidden');\n            loadProjectsList();\n        }\n\n        // Ocultar panel de proyectos\n        function hideProjectsPanel() {\n            const panel = document.getElementById('projectsPanel');\n            panel.classList.add('hidden');\n        }\n\n        // Cargar lista de proyectos\n        function loadProjectsList() {\n            if (!projectManager) return;\n            \n            const projectsList = document.getElementById('projectsList');\n            const projects = projectManager.getStoredProjects();\n            \n            if (projects.length === 0) {\n                projectsList.innerHTML = '<div style=\"text-align: center; color: #64748b; padding: 40px;\">No hay proyectos guardados</div>';\n                return;\n            }\n            \n            projectsList.innerHTML = projects.map(project => `\n                <div class=\"project-card\" onclick=\"loadProjectFromPanel('${project.id}')\">\n                    <div class=\"project-thumbnail\">\n                        ${project.thumbnail ? `<img src=\"${project.thumbnail}\" style=\"width: 100%; height: 100%; object-fit: cover;\">` : 'üìÑ'}\n                    </div>\n                    <div class=\"project-info\">\n                        <h4 class=\"project-name\">${project.name}</h4>\n                        <div class=\"project-meta\">\n                            Modificado: ${new Date(project.modified).toLocaleDateString()}\n                        </div>\n                        <div class=\"project-actions-card\">\n                            <button class=\"project-action-btn\" onclick=\"event.stopPropagation(); renameProjectDialog('${project.id}')\">Renombrar</button>\n                            <button class=\"project-action-btn\" onclick=\"event.stopPropagation(); duplicateProjectFromPanel('${project.id}')\">Duplicar</button>\n                            <button class=\"project-action-btn\" onclick=\"event.stopPropagation(); exportProjectFromPanel('${project.id}')\">Exportar</button>\n                            <button class=\"project-action-btn danger\" onclick=\"event.stopPropagation(); deleteProjectFromPanel('${project.id}')\">Eliminar</button>\n                        </div>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // Cargar proyecto desde panel\n        function loadProjectFromPanel(projectId) {\n            if (projectManager && projectManager.loadProject(projectId)) {\n                hideProjectsPanel();\n            }\n        }\n\n        // Eliminar proyecto desde panel\n        function deleteProjectFromPanel(projectId) {\n            if (confirm('¬øEst√°s seguro de que quieres eliminar este proyecto?')) {\n                projectManager.deleteProject(projectId);\n                loadProjectsList();\n            }\n        }\n\n        // Duplicar proyecto desde panel\n        function duplicateProjectFromPanel(projectId) {\n            projectManager.duplicateProject(projectId);\n            loadProjectsList();\n        }\n\n        // Exportar proyecto desde panel\n        function exportProjectFromPanel(projectId) {\n            projectManager.exportProject(projectId);\n        }\n\n        // Mostrar di√°logo de nuevo proyecto\n        function createNewProjectDialog() {\n            const modal = document.getElementById('newProjectModal');\n            modal.classList.remove('hidden');\n            const input = document.getElementById('projectName');\n            input.focus();\n            \n            // Agregar listener para Enter\n            input.addEventListener('keydown', function(e) {\n                if (e.key === 'Enter') {\n                    createNewProjectFromDialog();\n                }\n            });\n        }\n\n        // Ocultar di√°logo de nuevo proyecto\n        function hideNewProjectModal() {\n            const modal = document.getElementById('newProjectModal');\n            modal.classList.add('hidden');\n            document.getElementById('projectName').value = '';\n        }\n\n        // Crear nuevo proyecto desde di√°logo\n        function createNewProjectFromDialog() {\n            const name = document.getElementById('projectName').value.trim();\n            if (name) {\n                projectManager.createNewProject(name);\n                hideNewProjectModal();\n                hideProjectsPanel();\n                // Limpiar canvas\n                document.getElementById('canvas').innerHTML = '';\n                selectedElement = null;\n                document.getElementById('propertiesPanel').innerHTML = `\n                    <h2 class=\"panel-title\">Propiedades</h2>\n                    <div class=\"properties-empty\">\n                        ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                    </div>\n                `;\n            }\n        }\n\n        // Renombrar proyecto\n        function renameProjectDialog(projectId) {\n            const newName = prompt('Nuevo nombre del proyecto:');\n            if (newName && newName.trim()) {\n                projectManager.renameProject(projectId, newName.trim());\n                loadProjectsList();\n            }\n        }\n\n        // Importar proyecto desde archivo\n        function importProjectFile(event) {\n            const file = event.target.files[0];\n            if (file && projectManager) {\n                projectManager.importProject(file).then(project => {\n                    if (project) {\n                        loadProjectsList();\n                    }\n                });\n            }\n            event.target.value = '';\n        }\n\n        // Mostrar biblioteca de componentes\n        function showComponentsLibrary() {\n            const panel = document.getElementById('componentsLibraryPanel');\n            panel.classList.remove('hidden');\n            loadComponentsLibrary();\n        }\n\n        // Ocultar biblioteca de componentes\n        function hideComponentsLibrary() {\n            const panel = document.getElementById('componentsLibraryPanel');\n            panel.classList.add('hidden');\n        }\n\n        // Cargar biblioteca de componentes\n        function loadComponentsLibrary() {\n            if (!componentExtractor) return;\n            \n            const componentsList = document.getElementById('libraryComponentsList');\n            const components = componentExtractor.getStoredComponents();\n            \n            if (components.length === 0) {\n                componentsList.innerHTML = '<div style=\"text-align: center; color: #64748b; padding: 40px;\">No hay componentes en la biblioteca<br><small>Importa archivos HTML para extraer componentes autom√°ticamente</small></div>';\n                return;\n            }\n            \n            componentsList.innerHTML = components.map(component => `\n                <div class=\"library-component-card\" onclick=\"addComponentFromLibrary('${component.id}')\">\n                    <div class=\"component-preview\">\n                        ${component.preview || component.type}\n                    </div>\n                    <div class=\"component-info\">\n                        <h4 class=\"component-name\">${component.name}</h4>\n                        <div class=\"component-tags\">\n                            ${component.tags.map(tag => `<span class=\"component-tag\">${tag}</span>`).join('')}\n                        </div>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // Buscar componentes en biblioteca\n        function searchLibraryComponents() {\n            const query = document.getElementById('componentLibrarySearch').value;\n            if (!componentExtractor) return;\n            \n            const components = query ? \n                componentExtractor.searchComponents(query) : \n                componentExtractor.getStoredComponents();\n            \n            const componentsList = document.getElementById('libraryComponentsList');\n            \n            if (components.length === 0) {\n                componentsList.innerHTML = '<div style=\"text-align: center; color: #64748b; padding: 40px;\">No se encontraron componentes</div>';\n                return;\n            }\n            \n            componentsList.innerHTML = components.map(component => `\n                <div class=\"library-component-card\" onclick=\"addComponentFromLibrary('${component.id}')\">\n                    <div class=\"component-preview\">\n                        ${component.preview || component.type}\n                    </div>\n                    <div class=\"component-info\">\n                        <h4 class=\"component-name\">${component.name}</h4>\n                        <div class=\"component-tags\">\n                            ${component.tags.map(tag => `<span class=\"component-tag\">${tag}</span>`).join('')}\n                        </div>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // Agregar componente desde biblioteca\n        function addComponentFromLibrary(componentId) {\n            if (!componentExtractor) return;\n            \n            const components = componentExtractor.getStoredComponents();\n            const component = components.find(c => c.id === componentId);\n            \n            if (component) {\n                // Crear elemento desde HTML del componente\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = component.html;\n                const element = tempDiv.firstElementChild;\n                \n                if (element) {\n                    // Asignar nuevo ID y clases del editor\n                    element.id = 'element-' + (elementIdCounter++);\n                    element.classList.add('canvas-element');\n                    \n                    // Agregar funcionalidad del editor\n                    const deleteBtn = document.createElement('div');\n                    deleteBtn.className = 'delete-btn';\n                    deleteBtn.textContent = '√ó';\n                    deleteBtn.onclick = function(e) {\n                        e.stopPropagation();\n                        deleteElement(element);\n                    };\n                    element.appendChild(deleteBtn);\n\n                    element.addEventListener('click', function(e) {\n                        e.stopPropagation();\n                        selectElement(element);\n                    });\n\n                    element.addEventListener('dblclick', function(e) {\n                        e.stopPropagation();\n                        makeElementEditable(element);\n                    });\n                    \n                    // Agregar al canvas\n                    document.getElementById('canvas').appendChild(element);\n                    hideComponentsLibrary();\n                    showToast(`Componente \"${component.name}\" agregado`);\n                }\n            }\n        }\n\n        // Sobrescribir funci√≥n de guardar proyecto para usar el nuevo sistema\n        if (typeof saveProject !== 'undefined') {\n            const originalSaveProject = saveProject;\n            window.saveProject = function() {\n                if (projectManager) {\n                    projectManager.saveCurrentProject();\n                } else {\n                    originalSaveProject();\n                }\n            };\n        }\n\n        // Sobrescribir funci√≥n de cargar proyecto\n        if (typeof loadProject !== 'undefined') {\n            const originalLoadProject = loadProject;\n            window.loadProject = function(event) {\n                const file = event.target.files[0];\n                if (!file) return;\n\n                if (projectManager) {\n                    projectManager.importProject(file);\n                } else {\n                    originalLoadProject(event);\n                }\n            };\n        }\n\n        // ===== CLASE HTMLTOJSONPARSER =====\n        \n        class HTMLToJSONParser {\n            constructor() {\n                this.elementIdCounter = 0;\n            }\n\n            // M√©todo principal para procesar archivo HTML\n            async parseHTMLFile(file) {\n                return new Promise((resolve, reject) => {\n                    const reader = new FileReader();\n                    reader.onload = (e) => {\n                        try {\n                            const htmlContent = e.target.result;\n                            const jsonProject = this.convertHTMLToJSON(htmlContent);\n                            resolve(jsonProject);\n                        } catch (error) {\n                            reject(error);\n                        }\n                    };\n                    reader.onerror = () => reject(new Error('Error al leer el archivo'));\n                    reader.readAsText(file);\n                });\n            }\n\n            // Convertir HTML string a JSON estructurado\n            convertHTMLToJSON(htmlContent) {\n                // Crear un documento temporal para parsear el HTML\n                const parser = new DOMParser();\n                const doc = parser.parseFromString(htmlContent, 'text/html');\n\n                // Extraer componentes principales\n                const styles = this.extractStyles(doc);\n                const scripts = this.extractScripts(doc);\n                const bodyElements = this.extractBodyElements(doc);\n\n                // Crear estructura JSON del proyecto\n                const project = {\n                    version: \"2.0\",\n                    metadata: {\n                        title: doc.title || 'Proyecto Importado',\n                        created: new Date().toISOString(),\n                        imported: true,\n                        originalFile: 'imported.html'\n                    },\n                    elements: bodyElements,\n                    styles: styles,\n                    scripts: scripts,\n                    canvas: {\n                        size: 'desktop',\n                        selectedElement: null\n                    }\n                };\n\n                return project;\n            }\n\n            // Extraer estilos CSS del documento\n            extractStyles(doc) {\n                const styles = {\n                    inline: {},\n                    internal: [],\n                    external: []\n                };\n\n                // Estilos internos (tags <style>)\n                const styleTags = doc.querySelectorAll('style');\n                styleTags.forEach((styleTag, index) => {\n                    styles.internal.push({\n                        id: `internal-${index}`,\n                        content: styleTag.textContent\n                    });\n                });\n\n                // Enlaces a CSS externos\n                const linkTags = doc.querySelectorAll('link[rel=\"stylesheet\"]');\n                linkTags.forEach((link, index) => {\n                    styles.external.push({\n                        id: `external-${index}`,\n                        href: link.href,\n                        media: link.media || 'all'\n                    });\n                });\n\n                return styles;\n            }\n\n            // Extraer scripts JavaScript del documento\n            extractScripts(doc) {\n                const scripts = {\n                    inline: [],\n                    external: []\n                };\n\n                const scriptTags = doc.querySelectorAll('script');\n                scriptTags.forEach((script, index) => {\n                    if (script.src) {\n                        // Script externo\n                        scripts.external.push({\n                            id: `external-script-${index}`,\n                            src: script.src,\n                            async: script.async,\n                            defer: script.defer\n                        });\n                    } else if (script.textContent.trim()) {\n                        // Script inline\n                        scripts.inline.push({\n                            id: `inline-script-${index}`,\n                            content: script.textContent\n                        });\n                    }\n                });\n\n                return scripts;\n            }\n\n            // Extraer elementos del body y convertir a estructura JSON\n            extractBodyElements(doc) {\n                const body = doc.body;\n                if (!body) return [];\n\n                const elements = [];\n                Array.from(body.children).forEach(child => {\n                    const element = this.buildElementTree(child);\n                    if (element) {\n                        elements.push(element);\n                    }\n                });\n\n                return elements;\n            }\n\n            // Construir √°rbol de elementos recursivamente\n            buildElementTree(domElement) {\n                if (!domElement || domElement.nodeType !== Node.ELEMENT_NODE) {\n                    return null;\n                }\n\n                // Generar ID √∫nico para el elemento\n                const elementId = `imported-element-${this.elementIdCounter++}`;\n\n                // Extraer estilos computados y inline\n                const computedStyles = window.getComputedStyle ? \n                    this.getRelevantStyles(domElement) : {};\n                const inlineStyles = this.parseInlineStyles(domElement.style.cssText);\n\n                // Construir objeto elemento\n                const element = {\n                    id: elementId,\n                    tagName: domElement.tagName.toLowerCase(),\n                    textContent: this.getDirectTextContent(domElement),\n                    attributes: this.extractAttributes(domElement),\n                    styles: {\n                        inline: inlineStyles,\n                        computed: computedStyles\n                    },\n                    children: [],\n                    metadata: {\n                        originalId: domElement.id || null,\n                        originalClasses: Array.from(domElement.classList),\n                        canvasElement: true\n                    }\n                };\n\n                // Procesar elementos hijos recursivamente\n                Array.from(domElement.children).forEach(child => {\n                    const childElement = this.buildElementTree(child);\n                    if (childElement) {\n                        element.children.push(childElement);\n                    }\n                });\n\n                return element;\n            }\n\n            // Obtener solo el texto directo del elemento (sin hijos)\n            getDirectTextContent(element) {\n                let text = '';\n                for (let node of element.childNodes) {\n                    if (node.nodeType === Node.TEXT_NODE) {\n                        text += node.textContent;\n                    }\n                }\n                return text.trim();\n            }\n\n            // Extraer atributos relevantes del elemento\n            extractAttributes(element) {\n                const attributes = {};\n                const relevantAttrs = ['id', 'class', 'src', 'href', 'alt', 'title', 'data-*', 'aria-*'];\n                \n                Array.from(element.attributes).forEach(attr => {\n                    const name = attr.name;\n                    const value = attr.value;\n                    \n                    // Incluir atributos relevantes\n                    if (relevantAttrs.some(pattern => \n                        pattern.includes('*') ? name.startsWith(pattern.replace('*', '')) : name === pattern\n                    )) {\n                        attributes[name] = value;\n                    }\n                });\n\n                return attributes;\n            }\n\n            // Parsear estilos inline a objeto\n            parseInlineStyles(cssText) {\n                const styles = {};\n                if (!cssText) return styles;\n\n                cssText.split(';').forEach(declaration => {\n                    const colonIndex = declaration.indexOf(':');\n                    if (colonIndex > 0) {\n                        const property = declaration.substring(0, colonIndex).trim();\n                        const value = declaration.substring(colonIndex + 1).trim();\n                        if (property && value) {\n                            styles[property] = value;\n                        }\n                    }\n                });\n\n                return styles;\n            }\n\n            // Obtener estilos computados relevantes\n            getRelevantStyles(element) {\n                if (!window.getComputedStyle) return {};\n\n                const computed = window.getComputedStyle(element);\n                const relevantProperties = [\n                    'display', 'position', 'top', 'left', 'right', 'bottom',\n                    'width', 'height', 'margin', 'padding', 'border',\n                    'background', 'color', 'font-family', 'font-size', 'font-weight',\n                    'text-align', 'line-height', 'flex', 'grid', 'z-index'\n                ];\n\n                const styles = {};\n                relevantProperties.forEach(prop => {\n                    const value = computed.getPropertyValue(prop);\n                    if (value && value !== 'initial' && value !== 'normal') {\n                        styles[prop] = value;\n                    }\n                });\n\n                return styles;\n            }\n\n            // Convertir proyecto JSON de vuelta a elementos DOM para el canvas\n            jsonToCanvas(projectData) {\n                const canvas = document.getElementById('canvas');\n                if (!canvas) return;\n\n                // Limpiar canvas\n                canvas.innerHTML = '';\n\n                // Crear elementos desde JSON\n                projectData.elements.forEach(elementData => {\n                    const domElement = this.createDOMFromJSON(elementData);\n                    if (domElement) {\n                        canvas.appendChild(domElement);\n                    }\n                });\n\n                // Aplicar estilos internos\n                this.applyInternalStyles(projectData.styles);\n\n                // Re-aplicar eventos a elementos\n                this.reapplyCanvasEvents();\n            }\n\n            // Crear elemento DOM desde datos JSON\n            createDOMFromJSON(elementData) {\n                const element = document.createElement(elementData.tagName);\n                \n                // Aplicar ID y clases para el editor\n                element.id = elementData.id;\n                element.classList.add('canvas-element');\n                \n                // Restaurar clases originales si existen\n                if (elementData.metadata.originalClasses) {\n                    elementData.metadata.originalClasses.forEach(cls => {\n                        element.classList.add(cls);\n                    });\n                }\n\n                // Aplicar atributos\n                Object.entries(elementData.attributes).forEach(([name, value]) => {\n                    if (name !== 'id' && name !== 'class') {\n                        element.setAttribute(name, value);\n                    }\n                });\n\n                // Aplicar estilos inline\n                Object.entries(elementData.styles.inline).forEach(([property, value]) => {\n                    element.style.setProperty(property, value);\n                });\n\n                // Establecer contenido de texto\n                if (elementData.textContent && elementData.children.length === 0) {\n                    element.textContent = elementData.textContent;\n                }\n\n                // Crear elementos hijos recursivamente\n                elementData.children.forEach(childData => {\n                    const childElement = this.createDOMFromJSON(childData);\n                    if (childElement) {\n                        element.appendChild(childElement);\n                    }\n                });\n\n                // Agregar bot√≥n de eliminar\n                this.addDeleteButton(element);\n\n                return element;\n            }\n\n            // Aplicar estilos internos al documento\n            applyInternalStyles(stylesData) {\n                // Remover estilos internos previos del editor\n                const existingStyles = document.querySelectorAll('style[data-editor-imported]');\n                existingStyles.forEach(style => style.remove());\n\n                // Agregar nuevos estilos internos\n                stylesData.internal.forEach(styleData => {\n                    const styleElement = document.createElement('style');\n                    styleElement.setAttribute('data-editor-imported', 'true');\n                    styleElement.textContent = styleData.content;\n                    document.head.appendChild(styleElement);\n                });\n            }\n\n            // Agregar bot√≥n de eliminar a elemento\n            addDeleteButton(element) {\n                const deleteBtn = document.createElement('button');\n                deleteBtn.className = 'delete-btn';\n                deleteBtn.innerHTML = '√ó';\n                deleteBtn.onclick = (e) => {\n                    e.stopPropagation();\n                    element.remove();\n                    if (selectedElement === element) {\n                        selectedElement = null;\n                        updatePropertiesPanel();\n                    }\n                };\n                element.appendChild(deleteBtn);\n            }\n\n            // Re-aplicar eventos de canvas a elementos importados\n            reapplyCanvasEvents() {\n                const elements = document.querySelectorAll('.canvas-element');\n                elements.forEach(element => {\n                    // Evento de selecci√≥n\n                    element.addEventListener('click', function(e) {\n                        e.stopPropagation();\n                        selectElement(element);\n                    });\n\n                    // Evento de edici√≥n de texto\n                    element.addEventListener('dblclick', function(e) {\n                        e.stopPropagation();\n                        makeElementEditable(element);\n                    });\n                });\n            }\n        }\n\n        // Crear instancia global del parser\n        const htmlParser = new HTMLToJSONParser();\n\n        // ===== CLASE PROJECTMANAGER MEJORADA =====\n        \n        class EnhancedProjectManager {\n            constructor() {\n                this.currentProject = null;\n                this.projectHistory = [];\n            }\n\n            // Crear proyecto desde canvas actual\n            createProjectFromCanvas() {\n                const canvas = document.getElementById('canvas');\n                const elements = this.extractElementsFromCanvas(canvas);\n                \n                const project = {\n                    version: \"2.0\",\n                    metadata: {\n                        title: 'Proyecto Sin T√≠tulo',\n                        created: new Date().toISOString(),\n                        modified: new Date().toISOString(),\n                        canvasSize: this.getCurrentCanvasSize(),\n                        selectedElement: selectedElement ? selectedElement.id : null\n                    },\n                    elements: elements,\n                    styles: {\n                        inline: {},\n                        internal: this.extractInternalStyles(),\n                        external: []\n                    },\n                    scripts: {\n                        inline: [],\n                        external: []\n                    }\n                };\n\n                return project;\n            }\n\n            // Extraer elementos del canvas recursivamente\n            extractElementsFromCanvas(container) {\n                const elements = [];\n                \n                Array.from(container.children).forEach(child => {\n                    if (child.classList.contains('canvas-element')) {\n                        const element = this.extractElementData(child);\n                        elements.push(element);\n                    }\n                });\n\n                return elements;\n            }\n\n            // Extraer datos de un elemento espec√≠fico\n            extractElementData(domElement) {\n                const element = {\n                    id: domElement.id,\n                    tagName: domElement.tagName.toLowerCase(),\n                    textContent: this.getDirectTextContent(domElement),\n                    attributes: this.extractElementAttributes(domElement),\n                    styles: {\n                        inline: this.extractInlineStyles(domElement),\n                        computed: {}\n                    },\n                    children: [],\n                    metadata: {\n                        componentType: domElement.getAttribute('data-component-type') || 'custom',\n                        canvasElement: true,\n                        draggable: domElement.draggable\n                    }\n                };\n\n                // Extraer elementos hijos (excluyendo bot√≥n de eliminar)\n                Array.from(domElement.children).forEach(child => {\n                    if (!child.classList.contains('delete-btn')) {\n                        if (child.classList.contains('canvas-element')) {\n                            element.children.push(this.extractElementData(child));\n                        } else {\n                            // Para elementos que no son canvas-element pero son contenido\n                            element.children.push({\n                                id: `child-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n                                tagName: child.tagName.toLowerCase(),\n                                textContent: child.textContent,\n                                attributes: this.extractElementAttributes(child),\n                                styles: { inline: this.extractInlineStyles(child), computed: {} },\n                                children: [],\n                                metadata: { canvasElement: false }\n                            });\n                        }\n                    }\n                });\n\n                return element;\n            }\n\n            // Obtener texto directo del elemento\n            getDirectTextContent(element) {\n                let text = '';\n                for (let node of element.childNodes) {\n                    if (node.nodeType === Node.TEXT_NODE) {\n                        text += node.textContent;\n                    }\n                }\n                return text.trim();\n            }\n\n            // Extraer atributos del elemento\n            extractElementAttributes(element) {\n                const attributes = {};\n                Array.from(element.attributes).forEach(attr => {\n                    if (attr.name !== 'draggable' && attr.name !== 'data-component-type') {\n                        attributes[attr.name] = attr.value;\n                    }\n                });\n                return attributes;\n            }\n\n            // Extraer estilos inline\n            extractInlineStyles(element) {\n                const styles = {};\n                if (element.style.cssText) {\n                    element.style.cssText.split(';').forEach(declaration => {\n                        const colonIndex = declaration.indexOf(':');\n                        if (colonIndex > 0) {\n                            const property = declaration.substring(0, colonIndex).trim();\n                            const value = declaration.substring(colonIndex + 1).trim();\n                            if (property && value) {\n                                styles[property] = value;\n                            }\n                        }\n                    });\n                }\n                return styles;\n            }\n\n            // Extraer estilos internos del documento\n            extractInternalStyles() {\n                const styles = [];\n                const styleTags = document.querySelectorAll('style[data-editor-imported]');\n                styleTags.forEach((styleTag, index) => {\n                    styles.push({\n                        id: `internal-${index}`,\n                        content: styleTag.textContent\n                    });\n                });\n                return styles;\n            }\n\n            // Obtener tama√±o actual del canvas\n            getCurrentCanvasSize() {\n                const canvas = document.getElementById('canvas');\n                const activeBtn = document.querySelector('.toolbar-btn.active');\n                \n                if (activeBtn) {\n                    if (activeBtn.id === 'btnDesktop') return 'desktop';\n                    if (activeBtn.id === 'btnTablet') return 'tablet';\n                    if (activeBtn.id === 'btnMobile') return 'mobile';\n                }\n                \n                return 'desktop';\n            }\n\n            // Cargar proyecto al canvas\n            loadProjectToCanvas(projectData) {\n                const canvas = document.getElementById('canvas');\n                \n                // Verificar versi√≥n del proyecto\n                if (!projectData.version || projectData.version === \"1.0\") {\n                    // Formato antiguo - usar m√©todo de compatibilidad\n                    return this.loadLegacyProject(projectData);\n                }\n\n                // Limpiar canvas\n                canvas.innerHTML = '';\n\n                // Cargar elementos\n                if (projectData.elements) {\n                    projectData.elements.forEach(elementData => {\n                        const domElement = this.createDOMFromElementData(elementData);\n                        if (domElement) {\n                            canvas.appendChild(domElement);\n                        }\n                    });\n                }\n\n                // Aplicar estilos internos\n                if (projectData.styles && projectData.styles.internal) {\n                    this.applyInternalStyles(projectData.styles.internal);\n                }\n\n                // Restaurar configuraci√≥n del canvas\n                if (projectData.metadata) {\n                    if (projectData.metadata.canvasSize) {\n                        setCanvasSize(projectData.metadata.canvasSize);\n                    }\n                }\n\n                // Re-aplicar eventos\n                this.reapplyCanvasEvents();\n\n                this.currentProject = projectData;\n                return true;\n            }\n\n            // Crear elemento DOM desde datos JSON\n            createDOMFromElementData(elementData) {\n                const element = document.createElement(elementData.tagName);\n                \n                // Aplicar ID\n                element.id = elementData.id;\n                element.classList.add('canvas-element');\n                \n                // Aplicar atributos\n                Object.entries(elementData.attributes).forEach(([name, value]) => {\n                    if (name !== 'id') {\n                        element.setAttribute(name, value);\n                    }\n                });\n\n                // Aplicar estilos inline\n                Object.entries(elementData.styles.inline).forEach(([property, value]) => {\n                    element.style.setProperty(property, value);\n                });\n\n                // Aplicar metadatos\n                if (elementData.metadata.componentType) {\n                    element.setAttribute('data-component-type', elementData.metadata.componentType);\n                }\n                if (elementData.metadata.draggable) {\n                    element.draggable = true;\n                }\n\n                // Establecer contenido de texto\n                if (elementData.textContent && elementData.children.length === 0) {\n                    element.textContent = elementData.textContent;\n                }\n\n                // Crear elementos hijos\n                elementData.children.forEach(childData => {\n                    const childElement = this.createDOMFromElementData(childData);\n                    if (childElement) {\n                        element.appendChild(childElement);\n                    }\n                });\n\n                // Agregar bot√≥n de eliminar solo a elementos canvas\n                if (elementData.metadata.canvasElement !== false) {\n                    this.addDeleteButton(element);\n                    this.addElementEvents(element);\n                }\n\n                return element;\n            }\n\n            // Agregar bot√≥n de eliminar\n            addDeleteButton(element) {\n                const deleteBtn = document.createElement('div');\n                deleteBtn.className = 'delete-btn';\n                deleteBtn.textContent = '√ó';\n                deleteBtn.onclick = (e) => {\n                    e.stopPropagation();\n                    deleteElement(element);\n                };\n                element.appendChild(deleteBtn);\n            }\n\n            // Agregar eventos a elemento\n            addElementEvents(element) {\n                element.addEventListener('click', function(e) {\n                    e.stopPropagation();\n                    selectElement(element);\n                });\n\n                element.addEventListener('dblclick', function(e) {\n                    e.stopPropagation();\n                    makeElementEditable(element);\n                });\n\n                setupElementDragAndDrop(element);\n            }\n\n            // Aplicar estilos internos\n            applyInternalStyles(stylesData) {\n                // Remover estilos previos\n                const existingStyles = document.querySelectorAll('style[data-editor-imported]');\n                existingStyles.forEach(style => style.remove());\n\n                // Agregar nuevos estilos\n                stylesData.forEach(styleData => {\n                    const styleElement = document.createElement('style');\n                    styleElement.setAttribute('data-editor-imported', 'true');\n                    styleElement.textContent = styleData.content;\n                    document.head.appendChild(styleElement);\n                });\n            }\n\n            // Re-aplicar eventos del canvas\n            reapplyCanvasEvents() {\n                const elements = document.querySelectorAll('.canvas-element');\n                elements.forEach(element => {\n                    // Los eventos ya se agregan en addElementEvents\n                });\n            }\n\n            // Cargar proyecto en formato legacy (v1.0)\n            loadLegacyProject(projectData) {\n                const canvas = document.getElementById('canvas');\n                canvas.innerHTML = projectData.html;\n\n                // Re-aplicar eventos a elementos legacy\n                const elements = document.querySelectorAll('.canvas-element');\n                elements.forEach(element => {\n                    this.addElementEvents(element);\n                    \n                    const deleteBtn = element.querySelector('.delete-btn');\n                    if (deleteBtn) {\n                        deleteBtn.onclick = function(e) {\n                            e.stopPropagation();\n                            deleteElement(element);\n                        };\n                    }\n                });\n\n                return true;\n            }\n\n            // Guardar proyecto actual\n            saveCurrentProject(filename = 'proyecto.json') {\n                const project = this.createProjectFromCanvas();\n                this.downloadProject(project, filename);\n                this.currentProject = project;\n                return project;\n            }\n\n            // Descargar proyecto como archivo\n            downloadProject(project, filename) {\n                const blob = new Blob([JSON.stringify(project, null, 2)], { \n                    type: 'application/json' \n                });\n                const url = URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = filename;\n                a.click();\n                URL.revokeObjectURL(url);\n            }\n\n            // Importar proyecto desde archivo\n            async importProject(file) {\n                return new Promise((resolve, reject) => {\n                    const reader = new FileReader();\n                    reader.onload = (e) => {\n                        try {\n                            const projectData = JSON.parse(e.target.result);\n                            const success = this.loadProjectToCanvas(projectData);\n                            if (success) {\n                                showToast('Proyecto cargado correctamente');\n                                resolve(projectData);\n                            } else {\n                                reject(new Error('Error al cargar el proyecto'));\n                            }\n                        } catch (error) {\n                            reject(error);\n                        }\n                    };\n                    reader.onerror = () => reject(new Error('Error al leer el archivo'));\n                    reader.readAsText(file);\n                });\n            }\n        }\n\n        // Crear instancia global del gestor de proyectos mejorado\n        const enhancedProjectManager = new EnhancedProjectManager();\n\n        // Exportar funciones cr√≠ticas al scope global para compatibilidad con event handlers inline\n        window.startBlankProject = startBlankProject;\n        window.loadTemplate = loadTemplate;\n        window.filterTemplates = filterTemplates;\n        window.showGallery = showGallery;\n        window.hideGallery = hideGallery;\n        window.newProject = newProject;\n        window.setCanvasSize = setCanvasSize;\n        window.exportHTML = exportHTML;\n        window.exportZip = exportZip;\n        window.showHelp = showHelp;\n        window.saveProject = saveProject;\n        window.importHTMLFile = importHTMLFile;\n        window.showProjectsPanel = showProjectsPanel;\n        window.showComponentsLibrary = showComponentsLibrary;\n        window.toggleCategory = toggleCategory;\n\nif (typeof module !== 'undefined' && module.exports) { module.exports = { createComponent }; }\n","/**\n * FileLoader - Maneja la carga de archivos HTML, CSS, JS e im√°genes\n */\nclass FileLoader {\n    constructor() {\n        this.supportedTypes = {\n            html: ['text/html', '.html', '.htm'],\n            css: ['text/css', '.css'],\n            js: ['text/javascript', 'application/javascript', '.js'],\n            images: ['image/png', 'image/jpeg', 'image/gif', 'image/webp', 'image/svg+xml', '.png', '.jpg', '.jpeg', '.gif', '.webp', '.svg']\n        };\n        this.setupDropZone();\n    }\n\n    /**\n     * Configura la zona de drop para archivos\n     */\n    setupDropZone() {\n        const canvas = document.getElementById('canvas');\n        \n        // Prevenir comportamiento por defecto del navegador\n        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n            canvas.addEventListener(eventName, this.preventDefaults, false);\n            document.body.addEventListener(eventName, this.preventDefaults, false);\n        });\n\n        // Resaltar zona de drop\n        ['dragenter', 'dragover'].forEach(eventName => {\n            canvas.addEventListener(eventName, this.highlight.bind(this), false);\n        });\n\n        ['dragleave', 'drop'].forEach(eventName => {\n            canvas.addEventListener(eventName, this.unhighlight.bind(this), false);\n        });\n\n        // Manejar archivos soltados\n        canvas.addEventListener('drop', this.handleDrop.bind(this), false);\n    }\n\n    preventDefaults(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    highlight(e) {\n        const canvas = document.getElementById('canvas');\n        canvas.classList.add('file-drop-zone');\n    }\n\n    unhighlight(e) {\n        const canvas = document.getElementById('canvas');\n        canvas.classList.remove('file-drop-zone');\n    }\n\n    /**\n     * Maneja archivos soltados en el canvas\n     */\n    async handleDrop(e) {\n        const dt = e.dataTransfer;\n        const files = dt.files;\n\n        if (files.length > 0) {\n            await this.processFiles(files);\n        }\n    }\n\n    /**\n     * Procesa m√∫ltiples archivos\n     */\n    async processFiles(files) {\n        const fileArray = Array.from(files);\n        \n        for (const file of fileArray) {\n            await this.processFile(file);\n        }\n    }\n\n    /**\n     * Procesa un archivo individual\n     */\n    async processFile(file) {\n        const fileType = this.getFileType(file);\n        \n        try {\n            switch (fileType) {\n                case 'html':\n                    await this.loadHTMLFile(file);\n                    break;\n                case 'css':\n                    await this.loadCSSFile(file);\n                    break;\n                case 'js':\n                    await this.loadJSFile(file);\n                    break;\n                case 'images':\n                    await this.loadImageFile(file);\n                    break;\n                default:\n                    this.showError(`Tipo de archivo no soportado: ${file.name}`);\n            }\n        } catch (error) {\n            this.showError(`Error al cargar ${file.name}: ${error.message}`);\n        }\n    }\n\n    /**\n     * Determina el tipo de archivo\n     */\n    getFileType(file) {\n        const fileName = file.name.toLowerCase();\n        const fileType = file.type.toLowerCase();\n\n        for (const [type, patterns] of Object.entries(this.supportedTypes)) {\n            if (patterns.some(pattern => \n                pattern.startsWith('.') ? fileName.endsWith(pattern) : fileType === pattern\n            )) {\n                return type;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Carga archivo HTML\n     */\n    async loadHTMLFile(file) {\n        const content = await this.readFileAsText(file);\n        \n        // Mostrar preview antes de cargar\n        const shouldLoad = await this.showHTMLPreview(content, file.name);\n        \n        if (shouldLoad) {\n            const htmlParser = new HTMLParser();\n            await htmlParser.parseAndLoad(content);\n            \n            // Extraer componentes autom√°ticamente\n            if (window.componentExtractor) {\n                const extractedComponents = window.componentExtractor.extractComponents(content);\n                if (extractedComponents.length > 0) {\n                    const saved = window.componentExtractor.saveExtractedComponents();\n                    this.showSuccess(`Archivo HTML \"${file.name}\" cargado correctamente. ${saved} componentes extra√≠dos.`);\n                } else {\n                    this.showSuccess(`Archivo HTML \"${file.name}\" cargado correctamente`);\n                }\n            } else {\n                this.showSuccess(`Archivo HTML \"${file.name}\" cargado correctamente`);\n            }\n        }\n    }\n\n    /**\n     * Carga archivo CSS\n     */\n    async loadCSSFile(file) {\n        const content = await this.readFileAsText(file);\n        \n        // Aplicar estilos CSS al documento\n        const styleElement = document.createElement('style');\n        styleElement.textContent = content;\n        styleElement.setAttribute('data-source', file.name);\n        document.head.appendChild(styleElement);\n        \n        this.showSuccess(`Estilos CSS de \"${file.name}\" aplicados`);\n    }\n\n    /**\n     * Carga archivo JavaScript\n     */\n    async loadJSFile(file) {\n        const content = await this.readFileAsText(file);\n        \n        // Mostrar advertencia antes de ejecutar JavaScript\n        const shouldExecute = confirm(\n            `¬øDeseas ejecutar el c√≥digo JavaScript de \"${file.name}\"?\\n\\n` +\n            'ADVERTENCIA: Solo ejecuta c√≥digo de fuentes confiables.'\n        );\n        \n        if (shouldExecute) {\n            try {\n                // Crear script element\n                const scriptElement = document.createElement('script');\n                scriptElement.textContent = content;\n                scriptElement.setAttribute('data-source', file.name);\n                document.head.appendChild(scriptElement);\n                \n                this.showSuccess(`JavaScript de \"${file.name}\" ejecutado`);\n            } catch (error) {\n                this.showError(`Error al ejecutar JavaScript: ${error.message}`);\n            }\n        }\n    }\n\n    /**\n     * Carga archivo de imagen\n     */\n    async loadImageFile(file) {\n        const imageUrl = await this.readFileAsDataURL(file);\n        \n        // Crear elemento de imagen en el canvas\n        const imgElement = document.createElement('img');\n        imgElement.src = imageUrl;\n        imgElement.alt = file.name;\n        imgElement.style.maxWidth = '100%';\n        imgElement.style.height = 'auto';\n        \n        // Aplicar clases y eventos del editor\n        imgElement.id = 'element-' + (window.elementIdCounter++);\n        imgElement.classList.add('canvas-element');\n        imgElement.setAttribute('data-component-type', 'img');\n\n        // Agregar bot√≥n de eliminar\n        const deleteBtn = document.createElement('div');\n        deleteBtn.className = 'delete-btn';\n        deleteBtn.textContent = '√ó';\n        deleteBtn.onclick = function(e) {\n            e.stopPropagation();\n            window.deleteElement(imgElement);\n        };\n        imgElement.appendChild(deleteBtn);\n\n        // Eventos\n        imgElement.addEventListener('click', function(e) {\n            e.stopPropagation();\n            window.selectElement(imgElement);\n        });\n\n        imgElement.addEventListener('dblclick', function(e) {\n            e.stopPropagation();\n            window.makeElementEditable(imgElement);\n        });\n\n        // Agregar al canvas\n        document.getElementById('canvas').appendChild(imgElement);\n        \n        this.showSuccess(`Imagen \"${file.name}\" agregada al canvas`);\n    }\n\n    /**\n     * Muestra preview del HTML antes de cargar\n     */\n    async showHTMLPreview(content, fileName) {\n        return new Promise((resolve) => {\n            const modal = this.createPreviewModal(content, fileName);\n            document.body.appendChild(modal);\n            \n            const loadBtn = modal.querySelector('.load-btn');\n            const cancelBtn = modal.querySelector('.cancel-btn');\n            \n            loadBtn.onclick = () => {\n                modal.remove();\n                resolve(true);\n            };\n            \n            cancelBtn.onclick = () => {\n                modal.remove();\n                resolve(false);\n            };\n        });\n    }\n\n    /**\n     * Crea modal de preview\n     */\n    createPreviewModal(content, fileName) {\n        const modal = document.createElement('div');\n        modal.className = 'file-preview-modal';\n        modal.innerHTML = `\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h3>Vista previa: ${fileName}</h3>\n                    <button class=\"modal-close cancel-btn\">&times;</button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"preview-content\">\n                        <iframe srcdoc=\"${this.escapeHtml(content)}\" style=\"width: 100%; height: 400px; border: 1px solid #e2e8f0;\"></iframe>\n                    </div>\n                    <div class=\"preview-actions\">\n                        <button class=\"load-btn\">Cargar archivo</button>\n                        <button class=\"cancel-btn\">Cancelar</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        return modal;\n    }\n\n    /**\n     * Lee archivo como texto\n     */\n    readFileAsText(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = e => resolve(e.target.result);\n            reader.onerror = e => reject(new Error('Error al leer archivo'));\n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * Lee archivo como Data URL\n     */\n    readFileAsDataURL(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = e => resolve(e.target.result);\n            reader.onerror = e => reject(new Error('Error al leer archivo'));\n            reader.readAsDataURL(file);\n        });\n    }\n\n    /**\n     * Escapa HTML para preview seguro\n     */\n    escapeHtml(html) {\n        return html.replace(/\"/g, '&quot;');\n    }\n\n    /**\n     * Muestra mensaje de √©xito\n     */\n    showSuccess(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.log('SUCCESS:', message);\n        }\n    }\n\n    /**\n     * Muestra mensaje de error\n     */\n    showError(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.error('ERROR:', message);\n        }\n        alert(message);\n    }\n}\n\n// Exportar para uso en otros m√≥dulos\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = FileLoader;\n}\n\n// Exportar globalmente para compatibilidad\nwindow.FileLoader = FileLoader;","/**\n * HTMLParser - Convierte HTML existente en componentes editables del editor\n */\nclass HTMLParser {\n    constructor() {\n        this.componentTypes = {\n            'nav': 'navbar',\n            'header': 'header',\n            'footer': 'footer',\n            'section': 'seccion',\n            'article': 'article',\n            'div': 'contenedor',\n            'h1': 'h1',\n            'h2': 'h2',\n            'h3': 'h3',\n            'h4': 'h4',\n            'h5': 'h5',\n            'h6': 'h6',\n            'p': 'p',\n            'span': 'span',\n            'img': 'img',\n            'video': 'video',\n            'iframe': 'iframe',\n            'button': 'button',\n            'input': 'input',\n            'textarea': 'textarea',\n            'select': 'select',\n            'ul': 'ul',\n            'ol': 'ol',\n            'li': 'li',\n            'a': 'link',\n            'form': 'form'\n        };\n        \n        this.skipElements = ['script', 'style', 'meta', 'link', 'title', 'head'];\n        this.elementIdCounter = window.elementIdCounter || 0;\n    }\n\n    /**\n     * Parsea HTML y lo carga en el canvas\n     */\n    async parseAndLoad(htmlContent) {\n        try {\n            // Crear parser DOM\n            const parser = new DOMParser();\n            const doc = parser.parseFromString(htmlContent, 'text/html');\n            \n            // Extraer estilos CSS\n            await this.extractStyles(doc);\n            \n            // Extraer y preservar scripts\n            await this.extractScripts(doc);\n            \n            // Procesar el body\n            const body = doc.body;\n            if (body) {\n                const canvas = document.getElementById('canvas');\n                \n                // Limpiar canvas actual si el usuario confirma\n                if (canvas.children.length > 0) {\n                    const shouldReplace = confirm('¬øDeseas reemplazar el contenido actual del canvas?');\n                    if (!shouldReplace) {\n                        return;\n                    }\n                    canvas.innerHTML = '';\n                }\n                \n                // Procesar elementos del body\n                await this.processElements(body.children, canvas);\n                \n                // Actualizar contador global\n                window.elementIdCounter = this.elementIdCounter;\n                \n                this.showSuccess('HTML convertido exitosamente a componentes editables');\n            }\n        } catch (error) {\n            this.showError(`Error al parsear HTML: ${error.message}`);\n        }\n    }\n\n    /**\n     * Extrae y aplica estilos CSS del documento\n     */\n    async extractStyles(doc) {\n        // Extraer estilos inline del head\n        const styleElements = doc.querySelectorAll('style');\n        styleElements.forEach((styleEl, index) => {\n            const newStyle = document.createElement('style');\n            newStyle.textContent = styleEl.textContent;\n            newStyle.setAttribute('data-source', `imported-style-${index}`);\n            document.head.appendChild(newStyle);\n        });\n\n        // Extraer links a CSS externos\n        const linkElements = doc.querySelectorAll('link[rel=\"stylesheet\"]');\n        linkElements.forEach((linkEl, index) => {\n            const newLink = document.createElement('link');\n            newLink.rel = 'stylesheet';\n            newLink.href = linkEl.href;\n            newLink.setAttribute('data-source', `imported-link-${index}`);\n            document.head.appendChild(newLink);\n        });\n    }\n\n    /**\n     * Extrae y preserva scripts JavaScript\n     */\n    async extractScripts(doc) {\n        const scriptElements = doc.querySelectorAll('script');\n        const scripts = [];\n        \n        scriptElements.forEach(scriptEl => {\n            if (scriptEl.src) {\n                // Script externo\n                scripts.push({\n                    type: 'external',\n                    src: scriptEl.src,\n                    content: null\n                });\n            } else if (scriptEl.textContent.trim()) {\n                // Script inline\n                scripts.push({\n                    type: 'inline',\n                    src: null,\n                    content: scriptEl.textContent\n                });\n            }\n        });\n\n        // Mostrar scripts encontrados al usuario\n        if (scripts.length > 0) {\n            const shouldInclude = confirm(\n                `Se encontraron ${scripts.length} script(s) JavaScript.\\n` +\n                '¬øDeseas incluirlos? (Solo acepta si conf√≠as en el c√≥digo)'\n            );\n            \n            if (shouldInclude) {\n                scripts.forEach((script, index) => {\n                    const newScript = document.createElement('script');\n                    if (script.type === 'external') {\n                        newScript.src = script.src;\n                    } else {\n                        newScript.textContent = script.content;\n                    }\n                    newScript.setAttribute('data-source', `imported-script-${index}`);\n                    document.head.appendChild(newScript);\n                });\n            }\n        }\n    }\n\n    /**\n     * Procesa elementos HTML y los convierte en componentes editables\n     */\n    async processElements(elements, container) {\n        for (const element of elements) {\n            if (this.shouldSkipElement(element)) {\n                continue;\n            }\n\n            const convertedElement = await this.convertElement(element);\n            if (convertedElement) {\n                container.appendChild(convertedElement);\n            }\n        }\n    }\n\n    /**\n     * Verifica si un elemento debe ser omitido\n     */\n    shouldSkipElement(element) {\n        const tagName = element.tagName.toLowerCase();\n        return this.skipElements.includes(tagName) || \n               element.nodeType !== Node.ELEMENT_NODE;\n    }\n\n    /**\n     * Convierte un elemento HTML en componente editable\n     */\n    async convertElement(originalElement) {\n        const tagName = originalElement.tagName.toLowerCase();\n        const componentType = this.componentTypes[tagName] || 'contenedor';\n        \n        // Crear nuevo elemento\n        const newElement = document.createElement(tagName);\n        \n        // Copiar atributos (excepto id que ser√° regenerado)\n        Array.from(originalElement.attributes).forEach(attr => {\n            if (attr.name !== 'id') {\n                newElement.setAttribute(attr.name, attr.value);\n            }\n        });\n\n        // Asignar nuevo ID √∫nico\n        newElement.id = 'element-' + (this.elementIdCounter++);\n        newElement.classList.add('canvas-element');\n        newElement.setAttribute('data-component-type', componentType);\n\n        // Copiar estilos inline\n        if (originalElement.style.cssText) {\n            newElement.style.cssText = originalElement.style.cssText;\n        }\n\n        // Procesar contenido\n        await this.processElementContent(originalElement, newElement);\n\n        // Agregar funcionalidad del editor\n        this.addEditorFunctionality(newElement);\n\n        return newElement;\n    }\n\n    /**\n     * Procesa el contenido de un elemento\n     */\n    async processElementContent(originalElement, newElement) {\n        // Si el elemento tiene solo texto, copiarlo directamente\n        if (originalElement.children.length === 0) {\n            newElement.textContent = originalElement.textContent;\n        } else {\n            // Procesar elementos hijos recursivamente\n            await this.processElements(originalElement.children, newElement);\n            \n            // Preservar texto que no est√© en elementos hijos\n            const textNodes = Array.from(originalElement.childNodes)\n                .filter(node => node.nodeType === Node.TEXT_NODE && node.textContent.trim());\n            \n            if (textNodes.length > 0) {\n                textNodes.forEach(textNode => {\n                    newElement.appendChild(document.createTextNode(textNode.textContent));\n                });\n            }\n        }\n    }\n\n    /**\n     * Agrega funcionalidad del editor al elemento\n     */\n    addEditorFunctionality(element) {\n        // Agregar bot√≥n de eliminar\n        const deleteBtn = document.createElement('div');\n        deleteBtn.className = 'delete-btn';\n        deleteBtn.textContent = '√ó';\n        deleteBtn.onclick = (e) => {\n            e.stopPropagation();\n            if (window.deleteElement) {\n                window.deleteElement(element);\n            } else {\n                element.remove();\n            }\n        };\n        element.appendChild(deleteBtn);\n\n        // Eventos de selecci√≥n\n        element.addEventListener('click', (e) => {\n            e.stopPropagation();\n            if (window.selectElement) {\n                window.selectElement(element);\n            }\n        });\n\n        // Eventos de edici√≥n\n        element.addEventListener('dblclick', (e) => {\n            e.stopPropagation();\n            if (window.makeElementEditable) {\n                window.makeElementEditable(element);\n            }\n        });\n    }\n\n    /**\n     * Detecta y convierte patrones comunes en componentes especializados\n     */\n    detectSpecialComponents(element) {\n        const classes = element.className.toLowerCase();\n        const tagName = element.tagName.toLowerCase();\n        \n        // Detectar navbar\n        if (tagName === 'nav' || classes.includes('nav') || classes.includes('navbar')) {\n            return this.convertToNavbar(element);\n        }\n        \n        // Detectar hero section\n        if (classes.includes('hero') || classes.includes('banner') || classes.includes('jumbotron')) {\n            return this.convertToHero(element);\n        }\n        \n        // Detectar card\n        if (classes.includes('card') || classes.includes('box') || classes.includes('panel')) {\n            return this.convertToCard(element);\n        }\n        \n        // Detectar footer\n        if (tagName === 'footer' || classes.includes('footer')) {\n            return this.convertToFooter(element);\n        }\n        \n        return null;\n    }\n\n    /**\n     * Convierte elemento en navbar especializado\n     */\n    convertToNavbar(element) {\n        element.setAttribute('data-component-type', 'navbar');\n        element.classList.add('component-navbar');\n        return element;\n    }\n\n    /**\n     * Convierte elemento en hero section\n     */\n    convertToHero(element) {\n        element.setAttribute('data-component-type', 'hero');\n        element.classList.add('component-hero');\n        return element;\n    }\n\n    /**\n     * Convierte elemento en card\n     */\n    convertToCard(element) {\n        element.setAttribute('data-component-type', 'card');\n        element.classList.add('component-card');\n        return element;\n    }\n\n    /**\n     * Convierte elemento en footer\n     */\n    convertToFooter(element) {\n        element.setAttribute('data-component-type', 'footer');\n        element.classList.add('component-footer');\n        return element;\n    }\n\n    /**\n     * Muestra mensaje de √©xito\n     */\n    showSuccess(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.log('SUCCESS:', message);\n        }\n    }\n\n    /**\n     * Muestra mensaje de error\n     */\n    showError(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.error('ERROR:', message);\n        }\n        alert(message);\n    }\n}\n\n// Exportar para uso en otros m√≥dulos\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = HTMLParser;\n}\n\n// Exportar globalmente para compatibilidad\nwindow.HTMLParser = HTMLParser;","/**\n * ProjectManager - Gestiona proyectos, persistencia y historial\n */\nclass ProjectManager {\n    constructor() {\n        this.storageKey = 'dragndrop_projects';\n        this.currentProjectKey = 'dragndrop_current_project';\n        this.autoSaveInterval = 30000; // 30 segundos\n        this.autoSaveTimer = null;\n        this.currentProject = null;\n        \n        this.init();\n    }\n\n    /**\n     * Inicializa el gestor de proyectos\n     */\n    init() {\n        this.loadCurrentProject();\n        this.startAutoSave();\n        this.setupEventListeners();\n    }\n\n    /**\n     * Crea un nuevo proyecto\n     */\n    createNewProject(name = null) {\n        const projectName = name || `Proyecto ${new Date().toLocaleDateString()}`;\n        \n        this.currentProject = {\n            id: this.generateId(),\n            name: projectName,\n            created: new Date().toISOString(),\n            modified: new Date().toISOString(),\n            html: '',\n            version: 1,\n            thumbnail: null\n        };\n        \n        this.saveCurrentProject();\n        this.showSuccess(`Nuevo proyecto \"${projectName}\" creado`);\n        \n        return this.currentProject;\n    }\n\n    /**\n     * Guarda el proyecto actual\n     */\n    saveCurrentProject() {\n        if (!this.currentProject) {\n            this.createNewProject();\n        }\n\n        // Capturar contenido actual del canvas\n        const canvas = document.getElementById('canvas');\n        if (canvas) {\n            this.currentProject.html = canvas.innerHTML;\n            this.currentProject.modified = new Date().toISOString();\n            \n            // Generar thumbnail\n            this.generateThumbnail().then(thumbnail => {\n                this.currentProject.thumbnail = thumbnail;\n                this.saveToStorage();\n            });\n        }\n        \n        // Guardar en localStorage como proyecto actual\n        localStorage.setItem(this.currentProjectKey, JSON.stringify(this.currentProject));\n    }\n\n    /**\n     * Guarda proyecto en el historial\n     */\n    saveToStorage() {\n        const projects = this.getStoredProjects();\n        \n        // Buscar si ya existe el proyecto\n        const existingIndex = projects.findIndex(p => p.id === this.currentProject.id);\n        \n        if (existingIndex >= 0) {\n            // Actualizar proyecto existente\n            projects[existingIndex] = { ...this.currentProject };\n        } else {\n            // Agregar nuevo proyecto\n            projects.unshift(this.currentProject);\n        }\n        \n        // Limitar a 20 proyectos m√°ximo\n        if (projects.length > 20) {\n            projects.splice(20);\n        }\n        \n        localStorage.setItem(this.storageKey, JSON.stringify(projects));\n    }\n\n    /**\n     * Carga el proyecto actual desde localStorage\n     */\n    loadCurrentProject() {\n        try {\n            const stored = localStorage.getItem(this.currentProjectKey);\n            if (stored) {\n                this.currentProject = JSON.parse(stored);\n                this.loadProjectToCanvas(this.currentProject);\n                this.showSuccess(`Proyecto \"${this.currentProject.name}\" restaurado`);\n            }\n        } catch (error) {\n            console.error('Error al cargar proyecto actual:', error);\n        }\n    }\n\n    /**\n     * Carga un proyecto espec√≠fico\n     */\n    loadProject(projectId) {\n        const projects = this.getStoredProjects();\n        const project = projects.find(p => p.id === projectId);\n        \n        if (project) {\n            this.currentProject = { ...project };\n            this.loadProjectToCanvas(project);\n            this.saveCurrentProject(); // Actualizar como proyecto actual\n            this.showSuccess(`Proyecto \"${project.name}\" cargado`);\n            return true;\n        }\n        \n        this.showError('Proyecto no encontrado');\n        return false;\n    }\n\n    /**\n     * Carga proyecto al canvas\n     */\n    loadProjectToCanvas(project) {\n        const canvas = document.getElementById('canvas');\n        if (canvas && project.html) {\n            canvas.innerHTML = project.html;\n            \n            // Re-aplicar eventos a los elementos cargados\n            this.reapplyEditorEvents();\n        }\n    }\n\n    /**\n     * Re-aplica eventos del editor a elementos cargados\n     */\n    reapplyEditorEvents() {\n        const elements = document.querySelectorAll('.canvas-element');\n        elements.forEach(element => {\n            // Limpiar eventos existentes\n            element.replaceWith(element.cloneNode(true));\n            const newElement = document.querySelector(`#${element.id}`);\n            \n            // Aplicar eventos del editor\n            newElement.addEventListener('click', function(e) {\n                e.stopPropagation();\n                if (window.selectElement) {\n                    window.selectElement(newElement);\n                }\n            });\n\n            newElement.addEventListener('dblclick', function(e) {\n                e.stopPropagation();\n                if (window.makeElementEditable) {\n                    window.makeElementEditable(newElement);\n                }\n            });\n\n            // Re-aplicar bot√≥n de eliminar\n            const deleteBtn = newElement.querySelector('.delete-btn');\n            if (deleteBtn) {\n                deleteBtn.onclick = function(e) {\n                    e.stopPropagation();\n                    if (window.deleteElement) {\n                        window.deleteElement(newElement);\n                    }\n                };\n            }\n        });\n    }\n\n    /**\n     * Obtiene todos los proyectos guardados\n     */\n    getStoredProjects() {\n        try {\n            const stored = localStorage.getItem(this.storageKey);\n            return stored ? JSON.parse(stored) : [];\n        } catch (error) {\n            console.error('Error al obtener proyectos:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Elimina un proyecto\n     */\n    deleteProject(projectId) {\n        const projects = this.getStoredProjects();\n        const filteredProjects = projects.filter(p => p.id !== projectId);\n        \n        localStorage.setItem(this.storageKey, JSON.stringify(filteredProjects));\n        \n        // Si es el proyecto actual, crear uno nuevo\n        if (this.currentProject && this.currentProject.id === projectId) {\n            this.createNewProject();\n        }\n        \n        this.showSuccess('Proyecto eliminado');\n    }\n\n    /**\n     * Duplica un proyecto\n     */\n    duplicateProject(projectId) {\n        const projects = this.getStoredProjects();\n        const project = projects.find(p => p.id === projectId);\n        \n        if (project) {\n            const duplicated = {\n                ...project,\n                id: this.generateId(),\n                name: `${project.name} (Copia)`,\n                created: new Date().toISOString(),\n                modified: new Date().toISOString()\n            };\n            \n            projects.unshift(duplicated);\n            localStorage.setItem(this.storageKey, JSON.stringify(projects));\n            \n            this.showSuccess(`Proyecto duplicado: \"${duplicated.name}\"`);\n            return duplicated;\n        }\n        \n        return null;\n    }\n\n    /**\n     * Renombra un proyecto\n     */\n    renameProject(projectId, newName) {\n        const projects = this.getStoredProjects();\n        const project = projects.find(p => p.id === projectId);\n        \n        if (project) {\n            project.name = newName;\n            project.modified = new Date().toISOString();\n            \n            localStorage.setItem(this.storageKey, JSON.stringify(projects));\n            \n            // Actualizar proyecto actual si es el mismo\n            if (this.currentProject && this.currentProject.id === projectId) {\n                this.currentProject.name = newName;\n                this.saveCurrentProject();\n            }\n            \n            this.showSuccess(`Proyecto renombrado a \"${newName}\"`);\n            return true;\n        }\n        \n        return false;\n    }\n\n    /**\n     * Exporta proyecto como JSON\n     */\n    exportProject(projectId = null) {\n        const project = projectId ? \n            this.getStoredProjects().find(p => p.id === projectId) : \n            this.currentProject;\n            \n        if (project) {\n            const blob = new Blob([JSON.stringify(project, null, 2)], { \n                type: 'application/json' \n            });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `${project.name}.json`;\n            a.click();\n            URL.revokeObjectURL(url);\n            \n            this.showSuccess(`Proyecto \"${project.name}\" exportado`);\n        }\n    }\n\n    /**\n     * Importa proyecto desde JSON\n     */\n    async importProject(file) {\n        try {\n            const content = await this.readFileAsText(file);\n            const project = JSON.parse(content);\n            \n            // Validar estructura del proyecto\n            if (!project.id || !project.name || !project.html) {\n                throw new Error('Formato de proyecto inv√°lido');\n            }\n            \n            // Asignar nuevo ID para evitar conflictos\n            project.id = this.generateId();\n            project.name = `${project.name} (Importado)`;\n            project.modified = new Date().toISOString();\n            \n            // Guardar proyecto\n            const projects = this.getStoredProjects();\n            projects.unshift(project);\n            localStorage.setItem(this.storageKey, JSON.stringify(projects));\n            \n            this.showSuccess(`Proyecto \"${project.name}\" importado`);\n            return project;\n            \n        } catch (error) {\n            this.showError(`Error al importar proyecto: ${error.message}`);\n            return null;\n        }\n    }\n\n    /**\n     * Inicia auto-guardado\n     */\n    startAutoSave() {\n        this.stopAutoSave(); // Limpiar timer existente\n        \n        this.autoSaveTimer = setInterval(() => {\n            if (this.currentProject) {\n                this.saveCurrentProject();\n                console.log('Auto-guardado realizado');\n            }\n        }, this.autoSaveInterval);\n    }\n\n    /**\n     * Detiene auto-guardado\n     */\n    stopAutoSave() {\n        if (this.autoSaveTimer) {\n            clearInterval(this.autoSaveTimer);\n            this.autoSaveTimer = null;\n        }\n    }\n\n    /**\n     * Configura event listeners\n     */\n    setupEventListeners() {\n        // Guardar antes de cerrar la ventana\n        window.addEventListener('beforeunload', () => {\n            this.saveCurrentProject();\n        });\n        \n        // Detectar cambios en el canvas para auto-guardado\n        const canvas = document.getElementById('canvas');\n        if (canvas) {\n            const observer = new MutationObserver(() => {\n                if (this.currentProject) {\n                    // Marcar como modificado\n                    this.currentProject.modified = new Date().toISOString();\n                }\n            });\n            \n            observer.observe(canvas, {\n                childList: true,\n                subtree: true,\n                attributes: true,\n                characterData: true\n            });\n        }\n    }\n\n    /**\n     * Genera thumbnail del proyecto\n     */\n    async generateThumbnail() {\n        try {\n            const canvas = document.getElementById('canvas');\n            if (!canvas) return null;\n            \n            // Usar html2canvas si est√° disponible, sino retornar null\n            if (typeof html2canvas !== 'undefined') {\n                const canvasElement = await html2canvas(canvas, {\n                    width: 300,\n                    height: 200,\n                    scale: 0.3\n                });\n                return canvasElement.toDataURL('image/jpeg', 0.7);\n            }\n            \n            return null;\n        } catch (error) {\n            console.error('Error generando thumbnail:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Genera ID √∫nico\n     */\n    generateId() {\n        return 'project_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    }\n\n    /**\n     * Lee archivo como texto\n     */\n    readFileAsText(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = e => resolve(e.target.result);\n            reader.onerror = e => reject(new Error('Error al leer archivo'));\n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * Obtiene informaci√≥n del proyecto actual\n     */\n    getCurrentProjectInfo() {\n        return this.currentProject ? { ...this.currentProject } : null;\n    }\n\n    /**\n     * Obtiene estad√≠sticas de proyectos\n     */\n    getProjectStats() {\n        const projects = this.getStoredProjects();\n        return {\n            total: projects.length,\n            current: this.currentProject ? this.currentProject.name : 'Sin proyecto',\n            lastModified: projects.length > 0 ? projects[0].modified : null\n        };\n    }\n\n    /**\n     * Muestra mensaje de √©xito\n     */\n    showSuccess(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.log('SUCCESS:', message);\n        }\n    }\n\n    /**\n     * Muestra mensaje de error\n     */\n    showError(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.error('ERROR:', message);\n        }\n    }\n}\n\n// Exportar para uso en otros m√≥dulos\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ProjectManager;\n}\n\n// Exportar globalmente para compatibilidad\nwindow.ProjectManager = ProjectManager;","/**\n * ComponentExtractor - Extrae y crea componentes reutilizables desde HTML importado\n */\nclass ComponentExtractor {\n    constructor() {\n        this.extractedComponents = [];\n        this.componentPatterns = {\n            navbar: {\n                selectors: ['nav', '.navbar', '.nav', '.navigation', '.header-nav'],\n                minElements: 2,\n                requiredElements: ['a', 'ul', 'li']\n            },\n            card: {\n                selectors: ['.card', '.box', '.panel', '.item', '.product'],\n                minElements: 2,\n                requiredElements: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'img']\n            },\n            hero: {\n                selectors: ['.hero', '.banner', '.jumbotron', '.intro', '.header-section'],\n                minElements: 2,\n                requiredElements: ['h1', 'h2', 'p', 'button', 'a']\n            },\n            footer: {\n                selectors: ['footer', '.footer', '.site-footer'],\n                minElements: 1,\n                requiredElements: ['p', 'a', 'ul']\n            },\n            form: {\n                selectors: ['form', '.form', '.contact-form'],\n                minElements: 2,\n                requiredElements: ['input', 'textarea', 'button', 'select']\n            },\n            gallery: {\n                selectors: ['.gallery', '.grid', '.portfolio', '.images'],\n                minElements: 3,\n                requiredElements: ['img']\n            },\n            testimonial: {\n                selectors: ['.testimonial', '.review', '.quote'],\n                minElements: 2,\n                requiredElements: ['p', 'blockquote']\n            },\n            pricing: {\n                selectors: ['.pricing', '.price', '.plan'],\n                minElements: 2,\n                requiredElements: ['h1', 'h2', 'h3', 'h4', 'span', 'button']\n            }\n        };\n    }\n\n    /**\n     * Extrae componentes de un documento HTML\n     */\n    extractComponents(htmlContent) {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(htmlContent, 'text/html');\n        \n        this.extractedComponents = [];\n        \n        // Buscar patrones de componentes\n        for (const [componentType, pattern] of Object.entries(this.componentPatterns)) {\n            this.findComponentsByPattern(doc, componentType, pattern);\n        }\n        \n        // Buscar componentes por estructura\n        this.findComponentsByStructure(doc);\n        \n        return this.extractedComponents;\n    }\n\n    /**\n     * Busca componentes basado en patrones predefinidos\n     */\n    findComponentsByPattern(doc, componentType, pattern) {\n        pattern.selectors.forEach(selector => {\n            const elements = doc.querySelectorAll(selector);\n            \n            elements.forEach(element => {\n                if (this.validateComponent(element, pattern)) {\n                    const component = this.createComponent(element, componentType);\n                    if (component) {\n                        this.extractedComponents.push(component);\n                    }\n                }\n            });\n        });\n    }\n\n    /**\n     * Busca componentes basado en estructura HTML\n     */\n    findComponentsByStructure(doc) {\n        // Buscar divs con m√∫ltiples elementos hijos que podr√≠an ser componentes\n        const containers = doc.querySelectorAll('div, section, article');\n        \n        containers.forEach(container => {\n            if (this.couldBeComponent(container)) {\n                const componentType = this.guessComponentType(container);\n                const component = this.createComponent(container, componentType);\n                if (component) {\n                    this.extractedComponents.push(component);\n                }\n            }\n        });\n    }\n\n    /**\n     * Valida si un elemento cumple con los requisitos de un patr√≥n\n     */\n    validateComponent(element, pattern) {\n        const childElements = element.querySelectorAll('*');\n        \n        // Verificar cantidad m√≠nima de elementos\n        if (childElements.length < pattern.minElements) {\n            return false;\n        }\n        \n        // Verificar elementos requeridos\n        const hasRequiredElements = pattern.requiredElements.some(selector => \n            element.querySelector(selector) !== null\n        );\n        \n        return hasRequiredElements;\n    }\n\n    /**\n     * Determina si un elemento podr√≠a ser un componente\n     */\n    couldBeComponent(element) {\n        const childElements = element.children;\n        const textContent = element.textContent.trim();\n        \n        // Debe tener al menos 2 elementos hijos o contenido significativo\n        if (childElements.length < 2 && textContent.length < 50) {\n            return false;\n        }\n        \n        // No debe ser demasiado grande (probablemente sea un layout)\n        if (childElements.length > 20) {\n            return false;\n        }\n        \n        // Debe tener cierta diversidad de elementos\n        const tagTypes = new Set(Array.from(childElements).map(el => el.tagName));\n        return tagTypes.size >= 2;\n    }\n\n    /**\n     * Intenta adivinar el tipo de componente basado en su contenido\n     */\n    guessComponentType(element) {\n        const classes = element.className.toLowerCase();\n        const textContent = element.textContent.toLowerCase();\n        \n        // Buscar palabras clave en clases\n        if (classes.includes('nav')) return 'navbar';\n        if (classes.includes('card') || classes.includes('box')) return 'card';\n        if (classes.includes('hero') || classes.includes('banner')) return 'hero';\n        if (classes.includes('footer')) return 'footer';\n        if (classes.includes('form')) return 'form';\n        if (classes.includes('gallery') || classes.includes('grid')) return 'gallery';\n        \n        // Buscar por contenido\n        if (element.querySelector('form')) return 'form';\n        if (element.querySelectorAll('img').length >= 3) return 'gallery';\n        if (element.querySelector('blockquote')) return 'testimonial';\n        if (textContent.includes('$') || textContent.includes('precio')) return 'pricing';\n        \n        // Por estructura\n        const hasHeading = element.querySelector('h1, h2, h3, h4, h5, h6');\n        const hasImage = element.querySelector('img');\n        const hasButton = element.querySelector('button, .btn, a[class*=\"btn\"]');\n        \n        if (hasHeading && hasImage && hasButton) return 'card';\n        if (hasHeading && hasButton && element.children.length <= 5) return 'hero';\n        \n        return 'custom';\n    }\n\n    /**\n     * Crea un objeto componente a partir de un elemento\n     */\n    createComponent(element, type) {\n        try {\n            // Limpiar elemento (remover scripts, etc.)\n            const cleanElement = this.cleanElement(element.cloneNode(true));\n            \n            const component = {\n                id: this.generateComponentId(),\n                type: type,\n                name: this.generateComponentName(cleanElement, type),\n                html: cleanElement.outerHTML,\n                css: this.extractElementCSS(element),\n                preview: this.generatePreview(cleanElement),\n                tags: this.generateTags(cleanElement, type),\n                created: new Date().toISOString()\n            };\n            \n            return component;\n        } catch (error) {\n            console.error('Error creando componente:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Limpia un elemento removiendo scripts y elementos no deseados\n     */\n    cleanElement(element) {\n        // Remover scripts\n        const scripts = element.querySelectorAll('script');\n        scripts.forEach(script => script.remove());\n        \n        // Remover comentarios\n        const walker = document.createTreeWalker(\n            element,\n            NodeFilter.SHOW_COMMENT,\n            null,\n            false\n        );\n        \n        const comments = [];\n        let node;\n        while (node = walker.nextNode()) {\n            comments.push(node);\n        }\n        comments.forEach(comment => comment.remove());\n        \n        // Limpiar atributos problem√°ticos\n        const allElements = element.querySelectorAll('*');\n        allElements.forEach(el => {\n            el.removeAttribute('onclick');\n            el.removeAttribute('onload');\n            el.removeAttribute('onerror');\n        });\n        \n        return element;\n    }\n\n    /**\n     * Extrae CSS relevante para un elemento\n     */\n    extractElementCSS(element) {\n        const css = [];\n        \n        // CSS inline\n        if (element.style.cssText) {\n            css.push(`/* Estilos inline */\\n.${element.className || 'component'} {\\n  ${element.style.cssText}\\n}`);\n        }\n        \n        // CSS de elementos hijos con estilos inline\n        const styledElements = element.querySelectorAll('[style]');\n        styledElements.forEach((el, index) => {\n            if (el.style.cssText) {\n                const selector = el.className ? `.${el.className}` : `element-${index}`;\n                css.push(`${selector} {\\n  ${el.style.cssText}\\n}`);\n            }\n        });\n        \n        return css.join('\\n\\n');\n    }\n\n    /**\n     * Genera preview del componente\n     */\n    generatePreview(element) {\n        // Crear una versi√≥n miniatura del HTML\n        const preview = element.cloneNode(true);\n        \n        // Simplificar contenido para preview\n        const textElements = preview.querySelectorAll('p, span, h1, h2, h3, h4, h5, h6');\n        textElements.forEach(el => {\n            if (el.textContent.length > 50) {\n                el.textContent = el.textContent.substring(0, 50) + '...';\n            }\n        });\n        \n        return preview.outerHTML;\n    }\n\n    /**\n     * Genera tags para el componente\n     */\n    generateTags(element, type) {\n        const tags = [type];\n        \n        // Tags basados en elementos contenidos\n        if (element.querySelector('img')) tags.push('imagen');\n        if (element.querySelector('button, .btn')) tags.push('bot√≥n');\n        if (element.querySelector('form')) tags.push('formulario');\n        if (element.querySelector('ul, ol')) tags.push('lista');\n        if (element.querySelector('table')) tags.push('tabla');\n        \n        // Tags basados en clases CSS\n        const classes = element.className.toLowerCase();\n        if (classes.includes('responsive')) tags.push('responsive');\n        if (classes.includes('dark')) tags.push('oscuro');\n        if (classes.includes('light')) tags.push('claro');\n        \n        return [...new Set(tags)]; // Remover duplicados\n    }\n\n    /**\n     * Genera nombre para el componente\n     */\n    generateComponentName(element, type) {\n        // Buscar texto representativo\n        const heading = element.querySelector('h1, h2, h3, h4, h5, h6');\n        if (heading && heading.textContent.trim()) {\n            const text = heading.textContent.trim().substring(0, 30);\n            return `${this.capitalizeFirst(type)} - ${text}`;\n        }\n        \n        // Buscar por clase CSS\n        if (element.className) {\n            const className = element.className.split(' ')[0];\n            return `${this.capitalizeFirst(type)} - ${className}`;\n        }\n        \n        // Nombre gen√©rico\n        const timestamp = new Date().toLocaleTimeString();\n        return `${this.capitalizeFirst(type)} ${timestamp}`;\n    }\n\n    /**\n     * Genera ID √∫nico para componente\n     */\n    generateComponentId() {\n        return 'comp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n    }\n\n    /**\n     * Capitaliza primera letra\n     */\n    capitalizeFirst(str) {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    }\n\n    /**\n     * Guarda componentes extra√≠dos en localStorage\n     */\n    saveExtractedComponents() {\n        const storageKey = 'dragndrop_extracted_components';\n        const existing = this.getStoredComponents();\n        \n        // Agregar nuevos componentes\n        const updated = [...existing, ...this.extractedComponents];\n        \n        // Limitar a 50 componentes m√°ximo\n        if (updated.length > 50) {\n            updated.splice(50);\n        }\n        \n        localStorage.setItem(storageKey, JSON.stringify(updated));\n        \n        return this.extractedComponents.length;\n    }\n\n    /**\n     * Obtiene componentes guardados\n     */\n    getStoredComponents() {\n        try {\n            const storageKey = 'dragndrop_extracted_components';\n            const stored = localStorage.getItem(storageKey);\n            return stored ? JSON.parse(stored) : [];\n        } catch (error) {\n            console.error('Error al obtener componentes:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Elimina componente guardado\n     */\n    deleteStoredComponent(componentId) {\n        const storageKey = 'dragndrop_extracted_components';\n        const components = this.getStoredComponents();\n        const filtered = components.filter(c => c.id !== componentId);\n        \n        localStorage.setItem(storageKey, JSON.stringify(filtered));\n    }\n\n    /**\n     * Busca componentes por tags\n     */\n    searchComponents(query) {\n        const components = this.getStoredComponents();\n        const searchTerm = query.toLowerCase();\n        \n        return components.filter(component => \n            component.name.toLowerCase().includes(searchTerm) ||\n            component.type.toLowerCase().includes(searchTerm) ||\n            component.tags.some(tag => tag.toLowerCase().includes(searchTerm))\n        );\n    }\n}\n\n// Exportar para uso en otros m√≥dulos\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ComponentExtractor;\n}\n\n// Exportar globalmente para compatibilidad\nwindow.ComponentExtractor = ComponentExtractor;","/**\n * UndoRedoManager - Sistema de deshacer/rehacer cambios\n */\nclass UndoRedoManager {\n    constructor() {\n        this.history = [];\n        this.currentIndex = -1;\n        this.maxHistorySize = 50;\n        this.isProcessing = false;\n    }\n\n    /**\n     * Inicializa el gestor\n     */\n    init() {\n        this.saveInitialState();\n        this.setupEventListeners();\n    }\n\n    /**\n     * Guarda estado inicial\n     */\n    saveInitialState() {\n        const canvas = document.getElementById('canvas');\n        if (canvas) {\n            this.saveState({\n                type: 'initial',\n                description: 'Estado inicial'\n            });\n        }\n    }\n\n    /**\n     * Guarda estado actual\n     */\n    saveState(action = {}) {\n        if (this.isProcessing) return;\n\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return;\n\n        // Capturar estado del canvas\n        const state = {\n            html: canvas.innerHTML,\n            timestamp: Date.now(),\n            action: {\n                type: action.type || 'unknown',\n                description: action.description || 'Cambio',\n                elementId: action.elementId || null\n            }\n        };\n\n        // Eliminar estados futuros si estamos en medio del historial\n        if (this.currentIndex < this.history.length - 1) {\n            this.history.splice(this.currentIndex + 1);\n        }\n\n        // Agregar nuevo estado\n        this.history.push(state);\n        this.currentIndex++;\n\n        // Limitar tama√±o del historial\n        if (this.history.length > this.maxHistorySize) {\n            this.history.shift();\n            this.currentIndex--;\n        }\n\n        this.updateUI();\n    }\n\n    /**\n     * Deshace √∫ltimo cambio\n     */\n    undo() {\n        if (!this.canUndo()) {\n            this.showMessage('No hay cambios para deshacer');\n            return false;\n        }\n\n        this.currentIndex--;\n        this.restoreState(this.history[this.currentIndex]);\n        this.updateUI();\n        this.showMessage('Deshecho');\n        return true;\n    }\n\n    /**\n     * Rehace cambio\n     */\n    redo() {\n        if (!this.canRedo()) {\n            this.showMessage('No hay cambios para rehacer');\n            return false;\n        }\n\n        this.currentIndex++;\n        this.restoreState(this.history[this.currentIndex]);\n        this.updateUI();\n        this.showMessage('Rehecho');\n        return true;\n    }\n\n    /**\n     * Verifica si se puede deshacer\n     */\n    canUndo() {\n        return this.currentIndex > 0;\n    }\n\n    /**\n     * Verifica si se puede rehacer\n     */\n    canRedo() {\n        return this.currentIndex < this.history.length - 1;\n    }\n\n    /**\n     * Restaura un estado\n     */\n    restoreState(state) {\n        this.isProcessing = true;\n\n        const canvas = document.getElementById('canvas');\n        if (canvas && state) {\n            canvas.innerHTML = state.html;\n            \n            // Re-aplicar eventos del editor\n            if (window.projectManager) {\n                window.projectManager.reapplyEditorEvents();\n            }\n        }\n\n        this.isProcessing = false;\n    }\n\n    /**\n     * Configura listeners de eventos\n     */\n    setupEventListeners() {\n        // Atajos de teclado\n        document.addEventListener('keydown', (e) => {\n            // Ctrl+Z o Cmd+Z: Deshacer\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                this.undo();\n            }\n            \n            // Ctrl+Shift+Z o Cmd+Shift+Z: Rehacer\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {\n                e.preventDefault();\n                this.redo();\n            }\n            \n            // Ctrl+Y o Cmd+Y: Rehacer (alternativo)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n                e.preventDefault();\n                this.redo();\n            }\n        });\n\n        // Detectar cambios en el canvas\n        const canvas = document.getElementById('canvas');\n        if (canvas) {\n            // Usar MutationObserver para detectar cambios\n            const observer = new MutationObserver((mutations) => {\n                if (!this.isProcessing && mutations.length > 0) {\n                    // Debounce para evitar guardar demasiados estados\n                    clearTimeout(this.saveTimeout);\n                    this.saveTimeout = setTimeout(() => {\n                        this.saveState({\n                            type: 'edit',\n                            description: 'Edici√≥n de contenido'\n                        });\n                    }, 500);\n                }\n            });\n\n            observer.observe(canvas, {\n                childList: true,\n                subtree: true,\n                attributes: true,\n                characterData: true\n            });\n        }\n    }\n\n    /**\n     * Actualiza UI (botones deshacer/rehacer)\n     */\n    updateUI() {\n        const undoBtn = document.getElementById('undoBtn');\n        const redoBtn = document.getElementById('redoBtn');\n\n        if (undoBtn) {\n            undoBtn.disabled = !this.canUndo();\n            undoBtn.title = this.canUndo() \n                ? `Deshacer: ${this.history[this.currentIndex - 1]?.action.description || ''}`\n                : 'No hay cambios para deshacer';\n        }\n\n        if (redoBtn) {\n            redoBtn.disabled = !this.canRedo();\n            redoBtn.title = this.canRedo()\n                ? `Rehacer: ${this.history[this.currentIndex + 1]?.action.description || ''}`\n                : 'No hay cambios para rehacer';\n        }\n    }\n\n    /**\n     * Obtiene historial\n     */\n    getHistory() {\n        return this.history.map((state, index) => ({\n            index: index,\n            isCurrent: index === this.currentIndex,\n            description: state.action.description,\n            timestamp: new Date(state.timestamp).toLocaleString()\n        }));\n    }\n\n    /**\n     * Salta a un estado espec√≠fico del historial\n     */\n    jumpToState(index) {\n        if (index >= 0 && index < this.history.length) {\n            this.currentIndex = index;\n            this.restoreState(this.history[this.currentIndex]);\n            this.updateUI();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Limpia historial\n     */\n    clearHistory() {\n        this.history = [];\n        this.currentIndex = -1;\n        this.saveInitialState();\n    }\n\n    /**\n     * Muestra mensaje\n     */\n    showMessage(message) {\n        if (window.showToast) {\n            window.showToast(message);\n        } else {\n            console.log(message);\n        }\n    }\n}\n\n// Exportar\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = UndoRedoManager;\n}\n\nwindow.UndoRedoManager = UndoRedoManager;\n","/**\n * KeyboardShortcutsManager - Gestiona atajos de teclado del editor\n */\nclass KeyboardShortcutsManager {\n    constructor() {\n        this.shortcuts = new Map();\n        this.init();\n    }\n\n    /**\n     * Inicializa el gestor\n     */\n    init() {\n        this.registerDefaultShortcuts();\n        this.setupEventListener();\n    }\n\n    /**\n     * Registra atajos por defecto\n     */\n    registerDefaultShortcuts() {\n        // Archivo\n        this.register('ctrl+s', 'Guardar proyecto', () => {\n            if (window.projectManager) {\n                window.projectManager.saveCurrentProject();\n            }\n        });\n\n        this.register('ctrl+shift+s', 'Guardar como...', () => {\n            if (window.showProjectsPanel) {\n                window.showProjectsPanel();\n            }\n        });\n\n        this.register('ctrl+o', 'Abrir proyecto', () => {\n            if (window.showProjectsPanel) {\n                window.showProjectsPanel();\n            }\n        });\n\n        this.register('ctrl+n', 'Nuevo proyecto', () => {\n            if (window.newProject) {\n                window.newProject();\n            }\n        });\n\n        // Edici√≥n (gestionados por UndoRedoManager)\n        this.register('ctrl+z', 'Deshacer', () => {\n            if (window.undoRedoManager) {\n                window.undoRedoManager.undo();\n            }\n        });\n\n        this.register('ctrl+shift+z', 'Rehacer', () => {\n            if (window.undoRedoManager) {\n                window.undoRedoManager.redo();\n            }\n        });\n\n        this.register('ctrl+y', 'Rehacer (alt)', () => {\n            if (window.undoRedoManager) {\n                window.undoRedoManager.redo();\n            }\n        });\n\n        // Selecci√≥n y edici√≥n\n        this.register('delete', 'Eliminar elemento', () => {\n            if (window.selectedElement && window.deleteElement) {\n                window.deleteElement(window.selectedElement);\n            }\n        });\n\n        this.register('backspace', 'Eliminar elemento (alt)', () => {\n            const target = event.target;\n            if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && \n                !target.isContentEditable && window.selectedElement && window.deleteElement) {\n                event.preventDefault();\n                window.deleteElement(window.selectedElement);\n            }\n        });\n\n        this.register('escape', 'Deseleccionar', () => {\n            if (window.selectedElement) {\n                window.selectedElement.classList.remove('selected');\n                window.selectedElement = null;\n                \n                const propertiesPanel = document.getElementById('propertiesPanel');\n                if (propertiesPanel) {\n                    propertiesPanel.innerHTML = `\n                        <h2 class=\"panel-title\">Propiedades</h2>\n                        <div class=\"properties-empty\">\n                            ‚Üê Arrastra componentes al canvas o selecciona un elemento para editar sus propiedades\n                        </div>\n                    `;\n                }\n            }\n        });\n\n        this.register('ctrl+d', 'Duplicar elemento', () => {\n            if (window.selectedElement) {\n                const clone = window.selectedElement.cloneNode(true);\n                clone.id = 'element-' + (window.elementIdCounter++);\n                \n                // Re-aplicar eventos\n                if (window.setupElementDragAndDrop) {\n                    window.setupElementDragAndDrop(clone);\n                }\n                \n                window.selectedElement.parentNode.insertBefore(\n                    clone, \n                    window.selectedElement.nextSibling\n                );\n                \n                if (window.showToast) {\n                    window.showToast('Elemento duplicado');\n                }\n            }\n        });\n\n        // Navegaci√≥n\n        this.register('ctrl+shift+p', 'Panel de comandos', () => {\n            this.showCommandPalette();\n        });\n\n        this.register('ctrl+/', 'Ayuda r√°pida', () => {\n            this.showQuickHelp();\n        });\n\n        // Vistas\n        this.register('ctrl+1', 'Vista escritorio', () => {\n            if (window.setCanvasSize) {\n                window.setCanvasSize('desktop');\n            }\n        });\n\n        this.register('ctrl+2', 'Vista tablet', () => {\n            if (window.setCanvasSize) {\n                window.setCanvasSize('tablet');\n            }\n        });\n\n        this.register('ctrl+3', 'Vista m√≥vil', () => {\n            if (window.setCanvasSize) {\n                window.setCanvasSize('mobile');\n            }\n        });\n\n        // Exportar\n        this.register('ctrl+e', 'Exportar HTML', () => {\n            if (window.exportHTML) {\n                window.exportHTML();\n            }\n        });\n\n        this.register('ctrl+shift+e', 'Exportar todo', () => {\n            if (window.exportZip) {\n                window.exportZip();\n            }\n        });\n\n        // Plantillas y componentes\n        this.register('ctrl+t', 'Plantillas', () => {\n            if (window.showGallery) {\n                window.showGallery();\n            }\n        });\n\n        this.register('ctrl+shift+c', 'Componentes', () => {\n            if (window.showComponentsLibrary) {\n                window.showComponentsLibrary();\n            }\n        });\n    }\n\n    /**\n     * Registra un atajo de teclado\n     */\n    register(shortcut, description, callback) {\n        const normalizedShortcut = this.normalizeShortcut(shortcut);\n        this.shortcuts.set(normalizedShortcut, {\n            description,\n            callback,\n            originalShortcut: shortcut\n        });\n    }\n\n    /**\n     * Normaliza un atajo de teclado\n     */\n    normalizeShortcut(shortcut) {\n        return shortcut.toLowerCase()\n            .replace('command', 'ctrl')\n            .replace('cmd', 'ctrl')\n            .split('+')\n            .sort()\n            .join('+');\n    }\n\n    /**\n     * Convierte evento a string de atajo\n     */\n    eventToShortcut(event) {\n        const keys = [];\n        \n        if (event.ctrlKey || event.metaKey) keys.push('ctrl');\n        if (event.shiftKey) keys.push('shift');\n        if (event.altKey) keys.push('alt');\n        \n        const key = event.key.toLowerCase();\n        if (!['control', 'shift', 'alt', 'meta'].includes(key)) {\n            keys.push(key);\n        }\n        \n        return keys.sort().join('+');\n    }\n\n    /**\n     * Configura listener de eventos\n     */\n    setupEventListener() {\n        document.addEventListener('keydown', (event) => {\n            const shortcut = this.eventToShortcut(event);\n            const shortcutData = this.shortcuts.get(shortcut);\n            \n            if (shortcutData) {\n                // Evitar ejecuci√≥n si estamos en input/textarea\n                const target = event.target;\n                if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || \n                    target.isContentEditable) {\n                    // Permitir solo ciertos atajos en campos de texto\n                    if (!['ctrl+s', 'ctrl+z', 'ctrl+y', 'ctrl+shift+z'].includes(shortcut)) {\n                        return;\n                    }\n                }\n                \n                event.preventDefault();\n                shortcutData.callback(event);\n            }\n        });\n    }\n\n    /**\n     * Muestra paleta de comandos\n     */\n    showCommandPalette() {\n        const modal = document.createElement('div');\n        modal.className = 'command-palette-modal';\n        modal.innerHTML = `\n            <div class=\"command-palette-content\">\n                <div class=\"command-palette-header\">\n                    <input type=\"text\" id=\"commandSearch\" placeholder=\"Buscar comando o atajo...\" autofocus>\n                    <button onclick=\"this.closest('.command-palette-modal').remove()\">&times;</button>\n                </div>\n                <div class=\"command-palette-list\" id=\"commandPaletteList\">\n                    ${this.renderCommandList()}\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(modal);\n        \n        // Cerrar con ESC\n        modal.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                modal.remove();\n            }\n        });\n        \n        // B√∫squeda\n        const searchInput = modal.querySelector('#commandSearch');\n        searchInput.addEventListener('input', () => {\n            const query = searchInput.value.toLowerCase();\n            const list = modal.querySelector('#commandPaletteList');\n            list.innerHTML = this.renderCommandList(query);\n        });\n        \n        // Focus en input\n        searchInput.focus();\n    }\n\n    /**\n     * Renderiza lista de comandos\n     */\n    renderCommandList(filter = '') {\n        const commands = Array.from(this.shortcuts.entries())\n            .filter(([shortcut, data]) => {\n                if (!filter) return true;\n                return shortcut.includes(filter) || \n                       data.description.toLowerCase().includes(filter);\n            })\n            .map(([shortcut, data]) => `\n                <div class=\"command-item\" onclick=\"event.stopPropagation(); this.closest('.command-palette-modal').querySelector('button').click(); ${data.callback.toString().match(/\\{([\\s\\S]*)\\}/)[1]}\">\n                    <span class=\"command-description\">${data.description}</span>\n                    <span class=\"command-shortcut\">${data.originalShortcut.toUpperCase()}</span>\n                </div>\n            `);\n        \n        return commands.length > 0 \n            ? commands.join('') \n            : '<div class=\"command-empty\">No se encontraron comandos</div>';\n    }\n\n    /**\n     * Muestra ayuda r√°pida\n     */\n    showQuickHelp() {\n        const helpContent = Array.from(this.shortcuts.entries())\n            .map(([shortcut, data]) => `\n                <tr>\n                    <td><kbd>${data.originalShortcut.toUpperCase()}</kbd></td>\n                    <td>${data.description}</td>\n                </tr>\n            `)\n            .join('');\n        \n        const modal = document.createElement('div');\n        modal.className = 'quick-help-modal';\n        modal.innerHTML = `\n            <div class=\"quick-help-content\">\n                <div class=\"quick-help-header\">\n                    <h3>Atajos de Teclado</h3>\n                    <button onclick=\"this.closest('.quick-help-modal').remove()\">&times;</button>\n                </div>\n                <div class=\"quick-help-body\">\n                    <table class=\"shortcuts-table\">\n                        <thead>\n                            <tr>\n                                <th>Atajo</th>\n                                <th>Descripci√≥n</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${helpContent}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(modal);\n        \n        // Cerrar con ESC o click fuera\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) {\n                modal.remove();\n            }\n        });\n        \n        modal.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                modal.remove();\n            }\n        });\n    }\n\n    /**\n     * Obtiene todos los atajos\n     */\n    getAllShortcuts() {\n        return Array.from(this.shortcuts.entries()).map(([shortcut, data]) => ({\n            shortcut: data.originalShortcut,\n            description: data.description\n        }));\n    }\n\n    /**\n     * Elimina un atajo\n     */\n    unregister(shortcut) {\n        const normalized = this.normalizeShortcut(shortcut);\n        return this.shortcuts.delete(normalized);\n    }\n}\n\n// Exportar\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = KeyboardShortcutsManager;\n}\n\nwindow.KeyboardShortcutsManager = KeyboardShortcutsManager;\n","/**\n * ResponsiveTester - Herramienta para probar dise√±os responsive\n */\nclass ResponsiveTester {\n    constructor() {\n        this.devices = {\n            'mobile-small': {\n                name: 'Mobile S',\n                width: 320,\n                height: 568,\n                icon: 'üì±'\n            },\n            'mobile': {\n                name: 'Mobile',\n                width: 375,\n                height: 667,\n                icon: 'üì±'\n            },\n            'mobile-large': {\n                name: 'Mobile L',\n                width: 425,\n                height: 812,\n                icon: 'üì±'\n            },\n            'tablet': {\n                name: 'Tablet',\n                width: 768,\n                height: 1024,\n                icon: 'üì±'\n            },\n            'laptop': {\n                name: 'Laptop',\n                width: 1024,\n                height: 768,\n                icon: 'üíª'\n            },\n            'laptop-large': {\n                name: 'Laptop L',\n                width: 1440,\n                height: 900,\n                icon: 'üíª'\n            },\n            'desktop': {\n                name: 'Desktop',\n                width: 1920,\n                height: 1080,\n                icon: 'üñ•Ô∏è'\n            },\n            '4k': {\n                name: '4K',\n                width: 2560,\n                height: 1440,\n                icon: 'üñ•Ô∏è'\n            }\n        };\n        \n        this.customSizes = this.loadCustomSizes();\n        this.currentDevice = 'desktop';\n        this.orientation = 'portrait';\n    }\n\n    /**\n     * Inicializa el tester\n     */\n    init() {\n        this.createTestPanel();\n        this.setupEventListeners();\n    }\n\n    /**\n     * Crea panel de testing responsive\n     */\n    createTestPanel() {\n        const existingPanel = document.getElementById('responsiveTesterPanel');\n        if (existingPanel) return;\n\n        const panel = document.createElement('div');\n        panel.id = 'responsiveTesterPanel';\n        panel.className = 'responsive-tester-panel hidden';\n        panel.innerHTML = `\n            <div class=\"panel-overlay\" onclick=\"closeResponsiveTester()\"></div>\n            <div class=\"panel-content\">\n                <div class=\"panel-header\">\n                    <h2>üîç Responsive Tester</h2>\n                    <button class=\"close-panel-btn\" onclick=\"closeResponsiveTester()\">&times;</button>\n                </div>\n                <div class=\"panel-body\">\n                    <div class=\"device-selector\">\n                        <h3>Dispositivos Predefinidos</h3>\n                        <div class=\"device-grid\" id=\"deviceGrid\">\n                            ${this.renderDeviceButtons()}\n                        </div>\n                    </div>\n                    \n                    <div class=\"custom-size-section\">\n                        <h3>Tama√±o Personalizado</h3>\n                        <div class=\"custom-size-inputs\">\n                            <div class=\"input-group\">\n                                <label>Ancho (px)</label>\n                                <input type=\"number\" id=\"customWidth\" value=\"1024\" min=\"320\" max=\"3840\">\n                            </div>\n                            <div class=\"input-group\">\n                                <label>Alto (px)</label>\n                                <input type=\"number\" id=\"customHeight\" value=\"768\" min=\"320\" max=\"2160\">\n                            </div>\n                            <button class=\"btn primary\" onclick=\"applyCustomSize()\">Aplicar</button>\n                        </div>\n                    </div>\n                    \n                    <div class=\"orientation-section\">\n                        <h3>Orientaci√≥n</h3>\n                        <div class=\"orientation-buttons\">\n                            <button class=\"btn\" id=\"portraitBtn\" onclick=\"setOrientation('portrait')\">üì± Portrait</button>\n                            <button class=\"btn\" id=\"landscapeBtn\" onclick=\"setOrientation('landscape')\">üì± Landscape</button>\n                        </div>\n                    </div>\n                    \n                    <div class=\"test-info\">\n                        <div class=\"current-size\" id=\"currentSizeInfo\">\n                            <strong>Tama√±o actual:</strong> <span id=\"currentSizeDisplay\">1920 x 1080</span>\n                        </div>\n                        <div class=\"breakpoint-info\" id=\"breakpointInfo\">\n                            <strong>Breakpoint:</strong> <span id=\"breakpointDisplay\">Desktop</span>\n                        </div>\n                    </div>\n                    \n                    <div class=\"test-actions\">\n                        <button class=\"btn\" onclick=\"takeScreenshot()\">üì∏ Capturar Pantalla</button>\n                        <button class=\"btn\" onclick=\"testAllSizes()\">üéØ Probar Todos los Tama√±os</button>\n                        <button class=\"btn\" onclick=\"resetCanvas()\">‚Ü∫ Restablecer</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(panel);\n    }\n\n    /**\n     * Renderiza botones de dispositivos\n     */\n    renderDeviceButtons() {\n        return Object.entries(this.devices).map(([key, device]) => `\n            <button class=\"device-btn\" onclick=\"setDeviceSize('${key}')\">\n                <span class=\"device-icon\">${device.icon}</span>\n                <span class=\"device-name\">${device.name}</span>\n                <span class=\"device-size\">${device.width} √ó ${device.height}</span>\n            </button>\n        `).join('');\n    }\n\n    /**\n     * Establece tama√±o del canvas\n     */\n    setSize(width, height) {\n        const wrapper = document.getElementById('canvasWrapper');\n        if (!wrapper) return;\n\n        wrapper.style.width = width + 'px';\n        wrapper.style.height = height + 'px';\n        wrapper.style.transition = 'all 0.3s ease';\n\n        this.updateSizeDisplay(width, height);\n        this.updateBreakpointDisplay(width);\n    }\n\n    /**\n     * Establece tama√±o por dispositivo\n     */\n    setDeviceSize(deviceKey) {\n        const device = this.devices[deviceKey];\n        if (!device) return;\n\n        this.currentDevice = deviceKey;\n        \n        let width = device.width;\n        let height = device.height;\n        \n        if (this.orientation === 'landscape') {\n            [width, height] = [height, width];\n        }\n        \n        this.setSize(width, height);\n        \n        if (window.showToast) {\n            window.showToast(`Vista ${device.name} aplicada`);\n        }\n    }\n\n    /**\n     * Establece orientaci√≥n\n     */\n    setOrientation(orientation) {\n        this.orientation = orientation;\n        \n        // Actualizar botones\n        const portraitBtn = document.getElementById('portraitBtn');\n        const landscapeBtn = document.getElementById('landscapeBtn');\n        \n        if (portraitBtn && landscapeBtn) {\n            portraitBtn.classList.toggle('active', orientation === 'portrait');\n            landscapeBtn.classList.toggle('active', orientation === 'landscape');\n        }\n        \n        // Re-aplicar tama√±o actual con nueva orientaci√≥n\n        if (this.currentDevice) {\n            this.setDeviceSize(this.currentDevice);\n        }\n    }\n\n    /**\n     * Aplica tama√±o personalizado\n     */\n    applyCustomSize() {\n        const widthInput = document.getElementById('customWidth');\n        const heightInput = document.getElementById('customHeight');\n        \n        if (widthInput && heightInput) {\n            const width = parseInt(widthInput.value);\n            const height = parseInt(heightInput.value);\n            \n            if (width && height && width >= 320 && height >= 320) {\n                this.setSize(width, height);\n                \n                if (window.showToast) {\n                    window.showToast(`Tama√±o personalizado ${width}√ó${height} aplicado`);\n                }\n            }\n        }\n    }\n\n    /**\n     * Actualiza display de tama√±o\n     */\n    updateSizeDisplay(width, height) {\n        const display = document.getElementById('currentSizeDisplay');\n        if (display) {\n            display.textContent = `${width} √ó ${height}`;\n        }\n    }\n\n    /**\n     * Actualiza display de breakpoint\n     */\n    updateBreakpointDisplay(width) {\n        const display = document.getElementById('breakpointDisplay');\n        if (!display) return;\n\n        let breakpoint = '';\n        \n        if (width < 576) {\n            breakpoint = 'Extra Small (< 576px)';\n        } else if (width < 768) {\n            breakpoint = 'Small (576px - 768px)';\n        } else if (width < 992) {\n            breakpoint = 'Medium (768px - 992px)';\n        } else if (width < 1200) {\n            breakpoint = 'Large (992px - 1200px)';\n        } else if (width < 1400) {\n            breakpoint = 'Extra Large (1200px - 1400px)';\n        } else {\n            breakpoint = 'XXL (> 1400px)';\n        }\n        \n        display.textContent = breakpoint;\n    }\n\n    /**\n     * Captura pantalla del canvas\n     */\n    async takeScreenshot() {\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return;\n\n        try {\n            if (typeof html2canvas !== 'undefined') {\n                const canvasElement = await html2canvas(canvas);\n                const dataUrl = canvasElement.toDataURL('image/png');\n                \n                // Descargar imagen\n                const a = document.createElement('a');\n                a.href = dataUrl;\n                a.download = `screenshot-${Date.now()}.png`;\n                a.click();\n                \n                if (window.showToast) {\n                    window.showToast('Captura guardada');\n                }\n            } else {\n                if (window.showToast) {\n                    window.showToast('html2canvas no est√° disponible', 'error');\n                }\n            }\n        } catch (error) {\n            console.error('Error capturando pantalla:', error);\n            if (window.showToast) {\n                window.showToast('Error al capturar pantalla', 'error');\n            }\n        }\n    }\n\n    /**\n     * Prueba todos los tama√±os\n     */\n    async testAllSizes() {\n        const devices = Object.keys(this.devices);\n        let currentIndex = 0;\n\n        const testNext = () => {\n            if (currentIndex >= devices.length) {\n                if (window.showToast) {\n                    window.showToast('Prueba de todos los tama√±os completada');\n                }\n                return;\n            }\n\n            this.setDeviceSize(devices[currentIndex]);\n            currentIndex++;\n\n            setTimeout(testNext, 1500);\n        };\n\n        testNext();\n    }\n\n    /**\n     * Restablece canvas\n     */\n    resetCanvas() {\n        this.setDeviceSize('desktop');\n        this.setOrientation('portrait');\n        \n        if (window.showToast) {\n            window.showToast('Canvas restablecido');\n        }\n    }\n\n    /**\n     * Configura listeners\n     */\n    setupEventListeners() {\n        // Listeners ya configurados en los botones HTML\n    }\n\n    /**\n     * Guarda tama√±os personalizados\n     */\n    saveCustomSize(name, width, height) {\n        this.customSizes.push({ name, width, height });\n        localStorage.setItem('dragndrop_custom_sizes', JSON.stringify(this.customSizes));\n    }\n\n    /**\n     * Carga tama√±os personalizados\n     */\n    loadCustomSizes() {\n        try {\n            const stored = localStorage.getItem('dragndrop_custom_sizes');\n            return stored ? JSON.parse(stored) : [];\n        } catch (error) {\n            return [];\n        }\n    }\n}\n\n// Funciones globales para los botones\nfunction openResponsiveTester() {\n    const panel = document.getElementById('responsiveTesterPanel');\n    if (panel) {\n        panel.classList.remove('hidden');\n    } else {\n        const tester = new ResponsiveTester();\n        tester.init();\n        tester.createTestPanel();\n        const newPanel = document.getElementById('responsiveTesterPanel');\n        if (newPanel) {\n            newPanel.classList.remove('hidden');\n        }\n    }\n}\n\nfunction closeResponsiveTester() {\n    const panel = document.getElementById('responsiveTesterPanel');\n    if (panel) {\n        panel.classList.add('hidden');\n    }\n}\n\nfunction setDeviceSize(deviceKey) {\n    if (window.responsiveTester) {\n        window.responsiveTester.setDeviceSize(deviceKey);\n    }\n}\n\nfunction setOrientation(orientation) {\n    if (window.responsiveTester) {\n        window.responsiveTester.setOrientation(orientation);\n    }\n}\n\nfunction applyCustomSize() {\n    if (window.responsiveTester) {\n        window.responsiveTester.applyCustomSize();\n    }\n}\n\nfunction takeScreenshot() {\n    if (window.responsiveTester) {\n        window.responsiveTester.takeScreenshot();\n    }\n}\n\nfunction testAllSizes() {\n    if (window.responsiveTester) {\n        window.responsiveTester.testAllSizes();\n    }\n}\n\nfunction resetCanvas() {\n    if (window.responsiveTester) {\n        window.responsiveTester.resetCanvas();\n    }\n}\n\n// Exportar\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ResponsiveTester;\n}\n\nwindow.ResponsiveTester = ResponsiveTester;\n","/**\n * LivePreview - Vista previa en tiempo real en navegador separado\n */\nclass LivePreview {\n    constructor() {\n        this.previewWindow = null;\n        this.isLive = false;\n        this.updateInterval = null;\n        this.updateDelay = 1000; // 1 segundo\n    }\n\n    /**\n     * Inicia vista previa en vivo\n     */\n    start() {\n        if (this.isLive) {\n            if (window.showToast) {\n                window.showToast('Vista previa ya est√° activa');\n            }\n            return;\n        }\n\n        // Abrir ventana de preview\n        this.openPreviewWindow();\n        \n        // Iniciar actualizaciones\n        this.startUpdates();\n        \n        this.isLive = true;\n        \n        if (window.showToast) {\n            window.showToast('Vista previa en vivo iniciada');\n        }\n    }\n\n    /**\n     * Detiene vista previa\n     */\n    stop() {\n        if (!this.isLive) return;\n\n        this.stopUpdates();\n        \n        if (this.previewWindow && !this.previewWindow.closed) {\n            this.previewWindow.close();\n        }\n        \n        this.previewWindow = null;\n        this.isLive = false;\n        \n        if (window.showToast) {\n            window.showToast('Vista previa detenida');\n        }\n    }\n\n    /**\n     * Abre ventana de preview\n     */\n    openPreviewWindow() {\n        const width = 1200;\n        const height = 800;\n        const left = (screen.width / 2) - (width / 2);\n        const top = (screen.height / 2) - (height / 2);\n\n        this.previewWindow = window.open(\n            '',\n            'Live Preview',\n            `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`\n        );\n\n        if (this.previewWindow) {\n            this.updatePreview();\n        } else {\n            if (window.showToast) {\n                window.showToast('No se pudo abrir la ventana de vista previa. Verifica los permisos de ventanas emergentes.', 'error');\n            }\n        }\n    }\n\n    /**\n     * Actualiza contenido de preview\n     */\n    updatePreview() {\n        if (!this.previewWindow || this.previewWindow.closed) {\n            this.stop();\n            return;\n        }\n\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return;\n\n        const html = this.generatePreviewHTML(canvas);\n        \n        try {\n            this.previewWindow.document.open();\n            this.previewWindow.document.write(html);\n            this.previewWindow.document.close();\n        } catch (error) {\n            console.error('Error actualizando preview:', error);\n            this.stop();\n        }\n    }\n\n    /**\n     * Genera HTML completo para preview\n     */\n    generatePreviewHTML(canvas) {\n        const clone = canvas.cloneNode(true);\n\n        // Limpiar elementos del editor\n        const elements = clone.querySelectorAll('.canvas-element');\n        elements.forEach(el => {\n            el.classList.remove('canvas-element', 'selected');\n            const deleteBtn = el.querySelector('.delete-btn');\n            if (deleteBtn) deleteBtn.remove();\n            el.removeAttribute('draggable');\n            el.removeAttribute('data-component-type');\n        });\n\n        // Recopilar estilos\n        const styles = this.collectStyles();\n\n        // Recopilar scripts\n        const scripts = this.collectScripts();\n\n        return `<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Vista Previa en Vivo</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        body {\n            font-family: system-ui, -apple-system, sans-serif;\n        }\n        ${styles}\n    </style>\n</head>\n<body>\n    ${clone.innerHTML}\n    ${scripts}\n    <script>\n        // Auto-actualizaci√≥n cada 2 segundos\n        setInterval(() => {\n            if (window.opener && !window.opener.closed) {\n                // La ventana padre actualizar√° este contenido\n            } else {\n                document.body.innerHTML = '<div style=\"padding: 40px; text-align: center; color: #666;\"><h2>Vista previa desconectada</h2><p>La ventana del editor fue cerrada.</p></div>';\n            }\n        }, 2000);\n    </script>\n</body>\n</html>`;\n    }\n\n    /**\n     * Recopila estilos del documento\n     */\n    collectStyles() {\n        const styles = [];\n\n        // Estilos inline del head\n        document.querySelectorAll('style').forEach((styleEl, index) => {\n            if (styleEl.getAttribute('data-source') && \n                styleEl.getAttribute('data-source').startsWith('imported')) {\n                styles.push(styleEl.textContent);\n            }\n        });\n\n        // Estilos de componentes\n        styles.push(`\n            .component-card {\n                border: 1px solid #e2e8f0;\n                border-radius: 8px;\n                background: white;\n                box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n                max-width: 400px;\n            }\n            .component-card img {\n                width: 100%;\n                border-radius: 8px 8px 0 0;\n            }\n            .component-card-body {\n                padding: 20px;\n            }\n            .component-navbar {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 16px 32px;\n                background: #1e293b;\n                color: white;\n            }\n            .component-navbar-brand {\n                font-size: 1.5rem;\n                font-weight: bold;\n            }\n            .component-navbar-nav {\n                display: flex;\n                gap: 20px;\n                list-style: none;\n            }\n            .component-navbar-nav a {\n                color: white;\n                text-decoration: none;\n            }\n            .component-hero {\n                min-height: 400px;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                text-align: center;\n                padding: 60px 20px;\n            }\n            .component-footer {\n                background: #1e293b;\n                color: white;\n                padding: 40px 20px;\n                text-align: center;\n            }\n        `);\n\n        return styles.join('\\n\\n');\n    }\n\n    /**\n     * Recopila scripts del documento\n     */\n    collectScripts() {\n        const scripts = [];\n\n        document.querySelectorAll('script').forEach((scriptEl) => {\n            if (scriptEl.getAttribute('data-source') && \n                scriptEl.getAttribute('data-source').startsWith('imported')) {\n                if (scriptEl.src) {\n                    scripts.push(`<script src=\"${scriptEl.src}\"><\\/script>`);\n                } else {\n                    scripts.push(`<script>${scriptEl.textContent}<\\/script>`);\n                }\n            }\n        });\n\n        return scripts.join('\\n');\n    }\n\n    /**\n     * Inicia actualizaciones autom√°ticas\n     */\n    startUpdates() {\n        this.stopUpdates();\n\n        // Actualizar inmediatamente\n        this.updatePreview();\n\n        // Actualizar peri√≥dicamente\n        this.updateInterval = setInterval(() => {\n            this.updatePreview();\n        }, this.updateDelay);\n\n        // Observar cambios en el canvas\n        const canvas = document.getElementById('canvas');\n        if (canvas) {\n            this.canvasObserver = new MutationObserver(() => {\n                clearTimeout(this.updateTimeout);\n                this.updateTimeout = setTimeout(() => {\n                    this.updatePreview();\n                }, 500);\n            });\n\n            this.canvasObserver.observe(canvas, {\n                childList: true,\n                subtree: true,\n                attributes: true,\n                characterData: true\n            });\n        }\n    }\n\n    /**\n     * Detiene actualizaciones\n     */\n    stopUpdates() {\n        if (this.updateInterval) {\n            clearInterval(this.updateInterval);\n            this.updateInterval = null;\n        }\n\n        if (this.updateTimeout) {\n            clearTimeout(this.updateTimeout);\n            this.updateTimeout = null;\n        }\n\n        if (this.canvasObserver) {\n            this.canvasObserver.disconnect();\n            this.canvasObserver = null;\n        }\n    }\n\n    /**\n     * Alterna vista previa\n     */\n    toggle() {\n        if (this.isLive) {\n            this.stop();\n        } else {\n            this.start();\n        }\n    }\n\n    /**\n     * Verifica si est√° activa\n     */\n    isActive() {\n        return this.isLive && this.previewWindow && !this.previewWindow.closed;\n    }\n}\n\n// Exportar\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = LivePreview;\n}\n\nwindow.LivePreview = LivePreview;\n","/**\n * ThemeManager - Gestiona tema oscuro/claro del editor\n * @module ThemeManager\n */\nclass ThemeManager {\n    constructor() {\n        this.currentTheme = 'light';\n        this.storageKey = 'dragndrop_theme';\n        this.init();\n    }\n\n    /**\n     * Inicializa el gestor de temas\n     */\n    init() {\n        this.loadTheme();\n        this.setupToggle();\n        this.setupKeyboardShortcut();\n        this.watchSystemPreference();\n    }\n\n    /**\n     * Carga tema guardado o detecta preferencia del sistema\n     */\n    loadTheme() {\n        const saved = localStorage.getItem(this.storageKey);\n        \n        if (saved) {\n            this.currentTheme = saved;\n        } else {\n            this.currentTheme = this.detectPreference();\n        }\n        \n        this.applyTheme(this.currentTheme);\n    }\n\n    /**\n     * Detecta preferencia de tema del sistema operativo\n     * @returns {string} 'dark' o 'light'\n     */\n    detectPreference() {\n        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n            return 'dark';\n        }\n        return 'light';\n    }\n\n    /**\n     * Observa cambios en preferencia del sistema\n     */\n    watchSystemPreference() {\n        if (window.matchMedia) {\n            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n            \n            mediaQuery.addEventListener('change', (e) => {\n                // Solo aplicar si el usuario no ha configurado manualmente\n                if (!localStorage.getItem(this.storageKey)) {\n                    this.currentTheme = e.matches ? 'dark' : 'light';\n                    this.applyTheme(this.currentTheme);\n                }\n            });\n        }\n    }\n\n    /**\n     * Alterna entre tema claro y oscuro\n     */\n    toggle() {\n        this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';\n        this.applyTheme(this.currentTheme);\n        this.saveTheme();\n        \n        if (window.showToast) {\n            window.showToast(`Tema ${this.currentTheme === 'dark' ? 'oscuro' : 'claro'} activado`);\n        }\n    }\n\n    /**\n     * Aplica el tema al documento\n     * @param {string} theme - 'light' o 'dark'\n     */\n    applyTheme(theme) {\n        document.documentElement.setAttribute('data-theme', theme);\n        this.updateUI(theme);\n    }\n\n    /**\n     * Guarda tema en localStorage\n     */\n    saveTheme() {\n        localStorage.setItem(this.storageKey, this.currentTheme);\n    }\n\n    /**\n     * Actualiza UI del bot√≥n de toggle\n     * @param {string} theme - Tema actual\n     */\n    updateUI(theme) {\n        const btn = document.getElementById('themeToggle');\n        if (btn) {\n            btn.textContent = theme === 'dark' ? '‚òÄÔ∏è Claro' : 'üåô Oscuro';\n            btn.setAttribute('aria-label', `Cambiar a modo ${theme === 'dark' ? 'claro' : 'oscuro'}`);\n            btn.classList.toggle('active', theme === 'dark');\n        }\n    }\n\n    /**\n     * Configura el bot√≥n de toggle\n     */\n    setupToggle() {\n        // Event listener ya est√° en HTML con onclick\n        // Este m√©todo puede usarse para setup adicional si necesario\n    }\n\n    /**\n     * Configura atajo de teclado Ctrl+Shift+D\n     */\n    setupKeyboardShortcut() {\n        document.addEventListener('keydown', (e) => {\n            // Ctrl+Shift+D o Cmd+Shift+D\n            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'D') {\n                e.preventDefault();\n                this.toggle();\n            }\n        });\n    }\n\n    /**\n     * Obtiene el tema actual\n     * @returns {string} Tema actual ('light' o 'dark')\n     */\n    getCurrentTheme() {\n        return this.currentTheme;\n    }\n\n    /**\n     * Establece tema espec√≠fico\n     * @param {string} theme - 'light' o 'dark'\n     */\n    setTheme(theme) {\n        if (theme === 'light' || theme === 'dark') {\n            this.currentTheme = theme;\n            this.applyTheme(theme);\n            this.saveTheme();\n        }\n    }\n}\n\n// Exportar para uso en otros m√≥dulos\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ThemeManager;\n}\n\n// Exportar globalmente\nwindow.ThemeManager = ThemeManager;\n","/**\n * AICodeGenerator - Traduce dise√±o visual a c√≥digo usando Blackbox AI\n * @module AICodeGenerator\n */\nclass AICodeGenerator {\n    constructor() {\n        this.apiKey = null;\n        this.endpoint = 'https://api.blackbox.ai/v1/chat/completions';\n        this.model = 'blackbox'; // o 'claude-3-sonnet' cuando est√© disponible\n        this.isConfigured = false;\n        this.maxTokens = 4000;\n        this.temperature = 0.7;\n        \n        this.init();\n    }\n\n    /**\n     * Inicializa el generador\n     */\n    init() {\n        this.loadApiKey();\n        this.setupUI();\n    }\n\n    /**\n     * Carga API key desde localStorage\n     */\n    loadApiKey() {\n        const stored = localStorage.getItem('dragndrop_blackbox_api_key');\n        if (stored) {\n            this.apiKey = stored;\n            this.isConfigured = true;\n        }\n    }\n\n    /**\n     * Guarda API key\n     * @param {string} apiKey - API key de Blackbox\n     */\n    saveApiKey(apiKey) {\n        this.apiKey = apiKey;\n        localStorage.setItem('dragndrop_blackbox_api_key', apiKey);\n        this.isConfigured = true;\n        \n        if (window.showToast) {\n            window.showToast('API Key guardada correctamente');\n        }\n    }\n\n    /**\n     * Configura UI para AI features\n     */\n    setupUI() {\n        // UI se agregar√° en index.html\n    }\n\n    /**\n     * Genera c√≥digo HTML desde descripci√≥n en lenguaje natural\n     * @param {string} description - Descripci√≥n del componente/p√°gina\n     * @param {Object} options - Opciones adicionales\n     * @returns {Promise<Object>} C√≥digo generado\n     */\n    async generateFromDescription(description, options = {}) {\n        if (!this.isConfigured) {\n            throw new Error('API Key no configurada. Configure primero en Settings.');\n        }\n\n        const prompt = this.buildPrompt(description, options);\n        \n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error generando c√≥digo:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Genera c√≥digo desde screenshot/imagen del canvas\n     * @param {string} imageData - Base64 image data\n     * @param {Object} options - Opciones\n     * @returns {Promise<Object>} C√≥digo generado\n     */\n    async generateFromImage(imageData, options = {}) {\n        if (!this.isConfigured) {\n            throw new Error('API Key no configurada');\n        }\n\n        const prompt = this.buildImagePrompt(imageData, options);\n        \n        try {\n            const response = await this.callBlackboxAPI(prompt, { includeImage: true, imageData });\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error generando desde imagen:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Mejora c√≥digo existente\n     * @param {string} code - C√≥digo HTML actual\n     * @param {string} instruction - Qu√© mejorar\n     * @returns {Promise<Object>} C√≥digo mejorado\n     */\n    async improveCode(code, instruction) {\n        if (!this.isConfigured) {\n            throw new Error('API Key no configurada');\n        }\n\n        const prompt = `Mejora este c√≥digo HTML/CSS siguiendo esta instrucci√≥n: \"${instruction}\"\n\nC√≥digo actual:\n\\`\\`\\`html\n${code}\n\\`\\`\\`\n\nRetorna el c√≥digo mejorado manteniendo la estructura general pero aplicando la mejora solicitada.\nSolo retorna el c√≥digo, sin explicaciones.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error mejorando c√≥digo:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Genera componente desde descripci√≥n\n     * @param {string} description - Descripci√≥n del componente\n     * @param {string} type - Tipo de componente (navbar, hero, card, etc)\n     * @returns {Promise<Object>} Componente generado\n     */\n    async generateComponent(description, type = 'custom') {\n        const prompt = `Genera un componente ${type} en HTML/CSS vanilla basado en esta descripci√≥n:\n\n\"${description}\"\n\nRequisitos:\n- HTML sem√°ntico y limpio\n- CSS inline (styles en atributos style)\n- Responsive (usar flexbox/grid)\n- Accesible (ARIA labels apropiados)\n- Sin frameworks (vanilla JavaScript si necesario)\n- Colores modernos y profesionales\n- No usar clases externas (todo inline)\n\nRetorna solo el c√≥digo HTML del componente, listo para insertar en el editor.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            const parsed = this.parseResponse(response);\n            \n            return {\n                type: type,\n                html: parsed.code,\n                description: description,\n                generated: new Date().toISOString()\n            };\n        } catch (error) {\n            console.error('Error generando componente:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Construye prompt optimizado para Blackbox\n     * @param {string} description - Descripci√≥n del usuario\n     * @param {Object} options - Opciones\n     * @returns {string} Prompt construido\n     */\n    buildPrompt(description, options = {}) {\n        const {\n            framework = 'vanilla',\n            responsive = true,\n            accessibility = true,\n            includeJS = false,\n            style = 'modern'\n        } = options;\n\n        return `Genera c√≥digo HTML/CSS profesional para:\n\n\"${description}\"\n\nEspecificaciones:\n- Framework: ${framework} (no usar librer√≠as externas)\n- Responsive: ${responsive ? 'S√≠ - usar flexbox/grid' : 'No requerido'}\n- Accesibilidad: ${accessibility ? 'WCAG 2.1 AA compliant' : 'B√°sica'}\n- JavaScript: ${includeJS ? 'Incluir si es necesario' : 'Solo HTML/CSS'}\n- Estilo: ${style} (clean, profesional)\n\nFormato de respuesta:\n\\`\\`\\`html\n[Tu c√≥digo aqu√≠]\n\\`\\`\\`\n\n\\`\\`\\`css\n[CSS separado si aplica]\n\\`\\`\\`\n\n\\`\\`\\`javascript\n[JavaScript si aplica]\n\\`\\`\\`\n\nGenera c√≥digo production-ready, limpio y bien estructurado.`;\n    }\n\n    /**\n     * Construye prompt para an√°lisis de imagen\n     * @param {string} imageData - Base64 image\n     * @param {Object} options - Opciones\n     * @returns {string} Prompt\n     */\n    buildImagePrompt(imageData, options = {}) {\n        return `Analiza esta imagen de dise√±o web y genera el c√≥digo HTML/CSS exacto para replicarla.\n\nImagen adjunta: [imagen en base64]\n\nInstrucciones:\n- Replica la estructura visual exactamente\n- Usa colores similares (extr√°elos de la imagen)\n- Mant√©n proporciones y espaciado\n- HTML sem√°ntico\n- CSS inline o en <style>\n- Responsive\n- Sin frameworks\n\nRetorna el c√≥digo completo listo para usar.`;\n    }\n\n    /**\n     * Llama a Blackbox AI API\n     * @param {string} prompt - Prompt a enviar\n     * @param {Object} options - Opciones adicionales\n     * @returns {Promise<Object>} Respuesta de la API\n     */\n    async callBlackboxAPI(prompt, options = {}) {\n        const requestBody = {\n            model: this.model,\n            messages: [\n                {\n                    role: 'system',\n                    content: 'Eres un experto en desarrollo web. Generas c√≥digo HTML, CSS y JavaScript limpio, sem√°ntico y production-ready. Siempre sigues best practices y est√°ndares web modernos.'\n                },\n                {\n                    role: 'user',\n                    content: prompt\n                }\n            ],\n            max_tokens: this.maxTokens,\n            temperature: this.temperature,\n            stream: false\n        };\n\n        // Si incluye imagen, agregar al mensaje\n        if (options.includeImage && options.imageData) {\n            requestBody.messages[1].content = [\n                {\n                    type: 'text',\n                    text: prompt\n                },\n                {\n                    type: 'image_url',\n                    image_url: {\n                        url: options.imageData\n                    }\n                }\n            ];\n        }\n\n        const response = await fetch(this.endpoint, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${this.apiKey}`\n            },\n            body: JSON.stringify(requestBody)\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json().catch(() => ({}));\n            throw new Error(`Blackbox API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);\n        }\n\n        return await response.json();\n    }\n\n    /**\n     * Parsea respuesta de Blackbox API\n     * @param {Object} response - Respuesta de API\n     * @returns {Object} C√≥digo parseado\n     */\n    parseResponse(response) {\n        const content = response.choices?.[0]?.message?.content || '';\n        \n        // Extraer bloques de c√≥digo\n        const htmlMatch = content.match(/```html\\n([\\s\\S]*?)```/);\n        const cssMatch = content.match(/```css\\n([\\s\\S]*?)```/);\n        const jsMatch = content.match(/```javascript\\n([\\s\\S]*?)```/);\n\n        return {\n            html: htmlMatch ? htmlMatch[1].trim() : content.trim(),\n            css: cssMatch ? cssMatch[1].trim() : null,\n            js: jsMatch ? jsMatch[1].trim() : null,\n            raw: content\n        };\n    }\n\n    /**\n     * Genera c√≥digo desde elemento seleccionado en canvas\n     * @param {HTMLElement} element - Elemento del canvas\n     * @param {string} instruction - Qu√© hacer con el elemento\n     * @returns {Promise<Object>} C√≥digo generado\n     */\n    async modifyElement(element, instruction) {\n        const currentHTML = element.outerHTML;\n        \n        const prompt = `Modifica este elemento HTML seg√∫n la instrucci√≥n:\n\nInstrucci√≥n: \"${instruction}\"\n\nHTML actual:\n\\`\\`\\`html\n${currentHTML}\n\\`\\`\\`\n\nRetorna el HTML modificado manteniendo la estructura general.\nSolo el c√≥digo, sin explicaciones.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error modificando elemento:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Genera p√°gina completa desde descripci√≥n\n     * @param {string} description - Descripci√≥n de la p√°gina\n     * @param {string} pageType - Tipo de p√°gina (landing, blog, portfolio, etc)\n     * @returns {Promise<Object>} P√°gina generada\n     */\n    async generateFullPage(description, pageType = 'landing') {\n        const prompt = `Genera una p√°gina web completa tipo \"${pageType}\" basada en:\n\n\"${description}\"\n\nRequisitos:\n- HTML5 sem√°ntico completo\n- CSS moderno (Flexbox/Grid)\n- Responsive (mobile-first)\n- Secciones t√≠picas de ${pageType}:\n  ${this.getTypicalSections(pageType)}\n- Colores profesionales y modernos\n- Tipograf√≠a clara y legible\n- CTAs claros\n- Optimizado para SEO\n- Accesible (WCAG 2.1 AA)\n\nFormato de respuesta:\n\\`\\`\\`html\n<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>[T√≠tulo apropiado]</title>\n    <style>\n        [CSS aqu√≠]\n    </style>\n</head>\n<body>\n    [Contenido aqu√≠]\n</body>\n</html>\n\\`\\`\\`\n\nGenera c√≥digo production-ready.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error generando p√°gina:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Obtiene secciones t√≠picas por tipo de p√°gina\n     * @param {string} pageType - Tipo de p√°gina\n     * @returns {string} Descripci√≥n de secciones\n     */\n    getTypicalSections(pageType) {\n        const sections = {\n            'landing': '- Hero con CTA\\n  - Features (3-6 items)\\n  - Social proof\\n  - CTA final\\n  - Footer',\n            'blog': '- Header con navegaci√≥n\\n  - Hero article\\n  - Art√≠culos recientes\\n  - Sidebar\\n  - Footer',\n            'portfolio': '- Hero personal\\n  - Proyectos destacados\\n  - Skills\\n  - Contacto\\n  - Footer',\n            'ecommerce': '- Header con carrito\\n  - Hero/Banner\\n  - Productos destacados\\n  - Categor√≠as\\n  - Footer',\n            'saas': '- Navbar\\n  - Hero con demo\\n  - Features\\n  - Pricing\\n  - Testimonials\\n  - CTA\\n  - Footer'\n        };\n\n        return sections[pageType] || sections['landing'];\n    }\n\n    /**\n     * Optimiza c√≥digo generado\n     * @param {Object} code - C√≥digo generado {html, css, js}\n     * @returns {Promise<Object>} C√≥digo optimizado\n     */\n    async optimizeCode(code) {\n        const prompt = `Optimiza este c√≥digo para performance y best practices:\n\nHTML:\n\\`\\`\\`html\n${code.html}\n\\`\\`\\`\n\n${code.css ? `CSS:\\n\\`\\`\\`css\\n${code.css}\\n\\`\\`\\`` : ''}\n\n${code.js ? `JavaScript:\\n\\`\\`\\`javascript\\n${code.js}\\n\\`\\`\\`` : ''}\n\nOptimizaciones a aplicar:\n- Minificar espacios innecesarios\n- Mejorar sem√°ntica HTML\n- Optimizar selectores CSS\n- Reducir redundancia\n- Mejorar accesibilidad\n- SEO optimization\n\nRetorna el c√≥digo optimizado en el mismo formato.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error optimizando c√≥digo:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Convierte dise√±o del canvas actual a c√≥digo limpio\n     * @returns {Promise<Object>} C√≥digo del canvas\n     */\n    async canvasToCode() {\n        const canvas = document.getElementById('canvas');\n        if (!canvas) {\n            throw new Error('Canvas no encontrado');\n        }\n\n        // Capturar HTML actual del canvas\n        const currentHTML = canvas.innerHTML;\n        \n        // Crear screenshot del canvas para contexto visual\n        const screenshot = await this.captureCanvasScreenshot();\n\n        const prompt = `Analiza este HTML generado por un editor visual y convi√©rtelo a c√≥digo production-ready limpio:\n\nHTML actual (generado por editor):\n\\`\\`\\`html\n${currentHTML}\n\\`\\`\\`\n\nInstrucciones:\n1. Remover clases del editor (canvas-element, selected, etc)\n2. Remover atributos del editor (draggable, data-component-type)\n3. Remover botones de delete\n4. Limpiar IDs autogenerados (element-XXX) por IDs sem√°nticos\n5. Organizar c√≥digo con indentaci√≥n correcta\n6. Extraer CSS inline a <style> cuando sea apropiado\n7. Agregar comentarios para secciones principales\n8. Optimizar para SEO (meta tags apropiados)\n9. Hacer responsive si no lo es\n\nRetorna HTML completo production-ready.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            const parsed = this.parseResponse(response);\n            \n            return {\n                ...parsed,\n                screenshot: screenshot,\n                original: currentHTML\n            };\n        } catch (error) {\n            console.error('Error convirtiendo canvas:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Captura screenshot del canvas\n     * @returns {Promise<string>} Base64 image data\n     */\n    async captureCanvasScreenshot() {\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return null;\n\n        // Si html2canvas est√° disponible\n        if (typeof html2canvas !== 'undefined') {\n            try {\n                const canvasElement = await html2canvas(canvas);\n                return canvasElement.toDataURL('image/png');\n            } catch (error) {\n                console.error('Error capturando screenshot:', error);\n                return null;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Genera variaciones de un componente\n     * @param {HTMLElement} element - Elemento base\n     * @param {number} count - N√∫mero de variaciones\n     * @returns {Promise<Array>} Array de variaciones\n     */\n    async generateVariations(element, count = 3) {\n        const baseHTML = element.outerHTML;\n        \n        const prompt = `Genera ${count} variaciones de este componente HTML:\n\n\\`\\`\\`html\n${baseHTML}\n\\`\\`\\`\n\nCada variaci√≥n debe:\n- Mantener la estructura general\n- Cambiar colores/estilos\n- Tener personalidad diferente (elegante, moderno, minimalista, etc)\n- Ser igualmente funcional\n\nRetorna las ${count} variaciones separadas por \"---VARIATION---\".`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            const content = response.choices?.[0]?.message?.content || '';\n            \n            // Separar variaciones\n            const variations = content.split('---VARIATION---')\n                .map(v => v.trim())\n                .filter(v => v.length > 0)\n                .map((html, index) => ({\n                    id: `variation-${index}`,\n                    html: this.extractCodeBlock(html),\n                    index: index\n                }));\n\n            return variations;\n        } catch (error) {\n            console.error('Error generando variaciones:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Extrae bloque de c√≥digo de markdown\n     * @param {string} text - Texto con c√≥digo\n     * @returns {string} C√≥digo extra√≠do\n     */\n    extractCodeBlock(text) {\n        const match = text.match(/```(?:html)?\\n([\\s\\S]*?)```/);\n        return match ? match[1].trim() : text.trim();\n    }\n\n    /**\n     * Corrige errores de HTML\n     * @param {string} html - HTML con posibles errores\n     * @returns {Promise<Object>} HTML corregido\n     */\n    async fixHTMLErrors(html) {\n        const prompt = `Corrige errores de sintaxis y estructura en este HTML:\n\n\\`\\`\\`html\n${html}\n\\`\\`\\`\n\nCorrecciones a aplicar:\n- Cerrar tags abiertos\n- Corregir anidamiento\n- Validar atributos\n- Arreglar comillas\n- Hacer v√°lido HTML5\n\nRetorna HTML corregido.`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            return this.parseResponse(response);\n        } catch (error) {\n            console.error('Error corrigiendo HTML:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Genera sugerencias de mejora para c√≥digo\n     * @param {string} code - C√≥digo a analizar\n     * @returns {Promise<Array>} Array de sugerencias\n     */\n    async suggestImprovements(code) {\n        const prompt = `Analiza este c√≥digo HTML/CSS y sugiere mejoras:\n\n\\`\\`\\`html\n${code}\n\\`\\`\\`\n\nAnaliza:\n- Accesibilidad\n- Performance\n- SEO\n- Sem√°ntica\n- Best practices\n- Responsive design\n\nRetorna lista de sugerencias en formato:\n1. [Mejora] - [Raz√≥n] - [Prioridad: Alta/Media/Baja]`;\n\n        try {\n            const response = await this.callBlackboxAPI(prompt);\n            const content = response.choices?.[0]?.message?.content || '';\n            \n            // Parsear sugerencias\n            const suggestions = content.split('\\n')\n                .filter(line => /^\\d+\\./.test(line))\n                .map(line => {\n                    const parts = line.split(' - ');\n                    return {\n                        improvement: parts[0]?.replace(/^\\d+\\.\\s*/, ''),\n                        reason: parts[1] || '',\n                        priority: parts[2] || 'Media'\n                    };\n                });\n\n            return suggestions;\n        } catch (error) {\n            console.error('Error generando sugerencias:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Verifica si est√° configurado\n     * @returns {boolean} True si tiene API key\n     */\n    isReady() {\n        return this.isConfigured && this.apiKey !== null;\n    }\n\n    /**\n     * Muestra di√°logo de configuraci√≥n\n     */\n    showConfigDialog() {\n        const modal = document.createElement('div');\n        modal.className = 'modal';\n        modal.innerHTML = `\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h3>‚öôÔ∏è Configurar AI Code Generator</h3>\n                    <button class=\"modal-close\" onclick=\"this.closest('.modal').remove()\">&times;</button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label>Blackbox API Key:</label>\n                        <input type=\"password\" id=\"blackboxApiKey\" placeholder=\"sk-...\" value=\"${this.apiKey || ''}\">\n                        <small style=\"color: var(--text-secondary); display: block; margin-top: 4px;\">\n                            Obt√©n tu API key en: <a href=\"https://www.blackbox.ai/api\" target=\"_blank\">blackbox.ai/api</a>\n                        </small>\n                    </div>\n                    <div class=\"form-group\">\n                        <label>Modelo:</label>\n                        <select id=\"aiModel\">\n                            <option value=\"blackbox\" ${this.model === 'blackbox' ? 'selected' : ''}>Blackbox (R√°pido)</option>\n                            <option value=\"claude-3-sonnet\" ${this.model === 'claude-3-sonnet' ? 'selected' : ''}>Claude 3 Sonnet (Preciso)</option>\n                            <option value=\"gpt-4\" ${this.model === 'gpt-4' ? 'selected' : ''}>GPT-4 (Potente)</option>\n                        </select>\n                    </div>\n                    <div class=\"modal-actions\">\n                        <button class=\"btn primary\" onclick=\"window.aiCodeGenerator.saveConfig()\">Guardar</button>\n                        <button class=\"btn\" onclick=\"this.closest('.modal').remove()\">Cancelar</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(modal);\n    }\n\n    /**\n     * Guarda configuraci√≥n desde di√°logo\n     */\n    saveConfig() {\n        const apiKey = document.getElementById('blackboxApiKey')?.value;\n        const model = document.getElementById('aiModel')?.value;\n\n        if (apiKey && apiKey.trim()) {\n            this.saveApiKey(apiKey.trim());\n            this.model = model || 'blackbox';\n            \n            // Cerrar modal\n            const modal = document.querySelector('.modal');\n            if (modal) modal.remove();\n            \n            if (window.showToast) {\n                window.showToast('Configuraci√≥n guardada. AI Code Generator listo!');\n            }\n        } else {\n            alert('Por favor ingresa una API key v√°lida');\n        }\n    }\n\n    /**\n     * Muestra di√°logo de generaci√≥n de componente\n     */\n    showGenerateDialog() {\n        if (!this.isReady()) {\n            this.showConfigDialog();\n            return;\n        }\n\n        const modal = document.createElement('div');\n        modal.className = 'modal ai-generate-modal';\n        modal.innerHTML = `\n            <div class=\"modal-content\" style=\"max-width: 700px;\">\n                <div class=\"modal-header\">\n                    <h3>ü§ñ Generar con AI</h3>\n                    <button class=\"modal-close\" onclick=\"this.closest('.modal').remove()\">&times;</button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label>Describe lo que quieres crear:</label>\n                        <textarea id=\"aiPrompt\" rows=\"4\" style=\"width: 100%; padding: 10px; border: 1px solid var(--border-primary); border-radius: 6px; font-family: inherit; resize: vertical;\" placeholder=\"Ej: Un hero section moderno con gradiente azul, t√≠tulo grande, subt√≠tulo y dos botones (primario y secundario)\"></textarea>\n                    </div>\n                    <div class=\"form-group\">\n                        <label>Tipo de componente:</label>\n                        <select id=\"aiComponentType\" style=\"width: 100%; padding: 10px; border: 1px solid var(--border-primary); border-radius: 6px;\">\n                            <option value=\"custom\">Personalizado</option>\n                            <option value=\"navbar\">Navbar</option>\n                            <option value=\"hero\">Hero Section</option>\n                            <option value=\"card\">Card</option>\n                            <option value=\"footer\">Footer</option>\n                            <option value=\"form\">Formulario</option>\n                            <option value=\"gallery\">Galer√≠a</option>\n                            <option value=\"pricing\">Pricing Table</option>\n                        </select>\n                    </div>\n                    <div class=\"modal-actions\">\n                        <button class=\"btn primary\" onclick=\"window.aiCodeGenerator.executeGeneration()\" id=\"generateBtn\">\n                            ‚ú® Generar\n                        </button>\n                        <button class=\"btn\" onclick=\"this.closest('.modal').remove()\">Cancelar</button>\n                    </div>\n                    <div id=\"aiGenerationResult\" style=\"margin-top: 20px; display: none;\">\n                        <h4>C√≥digo Generado:</h4>\n                        <pre style=\"background: var(--bg-secondary); padding: 15px; border-radius: 6px; overflow-x: auto; max-height: 300px;\"><code id=\"generatedCode\"></code></pre>\n                        <div style=\"margin-top: 10px;\">\n                            <button class=\"btn primary\" onclick=\"window.aiCodeGenerator.insertGeneratedCode()\">Insertar en Canvas</button>\n                            <button class=\"btn\" onclick=\"navigator.clipboard.writeText(document.getElementById('generatedCode').textContent)\">Copiar C√≥digo</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(modal);\n    }\n\n    /**\n     * Ejecuta generaci√≥n desde di√°logo\n     */\n    async executeGeneration() {\n        const prompt = document.getElementById('aiPrompt')?.value;\n        const type = document.getElementById('aiComponentType')?.value;\n        const btn = document.getElementById('generateBtn');\n\n        if (!prompt || !prompt.trim()) {\n            alert('Por favor describe lo que quieres crear');\n            return;\n        }\n\n        if (btn) {\n            btn.disabled = true;\n            btn.textContent = '‚è≥ Generando...';\n        }\n\n        try {\n            const result = await this.generateComponent(prompt.trim(), type);\n            \n            // Mostrar resultado\n            const resultDiv = document.getElementById('aiGenerationResult');\n            const codeEl = document.getElementById('generatedCode');\n            \n            if (resultDiv && codeEl) {\n                codeEl.textContent = result.html;\n                resultDiv.style.display = 'block';\n                this.lastGenerated = result.html;\n            }\n\n            if (window.showToast) {\n                window.showToast('C√≥digo generado con AI');\n            }\n        } catch (error) {\n            alert(`Error generando c√≥digo: ${error.message}`);\n            console.error(error);\n        } finally {\n            if (btn) {\n                btn.disabled = false;\n                btn.textContent = '‚ú® Generar';\n            }\n        }\n    }\n\n    /**\n     * Inserta c√≥digo generado en canvas\n     */\n    insertGeneratedCode() {\n        if (!this.lastGenerated) return;\n\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return;\n\n        // Crear elemento temporal\n        const temp = document.createElement('div');\n        temp.innerHTML = this.lastGenerated;\n        const element = temp.firstElementChild;\n\n        if (element) {\n            // Agregar ID y clases del editor\n            element.id = 'element-' + (window.elementIdCounter++);\n            element.classList.add('canvas-element');\n\n            // Agregar funcionalidad del editor\n            const deleteBtn = document.createElement('div');\n            deleteBtn.className = 'delete-btn';\n            deleteBtn.textContent = '√ó';\n            deleteBtn.onclick = (e) => {\n                e.stopPropagation();\n                if (window.deleteElement) {\n                    window.deleteElement(element);\n                }\n            };\n            element.appendChild(deleteBtn);\n\n            // Eventos\n            element.addEventListener('click', (e) => {\n                e.stopPropagation();\n                if (window.selectElement) {\n                    window.selectElement(element);\n                }\n            });\n\n            element.addEventListener('dblclick', (e) => {\n                e.stopPropagation();\n                if (window.makeElementEditable) {\n                    window.makeElementEditable(element);\n                }\n            });\n\n            // Agregar al canvas\n            canvas.appendChild(element);\n\n            // Cerrar modal\n            const modal = document.querySelector('.ai-generate-modal');\n            if (modal) modal.remove();\n\n            if (window.showToast) {\n                window.showToast('Componente AI insertado en canvas');\n            }\n        }\n    }\n\n    /**\n     * Muestra estado de configuraci√≥n\n     * @returns {Object} Estado\n     */\n    getStatus() {\n        return {\n            configured: this.isConfigured,\n            model: this.model,\n            endpoint: this.endpoint,\n            hasApiKey: this.apiKey !== null\n        };\n    }\n}\n\n// Exportar\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = AICodeGenerator;\n}\n\nwindow.AICodeGenerator = AICodeGenerator;\n","/**\n * Gemini Syntax Validator - v1.0\n * \n * Valida sintaxis de elementos HTML/CSS en tiempo real usando Gemini API.\n * Optimizado para economizar tokens usando gemini-2.0-flash-lite.\n */\n\nclass GeminiSyntaxValidator {\n    constructor() {\n        this.apiKey = null;\n        this.apiEndpoint = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent';\n        this.validationQueue = new Map();\n        this.debounceTimeout = null;\n        this.debounceDelay = 1500; // 1.5s para evitar llamadas excesivas\n        this.maxRetries = 2;\n        this.enabled = false;\n        \n        this.loadApiKey();\n    }\n\n    /**\n     * Carga la API key desde localStorage\n     */\n    loadApiKey() {\n        this.apiKey = localStorage.getItem('gemini_api_key');\n        this.enabled = !!this.apiKey;\n    }\n\n    /**\n     * Configura la API key\n     */\n    setApiKey(key) {\n        if (!key || key.trim() === '') {\n            throw new Error('API key inv√°lida');\n        }\n        \n        this.apiKey = key.trim();\n        localStorage.setItem('gemini_api_key', this.apiKey);\n        this.enabled = true;\n        \n        console.log('‚úÖ Gemini API key configurada');\n    }\n\n    /**\n     * Elimina la API key\n     */\n    removeApiKey() {\n        this.apiKey = null;\n        this.enabled = false;\n        localStorage.removeItem('gemini_api_key');\n        console.log('üóëÔ∏è Gemini API key eliminada');\n    }\n\n    /**\n     * Valida si el servicio est√° habilitado\n     */\n    isEnabled() {\n        return this.enabled && this.apiKey !== null;\n    }\n\n    /**\n     * Construye el prompt optimizado para correcci√≥n sint√°ctica\n     */\n    buildPrompt(element, context) {\n        const tagName = element.tagName.toLowerCase();\n        const elementHTML = element.outerHTML;\n        const styles = element.style.cssText;\n        \n        // Prompt ultra-conciso para economizar tokens\n        return `Fix HTML/CSS syntax only. Return valid code.\n\nElement: <${tagName}>\nHTML: ${elementHTML.substring(0, 500)}\nStyles: ${styles}\nParent: ${context.parent || 'body'}\n\nRules:\n- Fix syntax errors only\n- Keep semantic structure\n- Validate CSS properties\n- No explanations\n- Return only corrected HTML+inline CSS`;\n    }\n\n    /**\n     * Valida elemento con debounce\n     */\n    async validateElement(element, context = {}) {\n        if (!this.isEnabled()) {\n            console.warn('‚ö†Ô∏è Gemini validator no est√° habilitado');\n            return null;\n        }\n\n        const elementId = element.id || `temp-${Date.now()}`;\n        \n        // Limpiar timeout anterior\n        if (this.debounceTimeout) {\n            clearTimeout(this.debounceTimeout);\n        }\n\n        // Agregar a la cola\n        this.validationQueue.set(elementId, { element, context });\n\n        // Esperar debounce\n        return new Promise((resolve) => {\n            this.debounceTimeout = setTimeout(async () => {\n                const results = await this.processBatch();\n                resolve(results.get(elementId));\n            }, this.debounceDelay);\n        });\n    }\n\n    /**\n     * Procesa batch de validaciones\n     */\n    async processBatch() {\n        if (this.validationQueue.size === 0) {\n            return new Map();\n        }\n\n        const results = new Map();\n        const entries = Array.from(this.validationQueue.entries());\n        \n        // Procesar de a uno para mantener contexto preciso\n        for (const [id, { element, context }] of entries) {\n            try {\n                const result = await this.callGeminiAPI(element, context);\n                results.set(id, result);\n            } catch (error) {\n                console.error(`Error validando elemento ${id}:`, error);\n                results.set(id, { success: false, error: error.message });\n            }\n        }\n\n        this.validationQueue.clear();\n        return results;\n    }\n\n    /**\n     * Llama a la API de Gemini\n     */\n    async callGeminiAPI(element, context, retryCount = 0) {\n        const prompt = this.buildPrompt(element, context);\n        \n        const requestBody = {\n            contents: [{\n                parts: [{\n                    text: prompt\n                }]\n            }],\n            generationConfig: {\n                temperature: 0.1, // Muy bajo para respuestas deterministas\n                topK: 1,\n                topP: 0.8,\n                maxOutputTokens: 512, // L√≠mite bajo para economizar\n                stopSequences: []\n            },\n            safetySettings: [\n                {\n                    category: \"HARM_CATEGORY_HARASSMENT\",\n                    threshold: \"BLOCK_NONE\"\n                },\n                {\n                    category: \"HARM_CATEGORY_HATE_SPEECH\",\n                    threshold: \"BLOCK_NONE\"\n                },\n                {\n                    category: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n                    threshold: \"BLOCK_NONE\"\n                },\n                {\n                    category: \"HARM_CATEGORY_DANGEROUS_CONTENT\",\n                    threshold: \"BLOCK_NONE\"\n                }\n            ]\n        };\n\n        try {\n            const response = await fetch(`${this.apiEndpoint}?key=${this.apiKey}`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(requestBody)\n            });\n\n            if (!response.ok) {\n                const errorData = await response.json();\n                throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);\n            }\n\n            const data = await response.json();\n            \n            // Extraer respuesta\n            const correctedCode = this.extractCorrectedCode(data);\n            \n            return {\n                success: true,\n                original: element.outerHTML,\n                corrected: correctedCode,\n                hasChanges: element.outerHTML.trim() !== correctedCode.trim(),\n                timestamp: Date.now()\n            };\n\n        } catch (error) {\n            // Retry logic\n            if (retryCount < this.maxRetries && error.message.includes('429')) {\n                console.log(`‚è≥ Rate limit alcanzado, reintentando... (${retryCount + 1}/${this.maxRetries})`);\n                await this.sleep(2000 * (retryCount + 1)); // Backoff exponencial\n                return this.callGeminiAPI(element, context, retryCount + 1);\n            }\n            \n            throw error;\n        }\n    }\n\n    /**\n     * Extrae c√≥digo corregido de la respuesta de Gemini\n     */\n    extractCorrectedCode(apiResponse) {\n        try {\n            const candidates = apiResponse.candidates;\n            if (!candidates || candidates.length === 0) {\n                throw new Error('No candidates in response');\n            }\n\n            const content = candidates[0].content;\n            if (!content || !content.parts || content.parts.length === 0) {\n                throw new Error('No content in response');\n            }\n\n            let text = content.parts[0].text.trim();\n            \n            // Limpiar markdown code blocks si existen\n            text = text.replace(/```html\\n?/g, '').replace(/```\\n?/g, '');\n            \n            return text;\n        } catch (error) {\n            console.error('Error extrayendo c√≥digo corregido:', error);\n            throw new Error('No se pudo extraer el c√≥digo corregido de la respuesta');\n        }\n    }\n\n    /**\n     * Aplica correcci√≥n sugerida a un elemento\n     */\n    applyCorrection(element, correctionResult) {\n        if (!correctionResult.success || !correctionResult.hasChanges) {\n            return false;\n        }\n\n        try {\n            const tempDiv = document.createElement('div');\n            tempDiv.innerHTML = correctionResult.corrected;\n            \n            const correctedElement = tempDiv.firstElementChild;\n            if (!correctedElement) {\n                throw new Error('No se pudo parsear el elemento corregido');\n            }\n\n            // Preservar ID y clases del editor\n            correctedElement.id = element.id;\n            correctedElement.classList.add('canvas-element');\n            if (element.classList.contains('selected')) {\n                correctedElement.classList.add('selected');\n            }\n\n            // Reemplazar elemento\n            element.parentNode.replaceChild(correctedElement, element);\n            \n            console.log('‚úÖ Correcci√≥n aplicada:', correctedElement.outerHTML.substring(0, 100));\n            return true;\n\n        } catch (error) {\n            console.error('Error aplicando correcci√≥n:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Muestra sugerencias de correcci√≥n en UI\n     */\n    showCorrectionSuggestion(element, correctionResult) {\n        if (!correctionResult.success || !correctionResult.hasChanges) {\n            return;\n        }\n\n        // Crear badge de sugerencia\n        const existingBadge = element.querySelector('.syntax-suggestion-badge');\n        if (existingBadge) {\n            existingBadge.remove();\n        }\n\n        const badge = document.createElement('div');\n        badge.className = 'syntax-suggestion-badge';\n        badge.innerHTML = `\n            <span class=\"badge-icon\">üí°</span>\n            <span class=\"badge-text\">Mejora disponible</span>\n            <button class=\"badge-apply-btn\" data-action=\"apply\">Aplicar</button>\n            <button class=\"badge-dismiss-btn\" data-action=\"dismiss\">√ó</button>\n        `;\n\n        // Eventos\n        badge.querySelector('[data-action=\"apply\"]').addEventListener('click', (e) => {\n            e.stopPropagation();\n            this.applyCorrection(element, correctionResult);\n            badge.remove();\n            if (window.showToast) {\n                window.showToast('‚úÖ Correcci√≥n aplicada');\n            }\n        });\n\n        badge.querySelector('[data-action=\"dismiss\"]').addEventListener('click', (e) => {\n            e.stopPropagation();\n            badge.remove();\n        });\n\n        element.appendChild(badge);\n    }\n\n    /**\n     * Muestra modal de configuraci√≥n\n     */\n    showConfigModal() {\n        const modal = document.createElement('div');\n        modal.className = 'gemini-config-modal';\n        modal.innerHTML = `\n            <div class=\"modal-overlay\"></div>\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h3>‚öôÔ∏è Configuraci√≥n Gemini API</h3>\n                    <button class=\"modal-close-btn\">√ó</button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"config-info\">\n                        <p>Para habilitar la validaci√≥n sint√°ctica autom√°tica, necesitas una API key de Google Gemini.</p>\n                        <p><strong>Modelo usado:</strong> gemini-2.0-flash-lite (optimizado para bajo costo)</p>\n                        <a href=\"https://makersuite.google.com/app/apikey\" target=\"_blank\" rel=\"noopener\">\n                            üîó Obtener API Key gratuita\n                        </a>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"gemini-api-key-input\">API Key</label>\n                        <input \n                            type=\"password\" \n                            id=\"gemini-api-key-input\" \n                            placeholder=\"AIza...\" \n                            value=\"${this.apiKey || ''}\"\n                        >\n                    </div>\n                    \n                    <div class=\"config-status\">\n                        ${this.isEnabled() \n                            ? '<span class=\"status-enabled\">‚úÖ Habilitado</span>'\n                            : '<span class=\"status-disabled\">‚ö†Ô∏è Deshabilitado</span>'\n                        }\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-secondary\" data-action=\"cancel\">Cancelar</button>\n                    ${this.isEnabled() \n                        ? '<button class=\"btn btn-danger\" data-action=\"remove\">Eliminar Key</button>'\n                        : ''\n                    }\n                    <button class=\"btn btn-primary\" data-action=\"save\">Guardar</button>\n                </div>\n            </div>\n        `;\n\n        // Eventos\n        const closeModal = () => modal.remove();\n        \n        modal.querySelector('.modal-close-btn').addEventListener('click', closeModal);\n        modal.querySelector('.modal-overlay').addEventListener('click', closeModal);\n        modal.querySelector('[data-action=\"cancel\"]').addEventListener('click', closeModal);\n        \n        modal.querySelector('[data-action=\"save\"]').addEventListener('click', () => {\n            const input = modal.querySelector('#gemini-api-key-input');\n            const key = input.value.trim();\n            \n            if (key) {\n                try {\n                    this.setApiKey(key);\n                    if (window.showToast) {\n                        window.showToast('‚úÖ API Key guardada correctamente');\n                    }\n                    closeModal();\n                } catch (error) {\n                    alert(error.message);\n                }\n            } else {\n                alert('Por favor ingresa una API key v√°lida');\n            }\n        });\n\n        const removeBtn = modal.querySelector('[data-action=\"remove\"]');\n        if (removeBtn) {\n            removeBtn.addEventListener('click', () => {\n                if (confirm('¬øSeguro que deseas eliminar la API key?')) {\n                    this.removeApiKey();\n                    if (window.showToast) {\n                        window.showToast('üóëÔ∏è API Key eliminada');\n                    }\n                    closeModal();\n                }\n            });\n        }\n\n        document.body.appendChild(modal);\n    }\n\n    /**\n     * Utilidad para esperar\n     */\n    sleep(ms) {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n}\n\n// Estilos para el validador\nconst validatorStyles = document.createElement('style');\nvalidatorStyles.textContent = `\n    /* Badge de sugerencia */\n    .syntax-suggestion-badge {\n        position: absolute;\n        top: -35px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n        padding: 8px 12px;\n        border-radius: 8px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n        z-index: 1000;\n        animation: suggestBounce 0.5s ease;\n        white-space: nowrap;\n    }\n\n    @keyframes suggestBounce {\n        0%, 100% { transform: translateX(-50%) translateY(0); }\n        50% { transform: translateX(-50%) translateY(-5px); }\n    }\n\n    .syntax-suggestion-badge .badge-icon {\n        font-size: 14px;\n    }\n\n    .syntax-suggestion-badge .badge-text {\n        font-weight: 500;\n    }\n\n    .syntax-suggestion-badge button {\n        padding: 4px 10px;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 11px;\n        font-weight: 600;\n        transition: all 0.2s;\n    }\n\n    .badge-apply-btn {\n        background: white;\n        color: #667eea;\n    }\n\n    .badge-apply-btn:hover {\n        background: #f0f0f0;\n    }\n\n    .badge-dismiss-btn {\n        background: rgba(255, 255, 255, 0.2);\n        color: white;\n        width: 20px;\n        height: 20px;\n        padding: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .badge-dismiss-btn:hover {\n        background: rgba(255, 255, 255, 0.3);\n    }\n\n    /* Modal de configuraci√≥n */\n    .gemini-config-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100vh;\n        z-index: 3000;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .gemini-config-modal .modal-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n    }\n\n    .gemini-config-modal .modal-content {\n        background: white;\n        border-radius: 12px;\n        width: 90%;\n        max-width: 500px;\n        position: relative;\n        z-index: 10;\n        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);\n    }\n\n    .gemini-config-modal .modal-header {\n        padding: 20px 24px;\n        border-bottom: 1px solid #e2e8f0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n\n    .gemini-config-modal .modal-header h3 {\n        margin: 0;\n        font-size: 18px;\n        color: #1e293b;\n    }\n\n    .gemini-config-modal .modal-close-btn {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #64748b;\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .gemini-config-modal .modal-body {\n        padding: 24px;\n    }\n\n    .gemini-config-modal .config-info {\n        background: #f8fafc;\n        padding: 16px;\n        border-radius: 8px;\n        margin-bottom: 20px;\n    }\n\n    .gemini-config-modal .config-info p {\n        margin: 0 0 10px 0;\n        color: #475569;\n        font-size: 14px;\n        line-height: 1.6;\n    }\n\n    .gemini-config-modal .config-info p:last-child {\n        margin-bottom: 0;\n    }\n\n    .gemini-config-modal .config-info a {\n        color: #2563eb;\n        text-decoration: none;\n        font-weight: 500;\n        display: inline-block;\n        margin-top: 8px;\n    }\n\n    .gemini-config-modal .config-info a:hover {\n        text-decoration: underline;\n    }\n\n    .gemini-config-modal .form-group {\n        margin-bottom: 20px;\n    }\n\n    .gemini-config-modal .form-group label {\n        display: block;\n        margin-bottom: 8px;\n        font-weight: 500;\n        color: #1e293b;\n        font-size: 14px;\n    }\n\n    .gemini-config-modal .form-group input {\n        width: 100%;\n        padding: 10px 12px;\n        border: 1px solid #e2e8f0;\n        border-radius: 6px;\n        font-size: 14px;\n        font-family: monospace;\n    }\n\n    .gemini-config-modal .form-group input:focus {\n        outline: none;\n        border-color: #2563eb;\n        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);\n    }\n\n    .gemini-config-modal .config-status {\n        text-align: center;\n        padding: 12px;\n        border-radius: 6px;\n        background: #f8fafc;\n    }\n\n    .gemini-config-modal .status-enabled {\n        color: #10b981;\n        font-weight: 600;\n    }\n\n    .gemini-config-modal .status-disabled {\n        color: #f59e0b;\n        font-weight: 600;\n    }\n\n    .gemini-config-modal .modal-footer {\n        padding: 16px 24px;\n        border-top: 1px solid #e2e8f0;\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n    }\n\n    .gemini-config-modal .btn {\n        padding: 10px 20px;\n        border-radius: 6px;\n        font-weight: 500;\n        cursor: pointer;\n        border: none;\n        font-size: 14px;\n        transition: all 0.2s;\n    }\n\n    .gemini-config-modal .btn-primary {\n        background: #2563eb;\n        color: white;\n    }\n\n    .gemini-config-modal .btn-primary:hover {\n        background: #1d4ed8;\n    }\n\n    .gemini-config-modal .btn-secondary {\n        background: #f1f5f9;\n        color: #475569;\n    }\n\n    .gemini-config-modal .btn-secondary:hover {\n        background: #e2e8f0;\n    }\n\n    .gemini-config-modal .btn-danger {\n        background: #ef4444;\n        color: white;\n    }\n\n    .gemini-config-modal .btn-danger:hover {\n        background: #dc2626;\n    }\n`;\n\ndocument.head.appendChild(validatorStyles);\n\n// Exportar globalmente\nwindow.GeminiSyntaxValidator = GeminiSyntaxValidator;\n","/**\n * Resize Manager - v1.0\n * \n * Sistema avanzado de redimensionamiento de elementos con handles visuales.\n * Soporta redimensionamiento proporcional y l√≠mites m√≠nimos/m√°ximos.\n */\n\nclass ResizeManager {\n    constructor() {\n        this.activeElement = null;\n        this.resizing = false;\n        this.startX = 0;\n        this.startY = 0;\n        this.startWidth = 0;\n        this.startHeight = 0;\n        this.currentHandle = null;\n        this.minWidth = 20;\n        this.minHeight = 20;\n        this.aspectRatio = null;\n        this.preserveAspectRatio = false;\n        \n        this.handles = [\n            { name: 'nw', cursor: 'nw-resize', position: 'top-left' },\n            { name: 'n', cursor: 'n-resize', position: 'top-center' },\n            { name: 'ne', cursor: 'ne-resize', position: 'top-right' },\n            { name: 'e', cursor: 'e-resize', position: 'middle-right' },\n            { name: 'se', cursor: 'se-resize', position: 'bottom-right' },\n            { name: 's', cursor: 's-resize', position: 'bottom-center' },\n            { name: 'sw', cursor: 'sw-resize', position: 'bottom-left' },\n            { name: 'w', cursor: 'w-resize', position: 'middle-left' }\n        ];\n\n        this.init();\n    }\n\n    /**\n     * Inicializa el sistema de resize\n     */\n    init() {\n        // Agregar estilos\n        this.injectStyles();\n        \n        // Eventos globales\n        document.addEventListener('mousemove', this.handleMouseMove.bind(this));\n        document.addEventListener('mouseup', this.handleMouseUp.bind(this));\n        document.addEventListener('keydown', this.handleKeyDown.bind(this));\n        \n        console.log('‚úÖ ResizeManager inicializado');\n    }\n\n    /**\n     * Habilita resize para un elemento\n     */\n    enableResize(element) {\n        if (!element || element.classList.contains('resize-enabled')) {\n            return;\n        }\n\n        element.classList.add('resize-enabled');\n        \n        // Crear contenedor de handles\n        const handlesContainer = document.createElement('div');\n        handlesContainer.className = 'resize-handles';\n        \n        // Crear handles\n        this.handles.forEach(handleConfig => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle resize-handle-${handleConfig.name}`;\n            handle.dataset.handle = handleConfig.name;\n            handle.style.cursor = handleConfig.cursor;\n            \n            handle.addEventListener('mousedown', (e) => {\n                this.startResize(e, element, handleConfig.name);\n            });\n            \n            handlesContainer.appendChild(handle);\n        });\n        \n        element.appendChild(handlesContainer);\n    }\n\n    /**\n     * Deshabilita resize para un elemento\n     */\n    disableResize(element) {\n        if (!element) return;\n        \n        element.classList.remove('resize-enabled');\n        const handlesContainer = element.querySelector('.resize-handles');\n        if (handlesContainer) {\n            handlesContainer.remove();\n        }\n    }\n\n    /**\n     * Inicia el proceso de resize\n     */\n    startResize(e, element, handleName) {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        this.resizing = true;\n        this.activeElement = element;\n        this.currentHandle = handleName;\n        this.startX = e.clientX;\n        this.startY = e.clientY;\n        \n        // Obtener dimensiones iniciales\n        const computedStyle = window.getComputedStyle(element);\n        this.startWidth = parseFloat(computedStyle.width);\n        this.startHeight = parseFloat(computedStyle.height);\n        \n        // Calcular aspect ratio\n        this.aspectRatio = this.startWidth / this.startHeight;\n        \n        // Verificar si se debe preservar aspect ratio (Shift key)\n        this.preserveAspectRatio = e.shiftKey;\n        \n        // Agregar clase visual\n        element.classList.add('resizing');\n        document.body.classList.add('resizing-active');\n        \n        // Disparar evento\n        this.dispatchEvent('resizestart', {\n            element,\n            width: this.startWidth,\n            height: this.startHeight\n        });\n    }\n\n    /**\n     * Maneja el movimiento del mouse durante resize\n     */\n    handleMouseMove(e) {\n        if (!this.resizing || !this.activeElement) {\n            return;\n        }\n\n        e.preventDefault();\n        \n        const deltaX = e.clientX - this.startX;\n        const deltaY = e.clientY - this.startY;\n        \n        let newWidth = this.startWidth;\n        let newHeight = this.startHeight;\n        \n        // Calcular nuevas dimensiones seg√∫n el handle\n        switch (this.currentHandle) {\n            case 'e':\n                newWidth = this.startWidth + deltaX;\n                break;\n            case 'w':\n                newWidth = this.startWidth - deltaX;\n                break;\n            case 's':\n                newHeight = this.startHeight + deltaY;\n                break;\n            case 'n':\n                newHeight = this.startHeight - deltaY;\n                break;\n            case 'se':\n                newWidth = this.startWidth + deltaX;\n                newHeight = this.startHeight + deltaY;\n                break;\n            case 'sw':\n                newWidth = this.startWidth - deltaX;\n                newHeight = this.startHeight + deltaY;\n                break;\n            case 'ne':\n                newWidth = this.startWidth + deltaX;\n                newHeight = this.startHeight - deltaY;\n                break;\n            case 'nw':\n                newWidth = this.startWidth - deltaX;\n                newHeight = this.startHeight - deltaY;\n                break;\n        }\n\n        // Preservar aspect ratio si est√° activado\n        if (this.preserveAspectRatio || e.shiftKey) {\n            if (this.currentHandle.includes('e') || this.currentHandle.includes('w')) {\n                newHeight = newWidth / this.aspectRatio;\n            } else if (this.currentHandle.includes('n') || this.currentHandle.includes('s')) {\n                newWidth = newHeight * this.aspectRatio;\n            }\n        }\n\n        // Aplicar l√≠mites m√≠nimos\n        newWidth = Math.max(this.minWidth, newWidth);\n        newHeight = Math.max(this.minHeight, newHeight);\n\n        // Aplicar dimensiones\n        this.activeElement.style.width = newWidth + 'px';\n        this.activeElement.style.height = newHeight + 'px';\n        \n        // Actualizar info tooltip\n        this.showDimensionsTooltip(newWidth, newHeight);\n        \n        // Disparar evento\n        this.dispatchEvent('resizing', {\n            element: this.activeElement,\n            width: newWidth,\n            height: newHeight\n        });\n    }\n\n    /**\n     * Finaliza el resize\n     */\n    handleMouseUp(e) {\n        if (!this.resizing) {\n            return;\n        }\n\n        this.resizing = false;\n        \n        if (this.activeElement) {\n            this.activeElement.classList.remove('resizing');\n            \n            const finalWidth = parseFloat(this.activeElement.style.width);\n            const finalHeight = parseFloat(this.activeElement.style.height);\n            \n            // Disparar evento\n            this.dispatchEvent('resizeend', {\n                element: this.activeElement,\n                width: finalWidth,\n                height: finalHeight\n            });\n        }\n        \n        document.body.classList.remove('resizing-active');\n        this.hideDimensionsTooltip();\n        \n        this.activeElement = null;\n        this.currentHandle = null;\n    }\n\n    /**\n     * Maneja teclas durante resize\n     */\n    handleKeyDown(e) {\n        // ESC para cancelar\n        if (e.key === 'Escape' && this.resizing) {\n            this.cancelResize();\n        }\n        \n        // Shift para preservar aspect ratio\n        if (e.key === 'Shift' && this.resizing) {\n            this.preserveAspectRatio = true;\n        }\n    }\n\n    /**\n     * Cancela el resize y restaura dimensiones originales\n     */\n    cancelResize() {\n        if (!this.resizing || !this.activeElement) {\n            return;\n        }\n\n        this.activeElement.style.width = this.startWidth + 'px';\n        this.activeElement.style.height = this.startHeight + 'px';\n        \n        this.handleMouseUp(new Event('mouseup'));\n        \n        if (window.showToast) {\n            window.showToast('‚è™ Resize cancelado');\n        }\n    }\n\n    /**\n     * Muestra tooltip con dimensiones actuales\n     */\n    showDimensionsTooltip(width, height) {\n        let tooltip = document.getElementById('resize-dimensions-tooltip');\n        \n        if (!tooltip) {\n            tooltip = document.createElement('div');\n            tooltip.id = 'resize-dimensions-tooltip';\n            tooltip.className = 'resize-dimensions-tooltip';\n            document.body.appendChild(tooltip);\n        }\n\n        tooltip.textContent = `${Math.round(width)} √ó ${Math.round(height)} px`;\n        tooltip.style.display = 'block';\n        \n        // Posicionar cerca del cursor\n        const rect = this.activeElement.getBoundingClientRect();\n        tooltip.style.left = (rect.left + rect.width / 2) + 'px';\n        tooltip.style.top = (rect.bottom + 10) + 'px';\n    }\n\n    /**\n     * Oculta tooltip de dimensiones\n     */\n    hideDimensionsTooltip() {\n        const tooltip = document.getElementById('resize-dimensions-tooltip');\n        if (tooltip) {\n            tooltip.style.display = 'none';\n        }\n    }\n\n    /**\n     * Establece dimensiones espec√≠ficas\n     */\n    setDimensions(element, width, height) {\n        if (!element) return;\n        \n        element.style.width = width + 'px';\n        element.style.height = height + 'px';\n        \n        this.dispatchEvent('dimensionschanged', {\n            element,\n            width,\n            height\n        });\n    }\n\n    /**\n     * Resetea dimensiones al valor autom√°tico\n     */\n    resetDimensions(element) {\n        if (!element) return;\n        \n        element.style.width = '';\n        element.style.height = '';\n        \n        this.dispatchEvent('dimensionsreset', { element });\n    }\n\n    /**\n     * Ajusta elemento al contenido\n     */\n    fitToContent(element) {\n        if (!element) return;\n        \n        element.style.width = 'fit-content';\n        element.style.height = 'auto';\n        \n        this.dispatchEvent('fittocontent', { element });\n    }\n\n    /**\n     * Dispara evento customizado\n     */\n    dispatchEvent(eventName, detail) {\n        const event = new CustomEvent(`resize:${eventName}`, {\n            detail,\n            bubbles: true\n        });\n        \n        if (detail.element) {\n            detail.element.dispatchEvent(event);\n        }\n        \n        window.dispatchEvent(event);\n    }\n\n    /**\n     * Inyecta estilos CSS\n     */\n    injectStyles() {\n        const styleId = 'resize-manager-styles';\n        if (document.getElementById(styleId)) {\n            return;\n        }\n\n        const style = document.createElement('style');\n        style.id = styleId;\n        style.textContent = `\n            /* Contenedor de handles */\n            .resize-handles {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n                z-index: 999;\n                display: none;\n            }\n\n            .canvas-element.selected .resize-handles {\n                display: block;\n            }\n\n            /* Handles individuales */\n            .resize-handle {\n                position: absolute;\n                width: 10px;\n                height: 10px;\n                background: white;\n                border: 2px solid #2563eb;\n                border-radius: 50%;\n                pointer-events: auto;\n                z-index: 1000;\n                transition: all 0.2s;\n            }\n\n            .resize-handle:hover {\n                transform: scale(1.3);\n                background: #2563eb;\n                box-shadow: 0 0 8px rgba(37, 99, 235, 0.5);\n            }\n\n            /* Posiciones de handles */\n            .resize-handle-nw { top: -5px; left: -5px; }\n            .resize-handle-n { top: -5px; left: 50%; transform: translateX(-50%); }\n            .resize-handle-ne { top: -5px; right: -5px; }\n            .resize-handle-e { top: 50%; right: -5px; transform: translateY(-50%); }\n            .resize-handle-se { bottom: -5px; right: -5px; }\n            .resize-handle-s { bottom: -5px; left: 50%; transform: translateX(-50%); }\n            .resize-handle-sw { bottom: -5px; left: -5px; }\n            .resize-handle-w { top: 50%; left: -5px; transform: translateY(-50%); }\n\n            /* Estado resizing */\n            .canvas-element.resizing {\n                outline: 2px solid #2563eb !important;\n                opacity: 0.8;\n            }\n\n            body.resizing-active {\n                cursor: inherit !important;\n                user-select: none;\n            }\n\n            body.resizing-active * {\n                cursor: inherit !important;\n            }\n\n            /* Tooltip de dimensiones */\n            .resize-dimensions-tooltip {\n                position: fixed;\n                background: rgba(37, 99, 235, 0.95);\n                color: white;\n                padding: 6px 12px;\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 600;\n                pointer-events: none;\n                z-index: 10000;\n                transform: translateX(-50%);\n                box-shadow: 0 4px 6px rgba(0,0,0,0.2);\n                display: none;\n                white-space: nowrap;\n                animation: tooltipFadeIn 0.2s ease;\n            }\n\n            @keyframes tooltipFadeIn {\n                from {\n                    opacity: 0;\n                    transform: translateX(-50%) translateY(-5px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateX(-50%) translateY(0);\n                }\n            }\n\n            /* Hints visuales */\n            .canvas-element.resize-enabled::after {\n                content: '';\n                position: absolute;\n                bottom: 3px;\n                right: 3px;\n                width: 0;\n                height: 0;\n                border-style: solid;\n                border-width: 0 0 10px 10px;\n                border-color: transparent transparent #94a3b8 transparent;\n                opacity: 0.3;\n                pointer-events: none;\n            }\n\n            .canvas-element.resize-enabled.selected::after {\n                border-color: transparent transparent #2563eb transparent;\n                opacity: 0.5;\n            }\n        `;\n\n        document.head.appendChild(style);\n    }\n\n    /**\n     * Destruir el resize manager\n     */\n    destroy() {\n        document.removeEventListener('mousemove', this.handleMouseMove);\n        document.removeEventListener('mouseup', this.handleMouseUp);\n        document.removeEventListener('keydown', this.handleKeyDown);\n        \n        const tooltip = document.getElementById('resize-dimensions-tooltip');\n        if (tooltip) {\n            tooltip.remove();\n        }\n        \n        console.log('üóëÔ∏è ResizeManager destruido');\n    }\n}\n\n// Exportar globalmente\nwindow.ResizeManager = ResizeManager;\n","/**\n * Enhanced Drag & Drop Manager - v1.0\n * \n * Sistema mejorado de drag & drop con preview visual, ghost elements,\n * y mejor detecci√≥n de zonas de drop.\n */\n\nclass EnhancedDragDropManager {\n    constructor() {\n        this.draggedElement = null;\n        this.draggedType = null;\n        this.ghostElement = null;\n        this.dropIndicator = null;\n        this.dragPreview = null;\n        this.isDragging = false;\n        this.dropZones = [];\n        this.snapThreshold = 10; // px para snap\n        this.scrollSpeed = 5;\n        this.scrollEdgeSize = 50;\n        \n        this.init();\n    }\n\n    /**\n     * Inicializa el sistema\n     */\n    init() {\n        this.injectStyles();\n        this.createDropIndicator();\n        this.setupGlobalEvents();\n        \n        console.log('‚úÖ EnhancedDragDropManager inicializado');\n    }\n\n    /**\n     * Configura eventos globales\n     */\n    setupGlobalEvents() {\n        document.addEventListener('dragover', this.handleDragOver.bind(this));\n        document.addEventListener('drop', this.handleDrop.bind(this));\n        document.addEventListener('dragend', this.handleDragEnd.bind(this));\n    }\n\n    /**\n     * Habilita drag en componente del panel\n     */\n    setupComponentDrag(componentElement, type) {\n        componentElement.draggable = true;\n        componentElement.dataset.componentType = type;\n        \n        componentElement.addEventListener('dragstart', (e) => {\n            this.startComponentDrag(e, componentElement, type);\n        });\n        \n        componentElement.addEventListener('dragend', (e) => {\n            this.endComponentDrag(e, componentElement);\n        });\n    }\n\n    /**\n     * Habilita drag en elemento del canvas\n     */\n    setupCanvasElementDrag(element) {\n        // Solo habilitar drag si el elemento est√° seleccionado\n        element.draggable = element.classList.contains('selected');\n        \n        // Agregar drag handle visual\n        if (!element.querySelector('.drag-handle')) {\n            const handle = document.createElement('div');\n            handle.className = 'drag-handle';\n            handle.innerHTML = '‚ãÆ‚ãÆ';\n            handle.title = 'Arrastrar para reordenar (o seleccionar elemento)';\n            element.appendChild(handle);\n        }\n        \n        element.addEventListener('dragstart', (e) => {\n            // Solo permitir si est√° seleccionado\n            if (!element.classList.contains('selected')) {\n                e.preventDefault();\n                return;\n            }\n            \n            this.startCanvasElementDrag(e, element);\n        });\n        \n        element.addEventListener('dragend', (e) => {\n            this.endCanvasElementDrag(e, element);\n        });\n        \n        // Habilitar/deshabilitar drag seg√∫n selecci√≥n\n        element.addEventListener('click', () => {\n            element.draggable = element.classList.contains('selected');\n        });\n    }\n\n    /**\n     * Inicia drag de componente desde panel\n     */\n    startComponentDrag(e, componentElement, type) {\n        this.isDragging = true;\n        this.draggedType = type;\n        this.draggedElement = null; // Es un nuevo componente\n        \n        // Crear preview customizado\n        this.createDragPreview(componentElement, true);\n        e.dataTransfer.setDragImage(this.dragPreview, 0, 0);\n        e.dataTransfer.effectAllowed = 'copy';\n        \n        // Marcar elemento como arrastrando\n        componentElement.classList.add('dragging');\n        \n        // Resaltar zonas de drop disponibles\n        this.highlightDropZones();\n        \n        this.dispatchEvent('dragstart', { type, isNewComponent: true });\n    }\n\n    /**\n     * Inicia drag de elemento del canvas\n     */\n    startCanvasElementDrag(e, element) {\n        this.isDragging = true;\n        this.draggedElement = element;\n        this.draggedType = element.dataset.componentType;\n        \n        // Crear preview\n        this.createDragPreview(element, false);\n        e.dataTransfer.setDragImage(this.dragPreview, 0, 0);\n        e.dataTransfer.effectAllowed = 'move';\n        \n        // Marcar elemento\n        element.classList.add('dragging-canvas-element');\n        \n        // Resaltar zonas de drop\n        this.highlightDropZones();\n        \n        this.dispatchEvent('dragstart', { element, type: this.draggedType, isNewComponent: false });\n    }\n\n    /**\n     * Crea preview visual del elemento arrastr√°ndose\n     */\n    createDragPreview(sourceElement, isNewComponent) {\n        // Eliminar preview anterior si existe\n        if (this.dragPreview) {\n            this.dragPreview.remove();\n        }\n\n        this.dragPreview = document.createElement('div');\n        this.dragPreview.className = 'drag-preview';\n        \n        if (isNewComponent) {\n            this.dragPreview.textContent = sourceElement.textContent;\n            this.dragPreview.style.padding = '10px 20px';\n        } else {\n            // Clonar contenido visual\n            const clone = sourceElement.cloneNode(true);\n            // Limpiar elementos de UI del editor\n            clone.querySelectorAll('.delete-btn, .resize-handles, .drag-handle').forEach(el => el.remove());\n            this.dragPreview.appendChild(clone);\n        }\n        \n        document.body.appendChild(this.dragPreview);\n    }\n\n    /**\n     * Maneja evento dragover global\n     */\n    handleDragOver(e) {\n        if (!this.isDragging) return;\n        \n        e.preventDefault();\n        e.dataTransfer.dropEffect = this.draggedElement ? 'move' : 'copy';\n        \n        // Auto-scroll cuando est√° cerca del borde\n        this.handleAutoScroll(e);\n        \n        // Encontrar drop zone m√°s cercana\n        const dropTarget = this.findDropTarget(e);\n        \n        if (dropTarget) {\n            this.showDropIndicator(dropTarget, e);\n        } else {\n            this.hideDropIndicator();\n        }\n    }\n\n    /**\n     * Maneja drop\n     */\n    handleDrop(e) {\n        if (!this.isDragging) return;\n        \n        e.preventDefault();\n        e.stopPropagation();\n        \n        const dropTarget = this.findDropTarget(e);\n        \n        if (!dropTarget) {\n            if (window.showToast) {\n                window.showToast('‚ö†Ô∏è Zona de drop inv√°lida', 'warning');\n            }\n            return;\n        }\n\n        // Determinar posici√≥n de inserci√≥n\n        const insertPosition = this.calculateInsertPosition(dropTarget.element, e);\n        \n        if (this.draggedElement) {\n            // Mover elemento existente\n            this.moveElement(this.draggedElement, dropTarget.element, insertPosition);\n        } else {\n            // Crear nuevo componente\n            this.createNewComponent(this.draggedType, dropTarget.element, insertPosition);\n        }\n        \n        this.dispatchEvent('drop', {\n            type: this.draggedType,\n            target: dropTarget.element,\n            position: insertPosition\n        });\n    }\n\n    /**\n     * Finaliza drag de componente\n     */\n    endComponentDrag(e, componentElement) {\n        componentElement.classList.remove('dragging');\n        this.cleanup();\n    }\n\n    /**\n     * Finaliza drag de elemento canvas\n     */\n    endCanvasElementDrag(e, element) {\n        element.classList.remove('dragging-canvas-element');\n        this.cleanup();\n    }\n\n    /**\n     * Maneja finalizaci√≥n de drag\n     */\n    handleDragEnd(e) {\n        this.cleanup();\n    }\n\n    /**\n     * Encuentra el target de drop m√°s apropiado\n     */\n    findDropTarget(e) {\n        const canvas = document.getElementById('canvas');\n        const elementsUnderCursor = document.elementsFromPoint(e.clientX, e.clientY);\n        \n        // Buscar canvas o elementos canvas\n        for (const el of elementsUnderCursor) {\n            if (el.id === 'canvas') {\n                return {\n                    element: el,\n                    type: 'canvas',\n                    canAcceptChildren: true\n                };\n            }\n            \n            if (el.classList.contains('canvas-element') && el !== this.draggedElement) {\n                // Verificar si puede aceptar hijos\n                const canAcceptChildren = this.canAcceptChildren(el);\n                \n                return {\n                    element: el,\n                    type: 'element',\n                    canAcceptChildren\n                };\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Verifica si un elemento puede aceptar hijos\n     */\n    canAcceptChildren(element) {\n        const containerTags = ['div', 'section', 'article', 'header', 'footer', 'nav', 'main', 'aside'];\n        return containerTags.includes(element.tagName.toLowerCase());\n    }\n\n    /**\n     * Calcula la posici√≥n de inserci√≥n\n     */\n    calculateInsertPosition(targetElement, e) {\n        if (targetElement.id === 'canvas') {\n            // Si el canvas est√° vac√≠o o se suelta al final\n            const children = Array.from(targetElement.children).filter(el => \n                el.classList.contains('canvas-element')\n            );\n            \n            if (children.length === 0) {\n                return { type: 'append', reference: null };\n            }\n            \n            // Buscar elemento m√°s cercano\n            let closestElement = null;\n            let closestDistance = Infinity;\n            let insertBefore = false;\n            \n            children.forEach(child => {\n                const rect = child.getBoundingClientRect();\n                const childCenterY = rect.top + rect.height / 2;\n                const distance = Math.abs(childCenterY - e.clientY);\n                \n                if (distance < closestDistance) {\n                    closestDistance = distance;\n                    closestElement = child;\n                    insertBefore = e.clientY < childCenterY;\n                }\n            });\n            \n            return {\n                type: insertBefore ? 'before' : 'after',\n                reference: closestElement\n            };\n        }\n        \n        // Insertar relativo al elemento\n        const rect = targetElement.getBoundingClientRect();\n        const relativeY = e.clientY - rect.top;\n        const threshold = rect.height / 3;\n        \n        if (relativeY < threshold) {\n            return { type: 'before', reference: targetElement };\n        } else if (relativeY > rect.height - threshold) {\n            return { type: 'after', reference: targetElement };\n        } else if (this.canAcceptChildren(targetElement)) {\n            return { type: 'append', reference: targetElement };\n        } else {\n            return { type: 'after', reference: targetElement };\n        }\n    }\n\n    /**\n     * Mueve elemento existente\n     */\n    moveElement(element, target, position) {\n        if (position.type === 'before') {\n            position.reference.parentNode.insertBefore(element, position.reference);\n        } else if (position.type === 'after') {\n            const nextSibling = position.reference.nextSibling;\n            if (nextSibling) {\n                position.reference.parentNode.insertBefore(element, nextSibling);\n            } else {\n                position.reference.parentNode.appendChild(element);\n            }\n        } else if (position.type === 'append') {\n            (position.reference || target).appendChild(element);\n        }\n        \n        // Mantener selecci√≥n\n        if (window.selectElement) {\n            window.selectElement(element);\n        }\n        \n        if (window.showToast) {\n            window.showToast('‚úÖ Elemento reordenado');\n        }\n    }\n\n    /**\n     * Crea nuevo componente\n     */\n    createNewComponent(type, target, position) {\n        // Usar la funci√≥n global createComponent\n        if (!window.createComponent) {\n            console.error('createComponent no est√° disponible');\n            return;\n        }\n        \n        const newElement = window.createComponent(type);\n        \n        if (position.type === 'before') {\n            position.reference.parentNode.insertBefore(newElement, position.reference);\n        } else if (position.type === 'after') {\n            const nextSibling = position.reference.nextSibling;\n            if (nextSibling) {\n                position.reference.parentNode.insertBefore(newElement, nextSibling);\n            } else {\n                position.reference.parentNode.appendChild(newElement);\n            }\n        } else if (position.type === 'append') {\n            (position.reference || target).appendChild(newElement);\n        }\n        \n        // Seleccionar nuevo elemento\n        if (window.selectElement) {\n            window.selectElement(newElement);\n        }\n        \n        if (window.showToast) {\n            window.showToast('‚úÖ Componente agregado');\n        }\n    }\n\n    /**\n     * Crea indicador de drop\n     */\n    createDropIndicator() {\n        this.dropIndicator = document.createElement('div');\n        this.dropIndicator.className = 'enhanced-drop-indicator';\n        this.dropIndicator.innerHTML = '<div class=\"indicator-line\"></div>';\n        document.body.appendChild(this.dropIndicator);\n    }\n\n    /**\n     * Muestra indicador de drop\n     */\n    showDropIndicator(dropTarget, e) {\n        if (!this.dropIndicator) return;\n        \n        const position = this.calculateInsertPosition(dropTarget.element, e);\n        let rect;\n        \n        if (position.type === 'append' && position.reference) {\n            rect = position.reference.getBoundingClientRect();\n            this.dropIndicator.style.left = rect.left + 'px';\n            this.dropIndicator.style.top = (rect.top + rect.height / 2) + 'px';\n            this.dropIndicator.style.width = rect.width + 'px';\n            this.dropIndicator.classList.add('mode-append');\n            this.dropIndicator.classList.remove('mode-insert');\n        } else if (position.reference) {\n            rect = position.reference.getBoundingClientRect();\n            this.dropIndicator.style.left = rect.left + 'px';\n            this.dropIndicator.style.width = rect.width + 'px';\n            \n            if (position.type === 'before') {\n                this.dropIndicator.style.top = (rect.top - 2) + 'px';\n            } else {\n                this.dropIndicator.style.top = (rect.bottom - 2) + 'px';\n            }\n            \n            this.dropIndicator.classList.add('mode-insert');\n            this.dropIndicator.classList.remove('mode-append');\n        }\n        \n        this.dropIndicator.style.display = 'block';\n    }\n\n    /**\n     * Oculta indicador de drop\n     */\n    hideDropIndicator() {\n        if (this.dropIndicator) {\n            this.dropIndicator.style.display = 'none';\n        }\n    }\n\n    /**\n     * Resalta zonas de drop disponibles\n     */\n    highlightDropZones() {\n        const canvas = document.getElementById('canvas');\n        canvas?.classList.add('drop-zone-active');\n        \n        document.querySelectorAll('.canvas-element').forEach(el => {\n            if (el !== this.draggedElement && this.canAcceptChildren(el)) {\n                el.classList.add('potential-drop-zone');\n            }\n        });\n    }\n\n    /**\n     * Limpia resaltado de zonas\n     */\n    clearDropZones() {\n        document.getElementById('canvas')?.classList.remove('drop-zone-active');\n        document.querySelectorAll('.potential-drop-zone').forEach(el => {\n            el.classList.remove('potential-drop-zone');\n        });\n    }\n\n    /**\n     * Auto-scroll cuando est√° cerca del borde\n     */\n    handleAutoScroll(e) {\n        const canvasPanel = document.querySelector('.canvas-panel');\n        if (!canvasPanel) return;\n        \n        const rect = canvasPanel.getBoundingClientRect();\n        const scrollY = canvasPanel.scrollTop;\n        \n        // Scroll hacia arriba\n        if (e.clientY - rect.top < this.scrollEdgeSize) {\n            canvasPanel.scrollTop = scrollY - this.scrollSpeed;\n        }\n        // Scroll hacia abajo\n        else if (rect.bottom - e.clientY < this.scrollEdgeSize) {\n            canvasPanel.scrollTop = scrollY + this.scrollSpeed;\n        }\n    }\n\n    /**\n     * Limpieza despu√©s de drag\n     */\n    cleanup() {\n        this.isDragging = false;\n        this.draggedElement = null;\n        this.draggedType = null;\n        \n        this.hideDropIndicator();\n        this.clearDropZones();\n        \n        if (this.dragPreview) {\n            this.dragPreview.remove();\n            this.dragPreview = null;\n        }\n        \n        // Limpiar clases\n        document.querySelectorAll('.dragging, .dragging-canvas-element').forEach(el => {\n            el.classList.remove('dragging', 'dragging-canvas-element');\n        });\n    }\n\n    /**\n     * Dispara evento customizado\n     */\n    dispatchEvent(eventName, detail) {\n        const event = new CustomEvent(`dragdrop:${eventName}`, {\n            detail,\n            bubbles: true\n        });\n        \n        window.dispatchEvent(event);\n    }\n\n    /**\n     * Inyecta estilos\n     */\n    injectStyles() {\n        const styleId = 'enhanced-dragdrop-styles';\n        if (document.getElementById(styleId)) return;\n\n        const style = document.createElement('style');\n        style.id = styleId;\n        style.textContent = `\n            /* Drag handle */\n            .drag-handle {\n                position: absolute;\n                top: 50%;\n                left: -20px;\n                transform: translateY(-50%);\n                width: 16px;\n                height: 30px;\n                background: #2563eb;\n                color: white;\n                display: none;\n                align-items: center;\n                justify-content: center;\n                border-radius: 4px 0 0 4px;\n                cursor: grab;\n                font-size: 10px;\n                letter-spacing: -1px;\n                z-index: 998;\n                opacity: 0;\n                transition: all 0.2s;\n            }\n\n            .canvas-element.selected .drag-handle {\n                display: flex;\n            }\n\n            .canvas-element.selected:hover .drag-handle {\n                opacity: 1;\n                left: -22px;\n            }\n\n            .drag-handle:active {\n                cursor: grabbing;\n            }\n\n            /* Preview de drag */\n            .drag-preview {\n                position: fixed;\n                top: -9999px;\n                left: -9999px;\n                background: white;\n                border: 2px solid #2563eb;\n                border-radius: 6px;\n                padding: 8px 16px;\n                box-shadow: 0 10px 25px rgba(0,0,0,0.2);\n                font-size: 13px;\n                font-weight: 500;\n                color: #1e293b;\n                z-index: 10000;\n                opacity: 0.9;\n                pointer-events: none;\n            }\n\n            /* Indicador de drop mejorado */\n            .enhanced-drop-indicator {\n                position: fixed;\n                height: 4px;\n                z-index: 9999;\n                display: none;\n                pointer-events: none;\n            }\n\n            .enhanced-drop-indicator .indicator-line {\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n                border-radius: 2px;\n                box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);\n                animation: indicatorPulse 1s infinite;\n            }\n\n            .enhanced-drop-indicator.mode-append .indicator-line {\n                background: linear-gradient(90deg, #10b981, #059669);\n                box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);\n            }\n\n            @keyframes indicatorPulse {\n                0%, 100% { opacity: 1; transform: scaleX(1); }\n                50% { opacity: 0.7; transform: scaleX(0.95); }\n            }\n\n            /* Zonas de drop */\n            .drop-zone-active {\n                background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%) !important;\n                outline: 2px dashed #3b82f6 !important;\n                outline-offset: 4px;\n            }\n\n            .potential-drop-zone {\n                outline: 2px dashed #10b981 !important;\n                outline-offset: 2px;\n                background: rgba(16, 185, 129, 0.05) !important;\n            }\n\n            /* Estados de arrastre */\n            .component-item.dragging {\n                opacity: 0.5;\n                transform: scale(0.95);\n                background: #e0f2fe !important;\n            }\n\n            .canvas-element.dragging-canvas-element {\n                opacity: 0.4;\n                outline: 2px dashed #3b82f6 !important;\n            }\n\n            /* Cursor durante drag */\n            body.dragging-active {\n                cursor: grabbing !important;\n            }\n\n            body.dragging-active * {\n                cursor: inherit !important;\n            }\n        `;\n\n        document.head.appendChild(style);\n    }\n\n    /**\n     * Destruir\n     */\n    destroy() {\n        this.cleanup();\n        \n        if (this.dropIndicator) {\n            this.dropIndicator.remove();\n        }\n        \n        console.log('üóëÔ∏è EnhancedDragDropManager destruido');\n    }\n}\n\n// Exportar globalmente\nwindow.EnhancedDragDropManager = EnhancedDragDropManager;\n","/**\n * Project Analyzer - v1.0\n * \n * Analiza y mapea proyectos JS/HTML completos usando Gemini API.\n * Carga directorios completos y genera un √°rbol de estructura.\n */\n\nclass ProjectAnalyzer {\n    constructor() {\n        this.geminiValidator = null;\n        this.currentProject = null;\n        this.fileTree = null;\n        this.analysisCache = new Map();\n        this.supportedExtensions = ['.html', '.htm', '.js', '.jsx', '.css', '.scss', '.sass', '.json'];\n        this.maxFileSize = 500 * 1024; // 500KB por archivo\n        \n        this.init();\n    }\n\n    /**\n     * Inicializa el analizador\n     */\n    init() {\n        // Esperar a que GeminiValidator est√© disponible\n        if (window.GeminiSyntaxValidator) {\n            this.geminiValidator = new window.GeminiSyntaxValidator();\n        }\n        \n        console.log('‚úÖ ProjectAnalyzer inicializado');\n    }\n\n    /**\n     * Carga y analiza un directorio completo\n     */\n    async loadDirectory(fileList) {\n        try {\n            if (!fileList || fileList.length === 0) {\n                throw new Error('No se seleccionaron archivos');\n            }\n\n            this.showLoadingModal('Analizando proyecto...');\n\n            // Construir √°rbol de archivos\n            this.fileTree = await this.buildFileTree(fileList);\n            \n            // Analizar estructura\n            const structure = await this.analyzeProjectStructure(this.fileTree);\n            \n            // Identificar archivos principales\n            const mainFiles = this.identifyMainFiles(this.fileTree);\n            \n            // Construir proyecto\n            this.currentProject = {\n                name: this.extractProjectName(this.fileTree),\n                tree: this.fileTree,\n                structure,\n                mainFiles,\n                totalFiles: fileList.length,\n                timestamp: Date.now()\n            };\n\n            this.hideLoadingModal();\n            \n            // Mostrar modal de resultados\n            this.showAnalysisResults(this.currentProject);\n            \n            return this.currentProject;\n\n        } catch (error) {\n            this.hideLoadingModal();\n            console.error('Error analizando proyecto:', error);\n            \n            if (window.showToast) {\n                window.showToast(`‚ùå Error: ${error.message}`, 'error');\n            }\n            \n            throw error;\n        }\n    }\n\n    /**\n     * Construye √°rbol de archivos desde FileList\n     */\n    async buildFileTree(fileList) {\n        const tree = {\n            name: 'root',\n            type: 'directory',\n            children: new Map(),\n            files: []\n        };\n\n        for (const file of fileList) {\n            // Verificar extensi√≥n\n            const ext = this.getFileExtension(file.name);\n            if (!this.supportedExtensions.includes(ext)) {\n                continue;\n            }\n\n            // Verificar tama√±o\n            if (file.size > this.maxFileSize) {\n                console.warn(`Archivo muy grande, ignorando: ${file.name}`);\n                continue;\n            }\n\n            // Leer contenido\n            const content = await this.readFileContent(file);\n            \n            // Parsear ruta\n            const pathParts = file.webkitRelativePath \n                ? file.webkitRelativePath.split('/')\n                : [file.name];\n            \n            // Insertar en √°rbol\n            this.insertIntoTree(tree, pathParts, {\n                name: file.name,\n                path: file.webkitRelativePath || file.name,\n                type: 'file',\n                extension: ext,\n                size: file.size,\n                content,\n                lastModified: file.lastModified\n            });\n        }\n\n        return tree;\n    }\n\n    /**\n     * Inserta archivo en el √°rbol\n     */\n    insertIntoTree(node, pathParts, fileData) {\n        if (pathParts.length === 1) {\n            // Es un archivo en este nivel\n            node.files.push(fileData);\n            return;\n        }\n\n        // Es un directorio\n        const dirName = pathParts[0];\n        \n        if (!node.children.has(dirName)) {\n            node.children.set(dirName, {\n                name: dirName,\n                type: 'directory',\n                children: new Map(),\n                files: []\n            });\n        }\n\n        this.insertIntoTree(\n            node.children.get(dirName),\n            pathParts.slice(1),\n            fileData\n        );\n    }\n\n    /**\n     * Lee contenido de archivo\n     */\n    readFileContent(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            \n            reader.onload = (e) => resolve(e.target.result);\n            reader.onerror = (e) => reject(new Error('Error leyendo archivo'));\n            \n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * Analiza estructura del proyecto\n     */\n    async analyzeProjectStructure(tree) {\n        const structure = {\n            hasPackageJson: false,\n            hasIndexHtml: false,\n            framework: 'vanilla',\n            buildTool: null,\n            dependencies: [],\n            scripts: {},\n            directories: {\n                src: false,\n                public: false,\n                dist: false,\n                components: false,\n                assets: false\n            }\n        };\n\n        // Buscar archivos clave\n        const allFiles = this.flattenTree(tree);\n        \n        for (const file of allFiles) {\n            const fileName = file.name.toLowerCase();\n            \n            // package.json\n            if (fileName === 'package.json') {\n                structure.hasPackageJson = true;\n                try {\n                    const pkg = JSON.parse(file.content);\n                    structure.dependencies = Object.keys(pkg.dependencies || {});\n                    structure.scripts = pkg.scripts || {};\n                    structure.framework = this.detectFramework(pkg);\n                    structure.buildTool = this.detectBuildTool(pkg);\n                } catch (e) {\n                    console.warn('Error parseando package.json');\n                }\n            }\n            \n            // index.html\n            if (fileName === 'index.html' || fileName === 'index.htm') {\n                structure.hasIndexHtml = true;\n            }\n        }\n\n        // Detectar directorios comunes\n        this.detectCommonDirectories(tree, structure.directories);\n\n        return structure;\n    }\n\n    /**\n     * Detecta framework usado\n     */\n    detectFramework(packageJson) {\n        const deps = {\n            ...packageJson.dependencies,\n            ...packageJson.devDependencies\n        };\n\n        if (deps['react']) return 'react';\n        if (deps['vue']) return 'vue';\n        if (deps['@angular/core']) return 'angular';\n        if (deps['svelte']) return 'svelte';\n        if (deps['next']) return 'next';\n        if (deps['nuxt']) return 'nuxt';\n        \n        return 'vanilla';\n    }\n\n    /**\n     * Detecta build tool\n     */\n    detectBuildTool(packageJson) {\n        const deps = {\n            ...packageJson.dependencies,\n            ...packageJson.devDependencies\n        };\n\n        if (deps['vite']) return 'vite';\n        if (deps['webpack']) return 'webpack';\n        if (deps['rollup']) return 'rollup';\n        if (deps['parcel']) return 'parcel';\n        if (deps['esbuild']) return 'esbuild';\n        \n        return null;\n    }\n\n    /**\n     * Detecta directorios comunes\n     */\n    detectCommonDirectories(node, directories) {\n        const dirName = node.name.toLowerCase();\n        \n        if (dirName === 'src') directories.src = true;\n        if (dirName === 'public') directories.public = true;\n        if (dirName === 'dist' || dirName === 'build') directories.dist = true;\n        if (dirName === 'components') directories.components = true;\n        if (dirName === 'assets' || dirName === 'static') directories.assets = true;\n\n        // Recursivo\n        for (const child of node.children.values()) {\n            this.detectCommonDirectories(child, directories);\n        }\n    }\n\n    /**\n     * Identifica archivos principales\n     */\n    identifyMainFiles(tree) {\n        const allFiles = this.flattenTree(tree);\n        const mainFiles = {\n            html: [],\n            entry: [],\n            config: []\n        };\n\n        for (const file of allFiles) {\n            const fileName = file.name.toLowerCase();\n            const ext = file.extension;\n\n            // HTML principales\n            if ((ext === '.html' || ext === '.htm') && \n                (fileName === 'index.html' || fileName === 'index.htm' || \n                 fileName.includes('main'))) {\n                mainFiles.html.push(file);\n            }\n\n            // Entry points JS\n            if ((ext === '.js' || ext === '.jsx') && \n                (fileName === 'index.js' || fileName === 'main.js' || \n                 fileName === 'app.js' || fileName.includes('entry'))) {\n                mainFiles.entry.push(file);\n            }\n\n            // Configs\n            if (fileName === 'package.json' || fileName === 'vite.config.js' ||\n                fileName === 'webpack.config.js' || fileName === 'tsconfig.json') {\n                mainFiles.config.push(file);\n            }\n        }\n\n        return mainFiles;\n    }\n\n    /**\n     * Aplana √°rbol de archivos\n     */\n    flattenTree(node, result = []) {\n        // Agregar archivos de este nivel\n        if (node.files) {\n            result.push(...node.files);\n        }\n\n        // Recursivo en hijos\n        if (node.children) {\n            for (const child of node.children.values()) {\n                this.flattenTree(child, result);\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Extrae nombre del proyecto\n     */\n    extractProjectName(tree) {\n        // Buscar en package.json\n        const allFiles = this.flattenTree(tree);\n        const pkgFile = allFiles.find(f => f.name === 'package.json');\n        \n        if (pkgFile) {\n            try {\n                const pkg = JSON.parse(pkgFile.content);\n                if (pkg.name) return pkg.name;\n            } catch (e) {}\n        }\n\n        // Usar nombre del primer directorio\n        if (tree.children.size > 0) {\n            return Array.from(tree.children.keys())[0];\n        }\n\n        return 'Proyecto sin nombre';\n    }\n\n    /**\n     * Importa archivos HTML al canvas\n     */\n    async importHTMLFiles(htmlFiles) {\n        if (!htmlFiles || htmlFiles.length === 0) {\n            throw new Error('No hay archivos HTML para importar');\n        }\n\n        // Usar el primer HTML encontrado\n        const mainHTML = htmlFiles[0];\n        \n        // Parsear y cargar en canvas\n        if (window.htmlParser) {\n            const parsed = window.htmlParser.parse(mainHTML.content);\n            this.loadParsedHTMLToCanvas(parsed);\n            \n            if (window.showToast) {\n                window.showToast(`‚úÖ ${mainHTML.name} importado correctamente`);\n            }\n        } else {\n            // Fallback: cargar HTML directo\n            const canvas = document.getElementById('canvas');\n            if (canvas) {\n                // Extraer body content\n                const bodyMatch = mainHTML.content.match(/<body[^>]*>([\\s\\S]*)<\\/body>/i);\n                const bodyContent = bodyMatch ? bodyMatch[1] : mainHTML.content;\n                \n                canvas.innerHTML = bodyContent;\n                \n                // Reaplicar eventos a elementos\n                if (window.setupElementsEvents) {\n                    window.setupElementsEvents();\n                }\n            }\n        }\n    }\n\n    /**\n     * Carga HTML parseado al canvas\n     */\n    loadParsedHTMLToCanvas(parsedData) {\n        const canvas = document.getElementById('canvas');\n        if (!canvas) return;\n\n        canvas.innerHTML = parsedData.html;\n        \n        // Reaplicar eventos\n        if (window.setupElementsEvents) {\n            window.setupElementsEvents();\n        }\n    }\n\n    /**\n     * Obtiene extensi√≥n de archivo\n     */\n    getFileExtension(fileName) {\n        const parts = fileName.split('.');\n        return parts.length > 1 ? '.' + parts[parts.length - 1].toLowerCase() : '';\n    }\n\n    /**\n     * Muestra modal de carga\n     */\n    showLoadingModal(message) {\n        let modal = document.getElementById('project-loading-modal');\n        \n        if (!modal) {\n            modal = document.createElement('div');\n            modal.id = 'project-loading-modal';\n            modal.className = 'project-analysis-modal';\n            document.body.appendChild(modal);\n        }\n\n        modal.innerHTML = `\n            <div class=\"modal-overlay\"></div>\n            <div class=\"modal-content\">\n                <div class=\"loading-spinner\"></div>\n                <h3>${message}</h3>\n                <p>Esto puede tomar unos segundos...</p>\n            </div>\n        `;\n        \n        modal.style.display = 'flex';\n    }\n\n    /**\n     * Oculta modal de carga\n     */\n    hideLoadingModal() {\n        const modal = document.getElementById('project-loading-modal');\n        if (modal) {\n            modal.style.display = 'none';\n        }\n    }\n\n    /**\n     * Muestra resultados del an√°lisis\n     */\n    showAnalysisResults(project) {\n        const modal = document.createElement('div');\n        modal.className = 'project-analysis-modal';\n        \n        const treeHTML = this.renderFileTree(project.tree);\n        \n        modal.innerHTML = `\n            <div class=\"modal-overlay\"></div>\n            <div class=\"modal-content analysis-results\">\n                <div class=\"modal-header\">\n                    <h3>üìä An√°lisis del Proyecto</h3>\n                    <button class=\"modal-close-btn\">&times;</button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"project-info\">\n                        <h4>${project.name}</h4>\n                        <div class=\"info-grid\">\n                            <div class=\"info-item\">\n                                <span class=\"info-label\">Archivos:</span>\n                                <span class=\"info-value\">${project.totalFiles}</span>\n                            </div>\n                            <div class=\"info-item\">\n                                <span class=\"info-label\">Framework:</span>\n                                <span class=\"info-value\">${project.structure.framework}</span>\n                            </div>\n                            ${project.structure.buildTool ? `\n                            <div class=\"info-item\">\n                                <span class=\"info-label\">Build Tool:</span>\n                                <span class=\"info-value\">${project.structure.buildTool}</span>\n                            </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"file-tree-container\">\n                        <h4>üìÅ Estructura de Archivos</h4>\n                        <div class=\"file-tree\">\n                            ${treeHTML}\n                        </div>\n                    </div>\n\n                    ${project.mainFiles.html.length > 0 ? `\n                    <div class=\"main-files\">\n                        <h4>üìÑ Archivos HTML Encontrados</h4>\n                        <ul class=\"files-list\">\n                            ${project.mainFiles.html.map(f => `\n                                <li>\n                                    <span class=\"file-icon\">üìÑ</span>\n                                    <span class=\"file-name\">${f.name}</span>\n                                    <span class=\"file-path\">${f.path}</span>\n                                </li>\n                            `).join('')}\n                        </ul>\n                    </div>\n                    ` : ''}\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-secondary\" data-action=\"cancel\">Cancelar</button>\n                    ${project.mainFiles.html.length > 0 ? `\n                    <button class=\"btn btn-primary\" data-action=\"import\">\n                        Importar HTML Principal\n                    </button>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n\n        // Eventos\n        modal.querySelector('.modal-close-btn').addEventListener('click', () => modal.remove());\n        modal.querySelector('.modal-overlay').addEventListener('click', () => modal.remove());\n        modal.querySelector('[data-action=\"cancel\"]').addEventListener('click', () => modal.remove());\n        \n        const importBtn = modal.querySelector('[data-action=\"import\"]');\n        if (importBtn) {\n            importBtn.addEventListener('click', async () => {\n                try {\n                    await this.importHTMLFiles(project.mainFiles.html);\n                    modal.remove();\n                } catch (error) {\n                    alert(`Error importando: ${error.message}`);\n                }\n            });\n        }\n\n        document.body.appendChild(modal);\n    }\n\n    /**\n     * Renderiza √°rbol de archivos como HTML\n     */\n    renderFileTree(node, level = 0) {\n        let html = '';\n\n        // Renderizar archivos\n        if (node.files && node.files.length > 0) {\n            for (const file of node.files) {\n                const icon = this.getFileIcon(file.extension);\n                html += `\n                    <div class=\"tree-item file\" style=\"padding-left: ${level * 20}px;\">\n                        <span class=\"tree-icon\">${icon}</span>\n                        <span class=\"tree-name\">${file.name}</span>\n                        <span class=\"tree-size\">${this.formatFileSize(file.size)}</span>\n                    </div>\n                `;\n            }\n        }\n\n        // Renderizar directorios\n        if (node.children && node.children.size > 0) {\n            for (const [name, child] of node.children.entries()) {\n                html += `\n                    <div class=\"tree-item directory\" style=\"padding-left: ${level * 20}px;\">\n                        <span class=\"tree-icon\">üìÅ</span>\n                        <span class=\"tree-name\">${name}/</span>\n                    </div>\n                `;\n                html += this.renderFileTree(child, level + 1);\n            }\n        }\n\n        return html;\n    }\n\n    /**\n     * Obtiene √≠cono seg√∫n extensi√≥n\n     */\n    getFileIcon(ext) {\n        const icons = {\n            '.html': 'üìÑ',\n            '.htm': 'üìÑ',\n            '.js': 'üìú',\n            '.jsx': '‚öõÔ∏è',\n            '.css': 'üé®',\n            '.scss': 'üé®',\n            '.sass': 'üé®',\n            '.json': 'üìã',\n            '.md': 'üìù'\n        };\n        \n        return icons[ext] || 'üìÑ';\n    }\n\n    /**\n     * Formatea tama√±o de archivo\n     */\n    formatFileSize(bytes) {\n        if (bytes < 1024) return bytes + ' B';\n        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n    }\n}\n\n// Estilos\nconst analyzerStyles = document.createElement('style');\nanalyzerStyles.textContent = `\n    .project-analysis-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100vh;\n        z-index: 3000;\n        display: none;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .project-analysis-modal .modal-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.6);\n    }\n\n    .project-analysis-modal .modal-content {\n        background: white;\n        border-radius: 12px;\n        width: 90%;\n        max-width: 800px;\n        max-height: 85vh;\n        position: relative;\n        z-index: 10;\n        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);\n        display: flex;\n        flex-direction: column;\n    }\n\n    .project-analysis-modal .modal-content.analysis-results {\n        max-width: 900px;\n    }\n\n    .project-analysis-modal .modal-header {\n        padding: 20px 24px;\n        border-bottom: 1px solid #e2e8f0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n\n    .project-analysis-modal .modal-header h3 {\n        margin: 0;\n        font-size: 18px;\n        color: #1e293b;\n    }\n\n    .project-analysis-modal .modal-close-btn {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #64748b;\n    }\n\n    .project-analysis-modal .modal-body {\n        padding: 24px;\n        overflow-y: auto;\n        flex: 1;\n    }\n\n    .project-analysis-modal .modal-footer {\n        padding: 16px 24px;\n        border-top: 1px solid #e2e8f0;\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n    }\n\n    .project-analysis-modal .loading-spinner {\n        width: 50px;\n        height: 50px;\n        border: 4px solid #e2e8f0;\n        border-top-color: #2563eb;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n        margin: 0 auto 20px;\n    }\n\n    @keyframes spin {\n        to { transform: rotate(360deg); }\n    }\n\n    .project-info h4 {\n        margin: 0 0 16px 0;\n        color: #1e293b;\n    }\n\n    .info-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n        gap: 12px;\n        margin-bottom: 24px;\n    }\n\n    .info-item {\n        background: #f8fafc;\n        padding: 12px;\n        border-radius: 6px;\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n\n    .info-label {\n        font-size: 12px;\n        color: #64748b;\n        font-weight: 500;\n    }\n\n    .info-value {\n        font-size: 16px;\n        color: #1e293b;\n        font-weight: 600;\n    }\n\n    .file-tree-container {\n        margin: 24px 0;\n    }\n\n    .file-tree-container h4 {\n        margin: 0 0 12px 0;\n        color: #1e293b;\n    }\n\n    .file-tree {\n        background: #f8fafc;\n        border: 1px solid #e2e8f0;\n        border-radius: 6px;\n        padding: 12px;\n        max-height: 300px;\n        overflow-y: auto;\n        font-family: 'Monaco', 'Courier New', monospace;\n        font-size: 13px;\n    }\n\n    .tree-item {\n        padding: 4px 8px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        border-radius: 4px;\n        transition: background 0.2s;\n    }\n\n    .tree-item:hover {\n        background: #e2e8f0;\n    }\n\n    .tree-item.directory {\n        font-weight: 600;\n        color: #475569;\n    }\n\n    .tree-item.file {\n        color: #64748b;\n    }\n\n    .tree-icon {\n        font-size: 14px;\n        flex-shrink: 0;\n    }\n\n    .tree-name {\n        flex: 1;\n    }\n\n    .tree-size {\n        font-size: 11px;\n        color: #94a3b8;\n    }\n\n    .main-files {\n        margin-top: 24px;\n    }\n\n    .main-files h4 {\n        margin: 0 0 12px 0;\n        color: #1e293b;\n    }\n\n    .files-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n    }\n\n    .files-list li {\n        padding: 10px 12px;\n        background: #f8fafc;\n        border: 1px solid #e2e8f0;\n        border-radius: 6px;\n        margin-bottom: 8px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n    }\n\n    .file-icon {\n        font-size: 18px;\n    }\n\n    .file-name {\n        font-weight: 600;\n        color: #1e293b;\n    }\n\n    .file-path {\n        font-size: 12px;\n        color: #64748b;\n        margin-left: auto;\n    }\n`;\n\ndocument.head.appendChild(analyzerStyles);\n\n// Exportar globalmente\nwindow.ProjectAnalyzer = ProjectAnalyzer;\n"],"names":["selectedElement","draggedComponentType","elementIdCounter","currentFilter","fileLoader","projectManager","componentExtractor","plantillas","id","nombre","descripcion","categoria","emoji","contenido_html","renderTemplates","grid","document","getElementById","console","error","filtered","filter","t","log","length","innerHTML","map","template","toUpperCase","join","showGallery","children","confirm","classList","remove","hideGallery","add","createComponent","type","element","createElement","style","padding","border","minHeight","textContent","width","background","display","flexDirection","gap","gridTemplateColumns","fontSize","fontWeight","margin","lineHeight","paddingLeft","src","alt","maxWidth","controls","height","placeholder","borderRadius","fontFamily","color","cursor","alignItems","className","backgroundColor","setAttribute","deleteBtn","onclick","e","stopPropagation","deleteElement","appendChild","addEventListener","selectElement","makeElementEditable","setupElementDragAndDrop","tabButtons","querySelectorAll","forEach","btn","index","b","this","setupTabs","accordionHeaders","header","content","nextElementSibling","setupAccordion","modal","querySelector","trigger","closeBtn","modalBtn","closeModal","target","setupModal","slidesContainer","prevBtn","nextBtn","currentSlide","slides","updateCarousel","transform","setupCarousel","FileLoader","ProjectManager","ComponentExtractor","window","initializeNewModules","component","getAttribute","enhancedDragDrop","setupComponentDrag","dataTransfer","effectAllowed","img","setDragImage","canvas","preventDefault","dropEffect","setupCanvasDrop","draggedCanvasElement","showToast","setupCanvasDropForMovement","key","ctrlKey","saveProject","searchTerm","value","toLowerCase","text","includes","category","dropIndicator","draggable","contains","setData","outerHTML","cssText","body","el","rect","getBoundingClientRect","midY","top","isAfter","clientY","targetElement","canvasRect","left","bottom","showDropIndicator","clientX","right","draggedElement","insertAfter","parent","parentNode","child","node","isDescendant","nextSibling","insertBefore","moveElement","resizeManager","disableResize","enableResize","setupCanvasElementDrag","geminiValidator","isEnabled","__async","result","validateElement","_a","parentElement","tagName","hasChanges","showCorrectionSuggestion","validateElementSyntax","panel","getComputedStyle","html","replace","trim","maxHeight","paddingTop","paddingRight","paddingBottom","marginTop","marginRight","marginBottom","marginLeft","position","rgbToHex","textAlign","borderWidth","borderStyle","borderColor","boxShadow","opacity","parseFloat","Math","round","justifyContent","alignContent","gridTemplateRows","gridGap","justifyItems","transition","href","loadProperties","contentEditable","focus","range","createRange","selectNodeContents","selection","getSelection","removeAllRanges","addRange","once","shiftKey","blur","setCanvasSize","size","wrapper","downloadFile","filename","blob","Blob","url","URL","createObjectURL","a","download","click","revokeObjectURL","enhancedProjectManager","saveCurrentProject","loadProject","event","files","name","endsWith","file","importProject","then","project","catch","htmlParser","parseHTMLFile","loadProjectToCanvas","htmlFile","i","message","toast","setTimeout","rgb","startsWith","match","parseInt","x","hex","toString","originalSaveProject","originalLoadProject","constructor","Promise","resolve","reject","reader","FileReader","onload","htmlContent","jsonProject","convertHTMLToJSON","onerror","Error","readAsText","doc","DOMParser","parseFromString","styles","extractStyles","scripts","extractScripts","bodyElements","extractBodyElements","version","metadata","title","created","Date","toISOString","imported","originalFile","elements","inline","internal","external","styleTag","push","link","media","script","async","defer","Array","from","buildElementTree","domElement","nodeType","Node","ELEMENT_NODE","elementId","computedStyles","getRelevantStyles","inlineStyles","parseInlineStyles","getDirectTextContent","attributes","extractAttributes","computed","originalId","originalClasses","canvasElement","childElement","childNodes","TEXT_NODE","relevantAttrs","attr","some","pattern","split","declaration","colonIndex","indexOf","property","substring","prop","getPropertyValue","jsonToCanvas","projectData","elementData","createDOMFromJSON","applyInternalStyles","reapplyCanvasEvents","cls","Object","entries","setProperty","childData","addDeleteButton","stylesData","styleData","styleElement","head","updatePropertiesPanel","currentProject","projectHistory","createProjectFromCanvas","extractElementsFromCanvas","modified","canvasSize","getCurrentCanvasSize","extractInternalStyles","container","extractElementData","extractElementAttributes","extractInlineStyles","componentType","now","random","substr","activeBtn","createDOMFromElementData","loadLegacyProject","addElementEvents","downloadProject","JSON","stringify","parse","startBlankProject","loadTemplate","templateId","find","filterTemplates","newProject","exportHTML","clone","cloneNode","removeAttribute","exportZip","showHelp","importHTMLFile","showProjectsPanel","projectsList","projects","getStoredProjects","thumbnail","toLocaleDateString","loadProjectsList","showComponentsLibrary","componentsList","components","getStoredComponents","preview","tags","tag","loadComponentsLibrary","toggleCategory","titleElement","toggle","module","exports","FileLoader$1","supportedTypes","css","js","images","setupDropZone","eventName","preventDefaults","highlight","bind","unhighlight","handleDrop","processFiles","fileArray","processFile","fileType","getFileType","loadHTMLFile","loadCSSFile","loadJSFile","loadImageFile","showError","fileName","patterns","readFileAsText","showHTMLPreview","HTMLParser","parseAndLoad","extractComponents","saved","saveExtractedComponents","showSuccess","scriptElement","imageUrl","readFileAsDataURL","imgElement","createPreviewModal","loadBtn","cancelBtn","escapeHtml","readAsDataURL","alert","HTMLParser$1","componentTypes","nav","footer","section","article","div","h1","h2","h3","h4","h5","h6","p","span","video","iframe","button","input","textarea","select","ul","ol","li","form","skipElements","processElements","styleEl","newStyle","linkEl","newLink","rel","scriptElements","scriptEl","newScript","shouldSkipElement","convertedElement","convertElement","originalElement","newElement","processElementContent","addEditorFunctionality","textNodes","textNode","createTextNode","detectSpecialComponents","classes","convertToNavbar","convertToHero","convertToCard","convertToFooter","ProjectManager$1","storageKey","currentProjectKey","autoSaveInterval","autoSaveTimer","init","loadCurrentProject","startAutoSave","setupEventListeners","createNewProject","projectName","generateId","generateThumbnail","saveToStorage","localStorage","setItem","existingIndex","findIndex","__spreadValues","unshift","splice","stored","getItem","projectId","reapplyEditorEvents","replaceWith","deleteProject","filteredProjects","duplicateProject","duplicated","__spreadProps","renameProject","newName","exportProject","stopAutoSave","setInterval","clearInterval","MutationObserver","observe","childList","subtree","characterData","html2canvas","scale","toDataURL","getCurrentProjectInfo","getProjectStats","total","current","lastModified","ComponentExtractor$1","extractedComponents","componentPatterns","navbar","selectors","minElements","requiredElements","card","hero","gallery","testimonial","pricing","findComponentsByPattern","findComponentsByStructure","selector","validateComponent","couldBeComponent","guessComponentType","childElements","Set","hasHeading","hasImage","hasButton","cleanElement","generateComponentId","generateComponentName","extractElementCSS","generatePreview","generateTags","walker","createTreeWalker","NodeFilter","SHOW_COMMENT","comments","nextNode","comment","heading","capitalizeFirst","timestamp","toLocaleTimeString","str","charAt","slice","updated","deleteStoredComponent","componentId","c","searchComponents","query","UndoRedoManager","history","currentIndex","maxHistorySize","isProcessing","saveInitialState","saveState","description","action","state","shift","updateUI","undo","canUndo","restoreState","showMessage","redo","canRedo","metaKey","mutations","clearTimeout","saveTimeout","undoBtn","redoBtn","disabled","_b","getHistory","isCurrent","toLocaleString","jumpToState","clearHistory","KeyboardShortcutsManager","shortcuts","Map","registerDefaultShortcuts","setupEventListener","register","undoRedoManager","isContentEditable","propertiesPanel","showCommandPalette","showQuickHelp","shortcut","callback","normalizedShortcut","normalizeShortcut","set","originalShortcut","sort","eventToShortcut","keys","altKey","shortcutData","get","renderCommandList","searchInput","commands","data","helpContent","getAllShortcuts","unregister","normalized","delete","ResponsiveTester","devices","icon","mobile","tablet","laptop","desktop","customSizes","loadCustomSizes","currentDevice","orientation","createTestPanel","renderDeviceButtons","device","setSize","updateSizeDisplay","updateBreakpointDisplay","setDeviceSize","deviceKey","setOrientation","portraitBtn","landscapeBtn","applyCustomSize","widthInput","heightInput","breakpoint","takeScreenshot","dataUrl","testAllSizes","testNext","resetCanvas","saveCustomSize","LivePreview","previewWindow","isLive","updateInterval","updateDelay","start","openPreviewWindow","startUpdates","stop","stopUpdates","closed","close","screen","open","updatePreview","generatePreviewHTML","write","collectStyles","collectScripts","canvasObserver","updateTimeout","disconnect","isActive","ThemeManager","currentTheme","loadTheme","setupToggle","setupKeyboardShortcut","watchSystemPreference","detectPreference","applyTheme","matchMedia","matches","saveTheme","theme","documentElement","getCurrentTheme","setTheme","AICodeGenerator","apiKey","endpoint","model","isConfigured","maxTokens","temperature","loadApiKey","setupUI","saveApiKey","generateFromDescription","_0","arguments","options","prompt","buildPrompt","response","callBlackboxAPI","parseResponse","generateFromImage","imageData","buildImagePrompt","includeImage","improveCode","code","instruction","generateComponent","parsed","generated","framework","responsive","accessibility","includeJS","requestBody","messages","role","max_tokens","stream","image_url","fetch","method","headers","Authorization","ok","errorData","json","status","_c","choices","htmlMatch","cssMatch","jsMatch","raw","modifyElement","currentHTML","generateFullPage","pageType","getTypicalSections","sections","landing","blog","portfolio","ecommerce","saas","optimizeCode","canvasToCode","screenshot","captureCanvasScreenshot","original","generateVariations","count","baseHTML","v","extractCodeBlock","fixHTMLErrors","suggestImprovements","line","test","parts","improvement","reason","priority","isReady","showConfigDialog","saveConfig","showGenerateDialog","executeGeneration","resultDiv","codeEl","lastGenerated","insertGeneratedCode","temp","firstElementChild","getStatus","configured","hasApiKey","validatorStyles","GeminiSyntaxValidator","apiEndpoint","validationQueue","debounceTimeout","debounceDelay","maxRetries","enabled","setApiKey","removeApiKey","removeItem","context","elementHTML","warn","results","processBatch","callGeminiAPI","success","clear","retryCount","contents","generationConfig","topK","topP","maxOutputTokens","stopSequences","safetySettings","threshold","statusText","correctedCode","extractCorrectedCode","corrected","sleep","apiResponse","candidates","applyCorrection","correctionResult","tempDiv","correctedElement","replaceChild","existingBadge","badge","showConfigModal","removeBtn","ms","ResizeManager","activeElement","resizing","startX","startY","startWidth","startHeight","currentHandle","minWidth","aspectRatio","preserveAspectRatio","handles","injectStyles","handleMouseMove","handleMouseUp","handleKeyDown","handlesContainer","handleConfig","handle","dataset","startResize","handleName","computedStyle","dispatchEvent","deltaX","deltaY","newWidth","newHeight","max","showDimensionsTooltip","finalWidth","finalHeight","hideDimensionsTooltip","cancelResize","Event","tooltip","setDimensions","resetDimensions","fitToContent","detail","CustomEvent","bubbles","styleId","destroy","removeEventListener","EnhancedDragDropManager","draggedType","ghostElement","dragPreview","isDragging","dropZones","snapThreshold","scrollSpeed","scrollEdgeSize","createDropIndicator","setupGlobalEvents","handleDragOver","handleDragEnd","componentElement","startComponentDrag","endComponentDrag","startCanvasElementDrag","endCanvasElementDrag","createDragPreview","highlightDropZones","isNewComponent","sourceElement","handleAutoScroll","dropTarget","findDropTarget","hideDropIndicator","insertPosition","calculateInsertPosition","createNewComponent","cleanup","elementsUnderCursor","elementsFromPoint","canAcceptChildren","reference","closestElement","closestDistance","Infinity","childCenterY","distance","abs","relativeY","clearDropZones","canvasPanel","scrollY","scrollTop","analyzerStyles","ProjectAnalyzer","fileTree","analysisCache","supportedExtensions","maxFileSize","loadDirectory","fileList","showLoadingModal","buildFileTree","structure","analyzeProjectStructure","mainFiles","identifyMainFiles","extractProjectName","tree","totalFiles","hideLoadingModal","showAnalysisResults","ext","getFileExtension","readFileContent","pathParts","webkitRelativePath","insertIntoTree","path","extension","fileData","dirName","has","hasPackageJson","hasIndexHtml","buildTool","dependencies","directories","public","dist","assets","allFiles","flattenTree","pkg","detectFramework","detectBuildTool","detectCommonDirectories","packageJson","deps","devDependencies","values","entry","config","pkgFile","f","importHTMLFiles","htmlFiles","mainHTML","loadParsedHTMLToCanvas","bodyMatch","bodyContent","setupElementsEvents","parsedData","treeHTML","renderFileTree","importBtn","level","getFileIcon","formatFileSize","bytes","toFixed"],"mappings":"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"}